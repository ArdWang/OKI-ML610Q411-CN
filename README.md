# OKI-ML610Q411-CN
ML610Q411/ML610Q412/ML610Q415-中文手册

## 前言

这个手册是描述操作8位微型控制芯片 ML610Q411/ML610Q412/ML610Q415.

跟随提供的手册,读他们的要点:

1. nX-U8/100核心指令手册 描述nX-U8/100核心基本的结构和相互指令
2. MACU8 汇编程序包用户手册
描述操作可重定位汇编程序、链接器、库管理器和对象转换器的方法，以及汇编语言的规范。
3. CCU8用户手册
操作编译器方法的说明
4. CCU8编程指南
编程方法说明。
5. CCU8语言参考
语言规范说明。
6. DTU8调试器用户手册
操作调试器DTU8的方法说明。
7. IDEU8用户手册
集成开发环境IDEU8的说明。
8. uEASE用户手册
片上调试工具uEASE的说明。
9. uEASE ML610Q400连接手册
uEASE与ML610Q400系列连接说明。
10. 关于Flash Writer主机程序的用户手册说明。


## 符号


数值         

## 第一章

该LSI是一种高性能的8位CMOS微控制器，内置了丰富的外围电路，如同步串口、UART、I2C总线接口（master）、蜂鸣器驱动器、电池电量检测电路、RC振荡型a/D转换器、12位逐次逼近型a/D转换器和LCD驱动器，在8位CPU nX-U8/100周围合并。
CPU nX-U8/100采用三级流水线结构并行处理，能够在单指令单时钟模式下高效执行指令。作为程序存储器安装的Flash-ROM实现相当于掩模ROM的低电压低功耗操作（读取操作），并且最适合电池驱动的应用。安装的片上调试功能可以进行程序调试和编程。

•CPU
−8位RISC CPU（CPU名称：nX-U8/100）
−指令系统：16位指令
−指令开始：传输、算术运算、比较、逻辑运算、乘法/除法、位
操作，位逻辑操作，跳转，条件跳转，调用返回堆栈操作，
算术移位等−片上调试功能
−最小指令执行时间30.5μs（@32.768 kHz系统时钟）2μs（@500kHz系统时钟）

•内部存储器
−内部16KB闪存ROM（8K×16位）（包括不可用的1KB测试区）−内部1KB数据RAM（1024×8位）

•中断控制器
−2个不可屏蔽中断源
内部源：1（看门狗定时器）
外部来源：1（NMI）
−19个可屏蔽中断源
内部源：15（SSIO、SA-A/D转换器、I2C、定时器0、定时器1、定时器2、定时器3、1kHz定时器、UART、RC-A/D转换器、PWM、TBC128Hz、TBC32Hz、TBC16Hz、TBC2Hz）
外部来源：4（P00、P01、P02、P03）

•时基计数器
−低速时基计数器×1通道
频率补偿（补偿范围：约−488ppm至+488ppm。补偿精度：约。
0.48ppm，适用于ML610Q411/Q412）-高速时基计数器×1通道

•看门狗定时器
−不可屏蔽中断和复位
−自由运行
−溢流周期：4种可选类型
ML610Q411/Q412：125ms、500ms、2s和8s ML610Q415：约131ms、524ms、2.1s、8.4s

•定时器
−8位×4通道（定时器0-3：使用定时器0-1或定时器2-3提供16位×2配置）
−时钟频率测量模式（在使用定时器2-3的16位配置的一个信道中，ML610Q415没有
没有此模式）

•1 kHz定时器
−中断功能
ML610Q411/Q412:10 Hz/1 Hz中断ML610Q415:9.5Hz/0.95Hz中断

•捕获
−时基捕获×2个通道
ML610Q411/Q412:4096 Hz至32 Hz ML610Q415:3906Hz~30.5H

•脉宽调制
−分辨率16位×1通道

•同步串行端口
−主/从可选
−LSB优先/MSB优先可选
−8位长度/16位长度可选

•通用异步收发器
-半双工通信
−TXD/RXD×1通道
−位长度、奇偶校验/无奇偶校验、奇偶校验/偶校验、1个停止位/2个停止位−正逻辑/负逻辑可选
−内置波特率发生器

•I2C总线接口
−仅主功能
−标准模式(500kHz时为50kbps)

•蜂鸣器驱动器
−4种输出模式，8个频率，16个占空比

•RC振荡型A/D转换器
−24位计数器
−时分×2通道
−转换时间：46us/1ch@500kHz

•逐次逼近型A/D转换器−12位A/D转换器
−输入×2通道

•通用端口
−不可屏蔽中断输入端口×1通道
−仅输入端口×6通道（包括辅助功能）
−仅输出端口×3个通道（包括辅助功能）−输入/输出端口
ML610Q411:22路（含二次功能）ML610Q412:14路（含二次功能）ML610Q415:22路（含二次功能）

•LCD驱动器
−段数
ML610Q411:最大144点（36段×4 com）ML610Q412:最大176点（44段×4 com）ML610Q415:最大144点（36段×4 com）
−1/1至1/4负载
−1/3偏置（内置偏置产生电路）−帧频可选择
ML610Q411/Q412：约64 Hz、73 Hz、85 Hz和102 Hz
ML610Q415：约61Hz、70Hz、81Hz、97Hz
−偏置电压倍增时钟可选（8种类型）
对比度调整（32步）
−LCD驱动停止模式、LCD显示模式、所有LCD打开模式和所有LCD关闭模式可选

•重置
−通过复位引脚复位
−上电时产生上电重置
−检测到低速时钟振荡停止时复位（ML610Q411PC和ML610Q415没有
此函数）
−通过看门狗定时器（WDT）溢出复位

•电源电压检测功能
−判断电压：16级之一−判断精度：±2%（典型值）

•时钟
−低速时钟
ML610Q411/ML610Q412：晶体振荡（32.768 kHz）
（此LSI不能保证在没有低速晶体振荡时钟的情况下工作）ML610Q415:1/16内置RC振荡500 kHz（31.25kHz）*
（此LSI没有低速晶体振荡时钟）
*此时钟不用于CPU操作时钟。
−高速时钟：
内置RC振荡（500 kHz）外部时钟（500 kHz或以下）
−高速时钟齿轮：1/2（250kHz）、1/4（125kHz）、1/8（62.5kHz：默认）
−通过软件选择高速时钟模式：
内置RC振荡，外部时钟

•电源管理
−暂停模式：CPU的指令执行暂停（外围电路处于工作状态）。
−停止模式：停止低速振荡和高速振荡（CPU和外围电路的操作）
已停止。）
−高速时钟齿轮：高速系统时钟的频率可以通过软件（1/1、1/2、1/4或
振荡时钟的1/8）
−块控制功能：关闭未使用外设电路的电源（复位寄存器和停止时钟电源）

•装运
−芯片（模具）
ML610Q411 xxxWA（空白产品：ML610Q411-NNNWA）ML610Q411P xxxWA（空白）产品：ML610Q411P-NNNWA)ML610Q411PA xxxWA（空白产品：ML610Q411PA-NNNWA)ML610Q411PC xxxWA（空白产品：ML610Q411PC-NNNWA)ML610Q412 xxxWA（空白产品：ML610Q412-NNNWA）ML610Q412P xxxWA（空白）产品：ML610Q412P-NNNWA)ML610Q415 xxxWA（空白产品：ML610Q415-NNNWA）
ML610Q411/ML610Q412/ML610Q415用户手册
−120针塑料LQFP
ML610Q411-xxxTBZ03A（空白产品：ML610Q411-NNNTBZ03A）
ML610Q411P-xxxTBZ03A（空白产品：ML610Q411P-NNNTBZ03A）
ML610Q411PA-xxxTBZ03A（空白产品：ML610Q411PA-NNNTBZ03A）
ML610Q411C-xxxTBZ03A（空白产品：ML610Q411C-NNNTBZ03A）
ML610Q412-xxxTBZ03A（空白产品：ML610Q412-NNNTBZ03A）
ML610Q412P-xxxTBZ03A（空白产品：ML610Q412P-NNNTBZ03A)
ML610Q415-xxxTBZ03A（空白产品：ML610Q415-NNNTBZ03A）
xxx:ROM代码
P：宽温度范围版本
A:低速时钟振荡停止检测重置可选择为始终禁用（请参阅中的第3章和第4章）
更详细的用户手册）。
C:EMS公差改进版/硬件非活动低速时钟振荡停止检测重置（参见
用户手册的第3章和第4章了解更多详细信息）WA:芯片
TB：TQFP
•保证工作范围
−工作温度：−20°C至+70°C（P型：−40°C至+85°C）−工作电压：VDD=1.1V至3.6V，AVDD=2.2V至3.6V

#### 1.2 1.2.1
ML610Q411/ML610Q415功能框图配置
“*”表示每个端口的第二或第三功能*'表示ML610Q415没有晶体振荡。

![image-20210326112459538](/Users/rnd/Library/Application Support/typora-user-images/image-20210326112459538.png)

#### 1.2.2
ML610Q412方框图
“*”表示每个端口的第二或第三功能。

![AC1BDC32-7A25-4F0B-ADFF-E0BF75735459](/Users/rnd/Library/Containers/com.tencent.qq/Data/Library/Application Support/QQ/Users/278161009/QQ/Temp.db/AC1BDC32-7A25-4F0B-ADFF-E0BF75735459.png)

#### 1.3
1.3.1 1.3.1.1
别针
引脚布局
ML610Q411/ML610Q415引脚布局
120针TQFP封装

![81502D10-9F2E-4820-9E11-3E892D478DF6](/Users/rnd/Library/Containers/com.tencent.qq/Data/Library/Application Support/QQ/Users/278161009/QQ/Temp.db/81502D10-9F2E-4820-9E11-3E892D478DF6.png)

（NC）：无连接
注：
P30到P35的分配不正常。

图1-3 ML610Q411/ML610Q415封装引脚布局



#### 1.3.1.2 ML610Q412引脚布局
90针
120针TQFP封装

图在PDF的第23页 图1-4 ML610412

#### 1.3.1.3 ML610Q411/ML610Q415芯片引脚布局

图在PDF 第24页里面

*仿真垫
注：这些虚拟垫是可见的，并没有任何功能，他们是放置在一个机械评估天青石半导体。请不要将引线连接到虚拟焊盘上。
注：

1–9
37（NC）

P30到P35的分配不正常。
芯片尺寸：
记数：
最小焊盘间距：
衬垫孔径：
切屑厚度：
芯片背面电压：
2.836mm x 2.636mm 95针
80微米
70μm×70μm
350μm VSS电平

图1-5
ML610Q411/ML610Q415芯片尺寸

#### 1.3.1.4 ML610Q412芯片引脚布局

图在 PDF 的第25页当中

*仿真垫
注：这些虚拟垫是可见的，并没有任何功能，他们是放置在一个机械评估天青石半导体。请不要将引线连接到虚拟焊盘上。

注：P30到P35的分配不正常。

芯片尺寸：
记数：
最小焊盘间距：
衬垫孔径：
切屑厚度：
芯片背面电压：
2.836mm x 2.636mm 95针
80微米
70μm×70μm
350μm VSS电平



#### 1.3.1.5 ML610Q411/ML610Q415芯片的焊盘坐标

表1-1
ML610Q411/ML610Q415的焊盘坐标

PDF图 第26页

#### 1.3.1.6 ML610Q412芯片的焊盘坐标

ML610Q412的焊盘坐标

PDF图 第27页

#### 1.3.2 引脚表

PDF图 第28-29页

-----------

端口编号    端口名称   I/O口   方法

-------------------------------------------------

2，24，45，47    VSS         /             负极电源引脚 

-------

22, 46       VDD          /             正极电源引脚

----

23           VDDL        /              电源引脚内部逻辑（内部生成）

------

25       VDDX      /         低速振荡电源引脚（内部产生）

------------

1           VPP   /         闪存ROM电源引脚

------

28         AVSS    连续逼近型ADC负电源引脚

-----

30  AVDD  连续逼近型ADC正电源引脚

---

65 VL1 LCD偏置电源引脚（内部生成）

---

64 VL2 LCD偏置电源引脚（内部生成）

----

63 VL3 LCD偏置电源引脚（内部生成）

---

62 C1 用于产生LCD偏压的电容器连接引脚

---

61 C2 用于产生LCD偏压的电容器连接引脚

---

21 TEST I/O 测试用输入/输出引脚

---

8 RESET_N 复位输入引脚

---

27    XT0（*3） I  低速时钟振荡引脚

---

26   XT1(*3)   O  低速时钟振荡引脚

---

29    VREF   /  逐次逼近型模数转换器的参考电源引脚

---

36   AIN0    I  逐次逼近型ADC输入

---

37  AIN1   I   逐次逼近型ADC输入

---

40  NMI    I  不可屏蔽中断引脚

----

41 P00/EX10/CAP0    I  输入端口，外部中断0，捕获0输入

----

42  P01/EX12/RXD0  I 输入端口，外部中断1，扑获1输入

---

43  P02/EX12/RXD0  I  输入端口，外部中断2 UART0接收

----

44    P03/EX13  I     输入端口，外部中断3

--------

38    P10   I      输入端口

----

39    P11  I     输入端口

-------

3       P20/LED0   O     输出端口

----

4       P21/LED1    O     输出端口

----

5       P22/LED2    O   输出端口

----

15      P30      I/O     输入/输出端口

------

16     P31       I/O     输入/输出端口

-----

17     P34      I/O     输入/输出端口

----

18     P32      I/O      输入/输出端口

---

19     P33      I/O     输入/输出端口

---

20     P35     I/O       输入/输出端口

----

6       P40     I/O      输入/输出端口

---

7      P41       I/O    输入/输出端口

---

9      P42      I/O     输入/输出端口

---

10     P43     I/O    输入/输出端口

----

11      P44/T02P0CK     I/O   输入/输出端口，定时器0/定时器2/PWM0外部输入1时钟输入

---

12      P45/T13P1CK     I/O     输入/输出端口，定时器1/定时器3外部时钟输入

---

13        P46       I/O       输入/输出端口

---

14         P47     I/O       输入/输出端口

---

106       PA0(*1) / SEG43(*2)        输入输出 / LCD段引脚

-----

107        PA1(*1) / SEG42(*2)     输入输出 /  LCD段引脚

---

108         PA2（*1）/ SEG41(*2)      输入输出端口 / LCD段引脚

---

109        PA3（1）/ SEG40(2)    输入输出端口 / LCD段引脚

---

110       PA4(1)   /  SEG39(2)    输入输出端口 / LCD段引脚

----

111        PA5(1)  /    SEG38(2)      输入输出端口 / LCD段引脚

---

112      PA6(1) / SEG37(2)      输入输出端口 / LCD段引脚

---

113      PA7(1) / SEG36(2)     输入输出端口 / LCD段引脚

---

69       COM0     LCD公共引脚

---

68       COM1     LCD公共引脚

---

67       COM2     LCD公共引脚

---

66       COM3     LCD公共引脚

---

70       SEG0       LCD段引脚

---

71       SEG1       LCD段引脚

---

72       SEG2       LCD段引脚

77~105  SEG3~SEG35 LCD段引脚

---

（*1）ML610Q411和ML610Q415上的针脚。
（*2）ML610Q412上的引脚。
（3）ML610Q415没有低速晶体振荡功能，但XT0引脚必须绑定到VSS。

---

RESET_N       重置输入引脚。当该引脚被设置为“L”级时，系统复位模式被设置，内部部分被初始化。当该引脚随后被设置为“H”级时，程序开始执行。上拉电阻器内部连接。

---

XT0 / XT1  低速时钟的晶体连接引脚。
32.768 kHz晶体振荡器（见测量电路1）连接到该引脚。电容器CDL和CGL根据需要通过该引脚和VSS连接。ML610Q415没有晶体振荡功能，但在ML610Q415上连接XT0到VSS，不连接XT1。

---

OSC0     高速外部时钟输入引脚。该引脚用作P10的辅助功能。

---

LSCLK    低速时钟输出引脚。该引脚用作P20引脚的辅助功能。

---

OUTCLK    高速时钟输出引脚。该引脚用作P21引脚的辅助功能

---

通用输入端口

---

P00-P03     通用输入端口。由于这些引脚具有辅助功能，因此当使用辅助功能时，插脚不能用作端口。

---

P10-P11      通用输入端口。由于这些管脚具有辅助功能，因此在使用辅助功能时，管脚不能用作端口。

---

通用输出端口

---

P20-P22       通用输出端口。由于这些管脚具有辅助功能，因此管脚不能用作辅助功能使用辅助功能时的端口。

---

通用输入/输出端口

---

P30-P35       通用输入/输出端口。由于这些管脚具有辅助功能，因此在使用辅助功能时，管脚不能用作端口。

---

P40-P47      通用输入/输出端口。由于这些管脚具有辅助功能，因此在使用辅助功能时，管脚不能用作端口。

---

PA0-PA7    通用输入/输出端口。这些引脚用于ML610Q411和ML610Q415，但ML610Q412中未提供。

---

UART

---

TXD0      UART数据输出引脚。该引脚用作P43引脚的辅助功能。

---

RXD0    UART数据输入引脚。该引脚用作P42的辅助功能或P02引脚的主要功能。

---

I2C 总线接口

---

SDA     I2C数据输入/输出引脚。该引脚用作P40引脚的辅助功能。此引脚具有NMOS开漏输出。当使用此引脚作为I2C的功能时，从外部连接上拉电阻器。

---

SCL    I2C数据输出引脚 。该引脚用作P41引脚的辅助功能。此引脚具有NMOS开漏输出。当使用此引脚作为I2C的功能时，从外部连接上拉电阻器。

---

同步串行（SSIO）

---

SCK0   同步串行时钟输入/输出引脚。该引脚用作P41或P45引脚的第三功能。

---

SIN0    同步串行数据输入引脚。该引脚用作P40或P44引脚的第三功能

---

SOUT0     同步串行数据输出引脚。该引脚用作P42或P46引脚的第三功能。

----

PWM

---

PWM0    PWM0输出引脚。该引脚用作P43或P34引脚的第三功能。

---

T02P0CK    PWM0外部时钟输入引脚。该引脚用作P44引脚的主要功能。

---

外部中断

---

NMI    外部不可屏蔽中断输入引脚。在两条边上生成中断

---

EXI0-3    外部可屏蔽中断输入引脚。软件可以为每个位执行中断启用和边缘选择。这些引脚用作P00-P03引脚的主要功能。

---

CAP0    /  CAP1  捕捉触发器输入引脚。时基计数器的值与软件选择的中断边同步地捕获在寄存器中。这些针脚用作P00针脚（CAP0）和P01针脚（CAP1）的主要功能。

---

T02P0CK   用于定时器0和定时器2的外部时钟输入引脚。这些计时器的时钟由软件选择。该引脚用作P44引脚的主要功能。

---

T13P1CK    用于定时器1和定时器3的外部时钟输入引脚。这些计时器的时钟由软件选择。该引脚用作P45引脚的主要功能。

---

蜂鸣器

---

BZ0   蜂鸣器信号输出引脚。此引脚用作P22引脚的辅助功能。

---

LED 驱动器

---

LED0-2   Nch开漏输出引脚驱动LED。

---

RC振荡型A/D转换器

---

IN0   通道0振荡输入引脚。该引脚用作P30引脚的辅助功能。

---

CS0   通道0参考电容器连接引脚。该引脚用作P31引脚的辅助功能。

---

RCT0   用于测量的通道0的电阻/电容传感器连接引脚。该引脚用作P33引脚的辅助功能。

---

RS0   该引脚用作P32引脚的辅助功能，P32引脚是通道0的参考电阻器连接引脚。

---

RT0   用于测量的通道0的电阻传感器连接引脚。该引脚用作P34引脚的辅助功能。

---

RCM   RC振荡监视器引脚。该引脚用作P35引脚的辅助功能。

---

IN1   通道1的振荡输入引脚。该引脚用作P44引脚的辅助功能。

---

CS1   通道1的参考电容器连接引脚。该引脚用作P45引脚的辅助功能。

---

RS1   通道1的参考电阻器连接引脚。该引脚用作P46引脚的辅助功能。

---

RT1   用于通道1测量的电阻传感器连接引脚。该引脚用作P47引脚的辅助功能。

---

逐次逼近型A/D转换器

---

AVSS   逐次逼近型A/D转换器的负电源引脚

---

AVDD   逐次逼近型A/D转换器的正电源引脚

---

VREF    逐次逼近型A/D转换器的基准电源引脚

---

AIN0   通道0模拟输入逐次逼近型A/D转换器

---

A1N1  通道1模拟输入逐次逼近型A/D转换器

---

LCD驱动信号

---

COM0-3     公共输出引脚。

---

SEG0-35    段输出引脚

---

SEG36-43   段输出引脚。这些引脚在610Q412之前，但ML610Q411和ML610Q415中未提供。

---

LCD驱动电源

---

VL1 / VL2 / VL3    LCD偏置电源引脚（内部产生）。电容器Ca、Cb、VL2-和Cc（见测量电路1）连接在VSS和VL1、VL2之间，
和VL3。

---

C1 / C2  LCD偏置电源引脚（内部产生）。电容器C12连接在C1和C2之间。

---

TEST   用于测试的输入/输出引脚。一个下拉电阻器内部连接。

---

电源提供

---

VSS   负极电源引脚。

---

VDD    I/O、内部调节器、电池电量低探测器的正极电源引脚，上电复位。

----

VDDL   内部逻辑的正电源引脚（内部生成）。电容器CL0和CL1（见测量电路1）连接在该引脚和VSS之间。

---

VDDX  正电源引脚（内部产生）用于低速振荡。使用ML610Q411和ML610Q412时，将电容器Cx（参见测量电路1）连接在此引脚和VSS之间。使用ML610Q415时，将此引脚直接连接到Vss。

---

VPP    用于编程闪存ROM的电源引脚。下拉电阻器内部连接。

---

#### 1.3.4 未使用引脚的端接

表1-3显示了端接未使用引脚的方法。PPT 35页

推荐的引脚端接

注：
建议将未使用的输入端口和输入/输出端口设置为具有下拉电阻器/上拉电阻器的输入或输出模式，因为如果在高阻抗输入设置中保持引脚打开，则电源电流可能变得过大。



## 第二章  CPU和内存空间

#### 2.1 前言

该大规模集成电路包括拉皮斯半导体公司原有的8位CPU nX-U8/100，存储器型号为“小型”。有关CPU nX-U8/100的详细信息，请参阅“nX-U8/100核心说明手册”。

#### 2.2 程序内存空间

程序内存空间用于存储程序代码、表数据（ROM窗口）或向量表。
程序代码的长度为16位，由16位程序计数器（PC）指定。
ROM窗口区域数据具有8位的长度，并且可以用作表数据。
矢量表有16位长的数据，可用作复位矢量、硬件中断矢量和软件中断矢量。
程序内存空间由1段组成，容量为16kbyte（8kword）。图2-1显示了程序内存空间的配置。

具体看 图 2-1配置程序的存储空间 PDF 37页

笔记：
−由于测试程序数据存储在段0的1024字节（512字）测试数据区（0:03C00H到0:03FFFH）中，
此区域不能用作程序代码区域。
−测试区域中的地址“0:03C00H至0:03DFFH”可写且可擦除。用“0FFH”填充该区域。如果
区域中的数据不确定或其他数据（即非0FFH），无法保证使用代码进行操作。
−在程序内存空间的未使用区域设置“0FFH”数据（BRK指令）。

#### 2.3 数据存储空间

该LSI的数据存储空间包括ROM窗口区、段0的1KB RAM区和SFR区以及段1和段8的ROM参考区。
数据存储器存储8位数据，由20位指定，其中高4位作为DSR，低16位作为每条指令指定的寻址。 

图2-2 展示配置数据存储空间 PDF 38页

笔记：
−系统复位时，1 KB RAM区域的内容未定义。通过软件初始化此区域。
−从段8的ROM参考区域读取程序存储器空间的段0的内容。



#### 2.4 指令长度

一条指令的长度是16位。

#### 2.5 数据类型

支持的数据类型包括字节（8位）和字（16位）。

#### 2.6 寄存器说明

##### 2.6.1 寄存器列表

0F000H     数据段寄存器     DSR    R/W    8   00H

##### 2.6.2 数据段寄存器（DSR）

地址: 0F000H 

访问: R/W 

访问大小: 8 bits 

初始值: 00H

DSR

DSR  7       6    5   4    3     2        1          0

---



R/W           DSR3 DSR2 DSR1 DSR0

---



R/W R/W R/W R/W R/W R/W R/W R/W R/W 

---



Initial value 0 0 0 0 0 0 0 0

---



DSR是一种保留数据段的特殊功能寄存器（SFR）。有关DSR的详细信息，请参阅“nX-U8/100 Core说明手册”。

[位描述]

图片 请看 PDF 40页



## 第三章 复位功能

#### 3.1 复位功能

##### 3.1 前言

此LSI具有如下所示的五种复位功能。如果满足五个重置条件中的任何一个，则此LSI进入系统重置模式。
•通过复位引脚复位
•通电检测复位
•通过低速振荡停止检测复位（ML610Q411PC和ML610Q415上不可用）
•通过第二个看门狗定时器（WDT）溢出复位
•通过执行BRK指令进行软件复位

##### 3.1.1 特性

•储能器引脚有一个内部上拉电阻器
•低速振荡停止检测时间为典型值。3毫秒（在ML610Q411PC和ML610Q415上不可用）•可以选择250毫秒、1秒、4秒或16秒作为看门狗定时器（WDT）溢出周期
•内置复位状态寄存器（RSTAT），指示复位产生原因
•只有CPU被BRK指令复位（RAM区域和SFR区域均未复位）。

##### 3.1.2 配置

图3-1显示了复位产生电路的配置。 PDF 42页

RSTAT：复位状态登记
（*）ML610Q411PA：低速振荡停止检测复位可由BLKCON4电阻器的DXTSP位控制。
ML610Q411PC:始终禁用低速振荡停止检测重置。

图3-1复位产生电路的配置

#### 3.2 寄存器说明

##### 3.2.1 寄存器列表

图 PDF 43页

(*)ML610Q411和ML610Q412上未定义，ML610Q411PC和ML610Q415上为“0”。
RSTAT是一个特殊功能寄存器（SFR），它指示产生复位的原因。
在发生复位时，RSTAT的内容没有初始化，而指示复位原因的位被设置为“1”。使用此功能检查复位原因时，应提前对RSTAT进行写操作，并将RSTAT的内容初始化为“00H”。

[位描述]•POR（位0）
POR位是一个标志，指示已生成上电复位。通电时该位设置为“1”。

0     未生成上电复位

1     已生成通电复位

•XSTR（位1）
XSTR位是一个标志，指示产生低速振荡停止检测复位。当低速振荡停止超过低速振荡停止检测时间（TSTOP）规定的时间时，该位设置为“1”。写入位无效，在ML610Q411PC和ML610Q415上读取时始终返回“0”。

0    未发生低速振荡停止检测复位

1     发生低速振荡停止检测复位

•WDTR（位2）
WSDTR是一个标志，指示生成看门狗定时器重置。当产生看门狗定时器溢出复位时，该位设置为“1”。

注：
没有提供指示复位引脚复位发生的标志。

#### 3.3 操作说明
##### 3.3.1系统复位模式的操作
系统重置在所有处理中具有最高优先级，并且在此之前执行的任何其他处理都将被取消。
系统复位模式由以下任何原因设置。
•重置
•通过电源检测复位
•通过低速振荡停止检测复位（ML610Q411PC和ML610Q415上不可用）•通过看门狗定时器（WDT）溢出复位
•通过BRK指令进行软件复位（仅CPU复位）
在系统复位模式下，执行以下处理。
（1） 电源电路已初始化，但未通过BRK指令执行的重置进行初始化。有关电源电路的详细信息，请参阅第28章“电源电路”。
（2） 初始化初始值未定义的所有特殊函数寄存器（SFR）。但是，由于BRK指令的执行，初始化不是通过软件重置来执行的。SFR的初始值见附录A“寄存器”。
（3） CPUIS已初始化。
•CPU中的所有寄存器都已初始化。
•程序存储器中地址0000H和0001H的内容被设置为堆栈指针（SP）。
•程序存储器中地址0002H和0003H的内容设置到程序计数器（PC）。
然而，当由BRK指令复位时的程序状态字（PSW）的中断电平（ELEEVL）为1或更低时，程序存储器的地址0004H和0005H的内容被设置在程序计数器中
（个人电脑）。有关BRK说明，请参阅“nX-U8/100 Core说明手册”。
注：
在系统复位模式下，数据存储器的内容和任何初始值未定义的SFR的内容不被初始化并且未定义。通过软件初始化它们。
在BRK指令的系统复位模式下，也不会初始化具有固定初始值的特殊功能寄存器（SFR）。因此，通过软件初始化这样的SFR。

## 第四章 MCU控制功能

##### 4.1 楷述

该LSI的工作状态分为以下4种模式，包括系统复位模式：
系统复位模式程序运行模式停止模式停止模式
有关系统复位模式，请参阅第3章“复位功能”。
这种大规模集成电路具有块控制功能，可以关闭未使用的外围设备（复位寄存器和停止时钟电源）的电路，从而进一步降低电流消耗。

##### 4.1.1 特点
•停止模式，CPU停止运行，只有外围电路在运行
•停止模式，其中低速振荡和高速振荡都停止
•停止代码接收器功能，控制到停止模式的转换
•块控制功能，用于关闭未使用的外围设备的电路（复位寄存器和停止时钟
供应）。

##### 4.1.2 配置

图4-1显示了运行状态转换图。图在 PDF 46页

##### 4.2.1寄存器列表

PDF图片 47页

##### 4.2.2 停止码接收器（STPACP）

STPACP是一个只写特殊功能寄存器（SFR），用于设置停止模式。
读取STPACP时，读取“00H”。
当数据以“5nH”（n：任意值）和“0AnH”（n：任意值）的顺序写入STPACP时，停止码接收器被启用。在这种状态下，当备用控制寄存器（SBYCON）的STP位设置为“1”时，模式变为停止模式。设置停止模式时，停止代码接收器被禁用。
当在将“5nH”写入STPACP的指令和写入“0AnH”的指令之间执行另一条指令时，在写入“0AnH”之后，停止码接收器被启用。但是，如果在写入“5nH”之后将“0AnH”以外的数据写入STPACP，则“5nH”写入处理将无效，因此必须从“5nH”开始再次写入数据。
在系统复位期间，停止码接收器被禁用。
注：
如果任何中断启用标志和相应的中断请求标志都为“1”（重置MIE标志的中断请求发生将具有该条件），则不能启用停止码接收器。

##### 4.2.3备用控制寄存器（SBYCON

SBYCON是一种特殊的功能寄存器（SFR），用于控制单片机的工作模式。
[位描述]•STP（位1）

* STP位用于设置停止模式。当STP位设置为“1”且使用STPACP启用停止码适配器时，模式更改为停止模式。当发出NMI中断请求或由中断启用寄存器1（IE1）启用的P00–P03中断请求时，STP位设置为“0”，LSI返回程序运行模式。
*  HLT（位0）
  停止位用于设置停止模式。当停止位设置为“1”时，模式变为停止模式。当发出NMI中断请求、WDT中断请求或启用（中断启用标志为“1”）中断请求时，停止位设置为“1”，模式返回到程序运行模式。

注：
如果任何中断启用标志和相应的中断请求标志均为“1”（重置MIE标志的中断请求发生将具有该条件），则模式不能更改为停止模式或停止模式。
当nX-U8/100内核中程序状态字（PSW）的MIE标志为“0”时，可屏蔽中断源（带启用位的中断）发生时，停止模式和停止模式被简单释放，中断处理不执行。有关PSW的详细信息，请参阅“nX-U8/100 Core说明手册”。



##### 4.2.4 块控制寄存器0（BLKCON0）

图示 PDF 50页 

BLKCON0是一个特殊的功能寄存器（SFR），它通过关闭未使用的外围设备来进一步降低电流消耗。
•DTM3（位3）
DTM3位用于控制定时器3的操作。当DTM3位设置为“1”时，与定时器3相关的电路复位并关闭。

•DTM2（位2）
DTM2位用于控制定时器2的操作。当DTM2位设置为“1”时，与定时器2相关的电路复位并关闭。

•DTM1（位1）
DTM1位用于控制定时器1的操作。当DTM1位设置为“1”时，与定时器1相关的电路复位并关闭。

•DTM0（位0）
DTM0位用于控制定时器3的操作。当DTM0位设置为“1”时，与定时器3相关的电路复位并关闭。

注：
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
有关定时器0、定时器1、定时器2和定时器3的操作详情，请参阅第10章“定时器”。

##### 4.2.5块控制寄存器1（BLKCON1）

BLKCON1是一个特殊的功能寄存器（SFR），通过关闭未使用的外围设备，可以进一步降低电流消耗。
[位描述]

•DCAPR（位6）
DCAPR位用于控制捕获操作。当DCAPR位设置为“1”时，与捕获相关的电路复位并关闭。

•DT1K（位4）
DT1K位用于控制1kHz定时器操作。当DT1K位设置为“1”时，1kHz定时器相关电路复位并关闭。

•DPW0（位0）
DPW0位用于控制PWM0操作。当DPW0位设置为“1”时，与PWM0相关的电路复位并关闭。

注：
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
有关捕获操作的详细信息，请参见第8章“捕获”。
1kHz定时器的操作详见第9章“1kHz定时器”。有关PWM操作的详细信息，请参阅第11章“PWM”。

##### 4.2.6 块控制寄存器2（BLKCON2）

BLKCON2是一个特殊的功能寄存器（SFR），通过关闭未使用的外围设备，可以进一步降低电流消耗。
[位描述]

•DI2C0（位7）
DI2C0位用于控制I2C总线接口操作。当DI2C0位设置为“1”时，与I2C总线接口相关的电路复位并关闭

•DUA0（位2）
DUA0位用于控制UART操作。当DUA0位设置为“1”时，与UART相关的电路复位并关闭。

•DSIO0（位0）
DSIO0位用于控制SSIO操作。当DSIO0位设置为“1”时，与SSIO相关的电路复位并关闭。

注：
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
有关I2C总线接口操作的详细信息，请参阅第15章“I2C总线接口”。有关UART操作的详细信息，请参阅第14章“UART”。
有关SSIO操作的详细信息，请参阅第13章“同步串行端口”。

##### 4.2.7 块控制寄存器3（BLKCON3）

BLKCON3是一个特殊的功能寄存器（SFR），通过关闭未使用的外围设备，可以更有效地降低电流消耗。
[位描述]•DMD0（位0）
DMD0位用于控制旋律/蜂鸣器操作。当DMD0位设置为“1”时，与旋律/蜂鸣器相关的电路复位并关闭。

注：
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
蜂鸣器的操作详见第23章“蜂鸣器”。

##### 4.2.8 块控制寄存器4 （BLKCON4）

BLKCON4是一个特殊的功能寄存器（SFR），通过关闭未使用的外围设备，可以进一步降低电流消耗。
[位描述]

•DLCD（位6）
DLCD位用于控制LCD驱动程序的操作。当DLCD位设置为“1”时，与LCD驱动器相关的电路复位并关闭。

•DBLD（位5）
DBLD位用于控制BLD（电池电量检测器）的操作。当DBLD位设置为“1”时，与BLD相关的电路复位并关闭。

•DXTSP（位4）
ML610Q411/Q412:DXTSP位用于控制32kHz振荡停止检测操作。只有在暂停模式下，当DXTSP位设置为“1”时，与32kHz振荡停止检测相关的电路才会复位并关闭。当工作模式不处于停止状态时，32kHz振荡停止检测始终工作，无论该位的状况如何。
ML610Q411C/ML610Q415:无论该位的状况如何，32kHz振荡停止检测电路始终处于禁用状态。

*ML610Q411PA有一个不同的规格，当DXTSP位设置为“1”时，与32kHz振荡停止检测相关的电路复位并关闭（禁用），无论CPU是否处于停止模式。
•DRAD（位1）
DRAD位用于控制RC型A/D转换器的工作。当DRAD位设置为“1”时，与RC型A/D转换器相关的电路复位并关闭

•DSAD（位0）
DSAD位用于控制SA型A/D转换器的工作。当DSAD位设置为“1”时，与SA型A/D转换器相关的电路复位并关闭

注：
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
有关LCD驱动器操作的详细信息，请参阅第26章“LCD驱动器”。
有关BLD操作的详细信息，请参阅第27章“电池电量检测器”。
32kHz振荡停止检测器的操作详见第3章“复位功能”。
有关RC振荡型A/D转换器的操作细节，请参阅第24章“RC振荡型A/D转换器”。SA型A/D转换器的工作原理详见第25章“逐次逼近法”。

##### 4.3.1 程序运行模式

程序运行模式是CPU顺序执行指令的状态。
在上电复位、复位引脚复位、低速振荡停止检测复位或WDT溢出复位时，CPU在释放系统复位模式后，从程序存储器（ROM）的地址0002H和0003H中设置的地址执行指令。
在通过BRK指令复位时，CPU执行来自在释放系统复位模式之后在程序存储器的地址0004H和0005H中设置的地址的指令。然而，当在执行BRK指令时（在发生WDT中断或NMI中断之后），程序状态字（PSW）的中断电平位（ELEVEL）的值为02H或更高时，CPU执行来自在地址0002H和0003H中设置的地址的指令。
有关BRK指令和PSW的详细信息，请参阅“nX-U8/100 Core指令手册”，有关复位功能，请参阅第3章“复位功能”。

##### 4.3.2 停机模式

暂停模式是CPU中断指令执行，只有外围电路在运行的状态。
当备用控制寄存器（SBYCON）的HLT位设置为“1”时，将设置暂停模式。
当发出NMI中断请求、WDT中断请求或中断启用寄存器（IE1–IE7）启用的中断请求时，HLT位在下一个系统时钟（SYSCLK）的下降沿设置为“0”，停止模式返回到程序运行模式。
图4-2显示了停止模式下的操作波形。

图片 PDF 56页

注：
由于在暂停模式释放和转换到中断处理之间的时间段内最多执行两条指令，因此将两条NOP指令放在将HLT位设置为“1”的指令旁边。

##### 4.3.3 停止模式
ML610Q411/ML610Q412/ML610Q415用户手册第4章MCU控制功能
停止模式是指低速振荡和高速振荡停止，CPU和外围电路停止工作的状态。
当通过将“5nH”（n：任意值）和“0AnH”（n：任意值）顺序写入停止码接收器（STPACP）来启用停止码接收器，并且备用控制寄存器（SBYCON）的STP位设置为“1”时，进入停止模式。设置停止模式时，停止代码接收器被禁用。
当发出NMI中断请求或中断启用（中断启用标志为“1”）P00至P003中断请求时，STP位设置为“0”，停止模式被释放，模式返回到程序运行模式。

##### 4.3.3.1 CPU低速时钟运行时的停止模式
当停止码接收器处于启用状态并且SBYCON的STP位设置为“1”时，进入停止模式，停止低速振荡和高速振荡。
当发出NMI中断请求或中断启用（中断启用标志为“1”）P00至P03中断请求时，STP位设置为“0”，低速振荡重新启动。如果高速时钟在进入停止模式之前振荡，则高速振荡将重新启动。当进入停止模式前高速时钟没有振荡时，高速振荡不会开始。
当发生中断请求时，在经过低速振荡开始时间（TXTL）和低速时钟（LSCLK）振荡稳定时间（8192脉冲计数）之后释放停止模式，该模式返回到编程模式，并且低速时钟（LSCLK）重新开始向外围电路供电。如果此时高速时钟已经开始振荡，高速时钟（OSCLK和HSCLK）也会重新开始向外围电路供电。
关于低速振荡开始时间（TXTL），见附录C中的“电气特性”部分。图4-3显示了CPU与低速时钟一起运行时，停止模式下的运行波形。

图在 PDF 57 页

##### 4.3.3.2 CPU高速时钟运行时的停止模式

当CPU在高速时钟下运行，且SBYCON的STP位设置为“1”且停止码接收器启用时，进入停止模式，高速振荡和低速振荡停止。
当发出NMI中断请求或中断启用（中断启用标志为“1”）P00至P03中断请求时，STP位设置为“0”，低速和高速振荡重新启动。
当发出中断请求时，在经过高速振荡开始时间（TRC）和高速时钟（OSCLK）振荡稳定时间（8192脉冲计数）之后释放停止模式，模式返回到程序运行模式，并且高速时钟（OSCLK和HSCLK）重新开始向外围电路供电。
在经过低速振荡开始时间（TXTL）和低速时钟（LSCLK）振荡稳定时间（8192计数）之后，低速时钟（LSCLK）重新开始向外围电路供电。
有关高速振荡开始时间（TRC）和低速振荡开始时间（TXTL），请参阅附录C中的“电气特性”部分。
图4-4显示了CPU与高速时钟一起工作时，停止模式下的操作波形。

图片 PDF 58 页

注：
在将STP位设置为“1”的指令之后的两个周期内进入停止模式，并且在停止模式释放和转换到中断处理之间的期间执行最多两条指令。因此，在将STP位设置为“1”的指令旁边放置两条NOP指令

##### 4.3.3.3 停止/停止模式返回操作的注意事项

从停止模式和停止模式返回的操作根据程序状态字（PSW）的中断级别（ELEVEL）、主中断启用标志（MIE）、中断启用寄存器（IE0到IE3）的内容以及中断是不可屏蔽中断还是可屏蔽中断而变化。
有关PSW以及IE和IRQ寄存器的详细信息，请分别参阅“nX-U8/100 Core指令手册”和第5章“中断”。
表4-1和表4-2显示了停止/停止模式的返回操作。

图片 PDF 59页

笔记：
•如果ELEVEL位为0H，则表示CPU既没有执行不可中断处理，也没有执行
可屏蔽中断处理或软件中断处理。
•如果ELEVEL位为1H，则表示CPU正在执行可屏蔽中断处理或软件中断
处理。（ELEVEL在中断转换周期期间设置。）
•如果ELEVEL位为2H，则表示CPU正在执行不可屏蔽的中断处理。（设置标高
在中断转换周期期间。）
•如果ELEVEL位为3H，则表示CPU正在执行针对模拟器的中断处理。这个
正常应用程序中不允许设置。

##### 4.3.4 闭塞控制功能

这种大规模集成电路具有块控制功能，可以重置和完全关闭未使用的外围设备的操作电路，从而进一步降低电流消耗。
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
BLKCON0寄存器控制（禁用/启用）定时器0、定时器1、定时器2和定时器3的操作。BLKCON1寄存器控制（禁用/启用）捕捉、1kHz定时器和PWM的操作。BLKCON2寄存器控制（禁用/启用）I2C、UART和SSIO的操作。
BLKCON3寄存器控制（禁用/启用）旋律/蜂鸣器的操作。
BLKCON4寄存器控制（禁用/启用）LCD驱动器、电池电量检测器、32kHz振荡停止检测器、RC型A/D转换器和SAR型A/D转换器的操作。
注：
BLKCON4寄存器的DXTSP位（第4位）仅在停止模式下禁用32kHz振荡停止检测器的操作。各外围设备的操作及相关注意事项详见各章。
*ML610Q411PA有一个不同的规格，当DXTSP位设置为“1”时，与32kHz振荡停止检测相关的电路复位并关闭（禁用），无论CPU是否处于停止模式。

## 第5章 中断

##### 5.1 楷述

此LSI有25个中断源（外部中断：5个源，内部中断：20个源）和一个软件中断（SWI）。
有关每个中断的详细信息，请参阅以下章节：

第7章，“时基计数器”第9章，“1 kHz定时器”第10章，“定时器”
第11章，“PWM”
第12章，“看门狗定时器”
第13章，“同步串口”
第14章，“通用异步收发器”
第15章，“I2C总线接口”
第16章，“NMI”
第17章，“端口0”
第24章，“RC振荡型A/D转换器”
第25章，“逐次逼近型A/D转换器”

##### 5.1.1 特征
•2个不可屏蔽中断源（内部源：1，外部源：1）

•19个可屏蔽中断源（内部源：15，外部源：4）

•软件中断（SWI）：最多64个源。
•外部中断允许边缘选择和采样选择。

##### 5.2.1 寄存器列表

图 PDF 63页

##### 5.2.2 中断启用寄存器1（IE1）

IE1是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE1的相应标志不复位。
[位描述]

•EP00（位0）
EP00是输入端口P00引脚中断（P00INT）的启用标志。

•EP01（位1）
EP01是输入端口P01引脚中断（P01INT）的启用标志。

•EP02（位2）
EP02是输入端口P02引脚中断（P02INT）的启用标志。

• EP03 (位 3)
 EP03 is the enable flag for the input port P03 pin interrupt (P03INT).

EP03是输入端口P03引脚中断(P03INT)的启用标志。

##### 5.2.3 中断启用寄存器2（IE2）

IE2是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE2的相应标志不复位。
[位描述]

•ESIO0（位0）
ESIO0是同步串行端口0中断（SIO0INT）的启用标志

•ESAD（位2）
ESAD是逐次逼近型A/D转换器中断（SADINT）的启用标志。

•EI2C0（位7）
EI2C0是I2C总线0中断（I2C0INT）的启用标志。

##### 5.2.4 中断启用寄存器3 （IE3）

E3是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE3的相应标志不复位。
[位描述]

•ETM0（位0）
ETM0是定时器0中断（TM0INT）的启用标志。

•ETM1（位1）
ETM1是定时器1中断（TM1INT）的启用标志。

##### 5.2.5 中断启用寄存器4 （IE4）

IE4是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE4的相应标志不复位。
[位描述]

•EUA0（位0）
EUA0是UART0中断（UA0INT）的启用标志。

•ERAD（位5）
ERAD是RC振荡型A/D转换器中断（RADINT）的启用标志。



##### 5.2.6 中断启用寄存器5 （IE5）

IE5是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE5的相应标志不复位。
[位描述]

•ETM2（位4）
ETM2定时器2中断（TM2INT）的启用标志。

•ETM3（位5）
ETM3定时器3中断的启用标志（TM3INT）



##### 5.2.7 中断启用寄存器6 （IE6）

IE6是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE6的相应标志不复位。
[位描述]

•EPW0（位0）
EPW0是PWM0中断（PW0INT）的启用标志

•ET1K（位4）
ET1K是1kHz定时器中断（T1KINT）的启用标志

•E128H（位5）
E128H是时基计数器128 Hz中断（T128H）的启用标志

•E32H（位7）
E32H是时基计数器32 Hz中断（T32HINT）的启用标志

##### 5.2.8 中断启用寄存器7 （IE7）

IE7是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE7的相应标志不复位。
[位描述]

•E16H（位0）
E16H是时基计数器16 Hz中断（T16HINT）的启用标志

•E2H（位3）
E2H是时基计数器2 Hz中断（T2HINT）的启用标志。

##### 5.2.9 中断请求寄存器0 （IRQ0）

IRQ0是一个特殊的函数寄存器（SFR），用于请求每个中断源的中断。
看门狗定时器中断（WDTINT）和NMI中断（NMINT）是不依赖MIE的不可屏蔽中断。在这种情况下，无论掩码中断启用标志（MIE）的值是多少，都会向CPU请求中断。
生成中断时，无论MIE值如何，每个IRQ0请求标志都设置为“1”。通过软件将IRQ0请求标志设置为“1”，可以生成中断。
当中断请求被CPU接受时，硬件将IRQ0的相应标志设置为“0”。
[位描述]

•QWDT（位0）
QWDT是看门狗定时器中断（WDTINT）的请求标志。

•QNMI（位1）
QNMI是NMI中断（NMINT）的请求标志。

注：
当向中断请求寄存器（IRQ0）写入指令生成中断时，中断移位周期在执行下一条1指令后开始。

##### 5.2.10 中断请求寄存器1 （IRQ1）

IRQ1是一个特殊功能寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE1和MIE值如何，每个IRQ1请求标志都设置为“1”。在这种情况下，当中断使能寄存器（IE1）的相关标志设置为“1”并且主中断使能标志（MIE）设置为“1”时，向CPU请求中断。
通过软件将IRQ1请求标志设置为“1”，可以生成中断。
当CPU接受中断请求时，硬件将IRQ1的相应标志设置为“0”。
[位描述]

•QP00（位0）
QP00是输入端口P00引脚中断（P00INT）的请求标志。

•QP01（位1）
QP01是输入端口P01引脚中断（P01INT）的请求标志。

•QP02（位2）
QP02是输入端口P02引脚中断（P02INT）的请求标志

•QP03（位3）
QP03是输入端口P03引脚中断（P03INT）的请求标志。

注：
当向中断请求寄存器（IRQ1）或中断启用寄存器（IE1）写入指令生成中断时，中断移位周期在执行下一条指令后开始。

##### 5.2.11 中断请求寄存器2 （IRQ2）

IRQ2是一个特殊的函数寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE2和MIE值如何，每个IRQ2请求标志都设置为“1”。在这种情况下，当中断使能寄存器（IE2）的相关标志设置为“1”并且主中断使能标志（MIE）设置为“1”时，向CPU请求中断。
通过软件将IRQ2请求标志设置为“1”，可以生成中断。
当中断请求被CPU接受时，硬件将IRQ2的相应标志设置为“0”。
[位描述]

•QSIO0（位0）
QSIO0是同步串行端口0中断（SIO0INT）的请求标志。

•QSAD（第2位）
QSAD是连续近似A/D转换器中断（SADIT）的请求标志

•QI2C0（位7）
QI2C0是I2C总线0中断（I2C0INT）的请求标志。

注：
当向中断请求寄存器（IRQ2）或中断启用寄存器（IE2）写入指令生成中断时，中断移位周期在执行下一条1指令后开始。

#####  5.2.12 中断请求寄存器3 （IRQ3）

IRQ3是一个特殊的函数寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE3和MIE值如何，每个IRQ3请求标志都设置为“1”。在这种情况下，当中断启用寄存器（IE3）的相关标志被设置为“1”并且主中断启用标志（MIE）被设置为“1”时，中断被请求到CPU。
通过软件将IRQ3请求标志设置为“1”，可以生成中断。
当CPU接受中断请求时，硬件将IRQ3的相应标志设置为“0”。
[位描述]

•QTM0（位0）
QTM0是定时器0中断（TM0INT）的请求标志。

•QTM1（位1）
QTM1是定时器1中断（TM1INT）的请求标志。

注：
当向中断请求寄存器（IRQ3）或中断启用寄存器（IE3）写入指令生成中断时，中断移位周期在执行下一条1指令后开始。

##### 5.2.13 中断请求寄存器4 （IRQ4）

IRQ4是一个特殊的函数寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE4和MIE值如何，每个IRQ4请求标志都设置为“1”。在这种情况下，当中断启用寄存器（IE4）的相关标志被设置为“1”并且主中断启用标志（MIE）被设置为“1”时，中断被请求到CPU。
通过软件将IRQ4请求标志设置为“1”，可以生成中断。
当CPU接受中断请求时，硬件将IRQ4的相应标志设置为“0”。
[位描述]

•QUA0（位0）
QUA0是UART0中断（UA0INT）的请求标志。

•QRAD（位5）
QRAD是RC振荡型A/D转换器中断（RADINT）的请求标志。

注：
当向中断请求寄存器（IRQ4）或中断启用寄存器（IE4）写入指令生成中断时，中断移位周期在执行下一条1指令后开始。

##### 5.2.14 中断请求寄存器5 （IRQ5）

IRQ5是一个特殊功能寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE5和MIE值如何，每个IRQ5请求标志都设置为“1”。在这种情况下，当中断启用寄存器（IE5）的相关标志被设置为“1”并且主中断启用标志（MIE）被设置为“1”时，中断被请求到CPU。
通过软件将IRQ5请求标志设置为“1”，可以生成中断。
当CPU接受中断请求时，硬件将IRQ5的相应标志设置为“0”。
[位描述]

•QTM2（位5）
QTM2是定时器2中断（TM2INT）的请求标志。

•QTM3（位6）
QTM3是定时器3中断（TM3INT）的请求标志。

注：
当向中断请求寄存器（IRQ5）或中断启用寄存器（IE5）写入指令产生中断时，中断移位周期在执行下一条1指令后开始。



##### 5.2.15 中断请求寄存器6 （IRQ6）

IRQ6是一个特殊功能寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE6和MIE值如何，每个IRQ6请求标志都设置为“1”。在这种情况下，当中断使能寄存器（IE6）的相关标志设置为“1”并且主中断使能标志（MIE）设置为“1”时，向CPU请求中断。
通过软件将IRQ6请求标志设置为“1”，可以生成中断。
当中断请求被CPU接受时，硬件将IRQ6的相应标志设置为“0”。
[位描述]

•QPW0（位0）
QPW0是PWM0中断（PW0INT）的请求标志。

•QT1K（位4）
QT1K是1khz定时器中断（T1KINT）的请求标志。

•Q128H（位5）
Q128H是时基计数器128 Hz中断（T128H）的请求标志。

•Q32H（位7）
Q32H是时基计数器32赫兹中断（T32HINT）的请求标志

注：
当向中断请求寄存器（IRQ6）或中断启用寄存器（IE6）写入指令生成中断时，中断移位周期在执行下一条1指令后开始。

##### 5.2.16 中断请求寄存器7 （IRQ7）

IRQ7是一个特殊的功能寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE7和MIE值如何，每个IRQ7请求标志都设置为“1”。在这种情况下，当中断启用寄存器（IE7）的相关标志被设置为“1”并且主中断启用标志（MIE）被设置为“1”时，中断被请求到CPU。
通过软件将IRQ7请求标志设置为“1”，可以生成中断。
当中断请求被CPU接受时，硬件将IRQ7的相应标志设置为“0”。
[位描述]

•Q16H（位0）
Q16H是时基计数器8赫兹中断（T8HINT）的请求标志。

•Q2H（位3）
Q2H是时基计数器2赫兹中断（T2HINT）的请求标志。

注：
当写入中断请求寄存器（IRQ7）或中断启用寄存器（IE7）的指令生成中断时，中断移位周期在执行下一条1指令后开始。

##### 5.3 操作说明

除看门狗定时器中断（WDTINT）和NMI中断（NMINT）外，19个源的中断启用/禁用由主中断启用标志（MIE）和单个中断启用寄存器（IE1至7）控制。WDTINT和NMIINT是不可屏蔽的中断。
当中断条件满足时，CPU从为每个中断源确定的向量表中调用分支目标地址，并且中断移位周期开始分支到中断处理例程。表5-1列出了中断源。

图 如下5-1 PDF 79页

注：
-当同时生成多个中断时，根据该优先级为中断提供服务，低优先级中断的处理挂起。
-请为所有未使用的中断定义向量表以防故障。

##### 5.3.1 可屏蔽中断处理

当MIE标志设置为“1”时产生中断，硬件执行以下处理，程序处理转移到中断目的地。

（1） 将程序计数器（PC）传输到ELR1。（2） 将CSR传输到ECSR1。
（3） 将PSW转移到PSW1。
（4） 将MIE标志设置为“0”。
（5） 将ELEVEL字段设置为“1”。
（6） 将中断起始地址加载到PC机中。

##### 5.3.2 不可屏蔽中断处理

当产生中断时，不管MIE标志的状态如何，由硬件执行以下处理，并且程序的处理转移到中断目的地。

（1） 将PC传输到ELR2。
（2） 将CSR传输到ECSR2。
（3） 将PSW传输到EPSW2。
（4） 将ELEVEL字段设置为“2”。
（5） 将中断起始地址加载到PC机中

##### 5.3.3 软件中断处理

在应用程序中根据需要生成软件中断。当在程序内执行SWI指令时，生成软件中断，由硬件执行以下处理，并且
处理程序移到中断目的地。
（1） 将PC传输到ELR1。
（2） 将CSR传输到ECSR1。
（3） 将PSW传输到EPSW1。
（4） 将MIE标志设置为“0”。
（5） 将ELEVEL字段设置为“1”。
（6） 将中断起始地址加载到PC机中。
向量表由SWI指令指定。
参考文献：
有关MIE标志、程序计数器（PC）、CSR、PSW和ELEVEL，请参阅“nX-U8/100 Core说明手册”。

##### 5.3.4 中断程序的注意事项

注释在编程中是不同的，这取决于程序在执行中断例程时是否调用子例程，是否启用或禁用多个中断，以及这些中断是可屏蔽的还是不可屏蔽的。
状态A:正在处理可屏蔽中断
A-1：当程序在执行中断程序时没有调用子程序时A-1-1：当多个中断被禁用时
•中断例程执行开始后立即处理，无特定注释。
•中断例程执行结束时的处理
指定RTI指令，将ELR寄存器的内容返回PC，将EPSW寄存器的内容返回PSW。
A-1-2：启用多个中断时
•中断例程执行开始后立即处理
指定“PUSH ELR，EPSW”将中断返回地址和PSW状态保存在堆栈中。•中断例程执行结束时的处理
指定“POP PC，PSW”而不是RTI指令，以将堆栈的内容返回给PC和PSW。

图片 PDF81页

A-2：当程序在执行中断程序时调用子程序时

A-2-1：当多个中断被禁用时

•中断例程执行开始后立即处理
指定“PUSH LR”指令将子程序返回地址保存在堆栈中。

•中断例程执行结束时的处理
在将子程序返回地址返回到LR之后，在RTI指令之前指定“POP LR”，以便从中断处理返回。

A-2-2：启用多个中断时
•中断例程执行开始后立即处理
指定“PUSH LR，ELR，EPSW”保存中断返回地址、子程序返回地址和
堆栈中的EPSW状态。
•中断例程执行结束时的处理
指定“POP PC，PSW，LR”代替RTI指令，将中断返回地址的保存数据返回到PC，EPSW的保存数据返回到PSW，LR的保存数据返回到LR。

图 PDF 82页

状态B: 正在处理不可屏蔽中断

B-1：中断程序中没有执行指令时
•中断例程执行开始后立即处理
指定RTI指令，将ELR寄存器的内容返回PC和EPSW寄存器的内容
到PSW。

B-2：在中断程序中执行一条或多条指令时
B-2-1：当程序在执行中断程序时没有调用子程序时

•中断程序执行开始后立即处理
指定“PUSH ELR，EPSW”将中断返回地址和PSW状态保存在堆栈中。

•中断例程执行结束时的处理
指定“POP PC，PSW”而不是RTI指令，以将堆栈的内容返回给PC和PSW。

B-2-2：当程序在执行中断程序时调用子程序时
•中断例程执行开始后立即处理
指定“PUSH LR，ELR，EPSW”以在堆栈中保存中断返回地址、子例程返回地址和EPSW状态。
•中断例程执行结束时的处理
指定“POP PC，PSW，LR”代替RTI指令，将中断返回地址的保存数据返回到PC，EPSW的保存数据返回到PSW，LR的保存数据返回到LR。

图片 PDF 83页

##### 5.3.5 中断禁用状态

即使满足中断条件，根据操作状态，也可能不接受中断。这称为中断禁用状态。请参阅下面的中断禁用状态和在此状态下的中断处理。
中断禁用状态1：在中断移位周期和中断例程开始时的指令之间
当满足本节中的中断条件时，在中断例程的开始处执行指令后，立即生成与已启用的中断相对应的中断。
中断禁用状态2：在DSR前缀指令和下一条指令之间
当满足本节中的中断条件时，在执行DSR前缀指令之后的指令后立即生成中断。
参考文献：
有关DSR前缀指令，请参阅“nX-U8/100 Core指令手册”。

## 第六章 时钟产生电路

##### 6.1 楷述

时钟产生电路产生并提供低速时钟（LSCLK）、2×低速时钟（LSCLK2）、高速时钟（HSCLK）、系统时钟（SYSCLK）和高速输出时钟（OUTCLK）。LSCLK、LSCLK×2和HSCLK是用于外围电路的时基时钟，SYSCLK是CPU的基本操作时钟，OUTCLK是从端口输出的时钟。
有关OUTCLK输出端口，请参阅第19章“端口2”。此外，对于本章中描述的停止模式，请参阅第4章“MCU控制功能”，对于BLD，请参阅第27章“电池电量检测电路”。

##### 6.1.1 特征

•低速时钟：32.768 kHz晶体振荡模式ML610Q411/ML610Q412：
−32.768kHz晶体振荡模式
−能够生成LSCLK×2（64 kHz），用于某些外围设备。ML610Q411/ML610Q412：
−500kHz RC振荡模式的1/16（31.25kHz）
−能够产生LSCLK×2（62.5kHz），用于某些外围设备。•高速时钟：软件选择
−500 kHz RC振荡模式
−外部时钟输入模式（ML610Q415上不可用）

##### 6.1.2 配置

图6-1显示了时钟生成电路的配置

图 PDF 86 页

FCON0：频率控制寄存器0
FCON1：频率控制寄存器1
*1:不用于ML610Q415
*2:SYSCLK在ML610Q415上固定到HSCLK

注：
该LSI在通电或系统复位后，用500 kHz RC振荡频率除以8生成的时钟开始工作。在通过软件初始化时，设置FCON0或FCON1寄存器以将时钟切换到所需的时钟。在没有提供低速时钟的情况下，ML610Q411/ML610Q412的工作不受保证。

##### 6.1.3 引脚列表

---

XT0   连接低速时钟晶体的引脚

----

XT1   连接低速时钟晶体的引脚（ML610Q415上未连接）

---

P10/OSC0    外部高速时钟输入引脚用于P10引脚的辅助功能（外部时钟输入在ML610Q415上不可用）

---

##### 6.2.1 寄存器列表

---

0F002H   频率控制寄存器0

---

0F003H  频率控制寄存器1

---

##### 6.2.2 频率控制寄存器0（FCON0）

FCON0是一种特殊的功能寄存器（SFR），用于控制高速时钟产生电路和选择系统时钟。
[位描述]
•SYSC1、SYSC0（位1、0）
SYSC1和SYSC0位用于选择用于系统时钟和外围电路（包括高速时基计数器）的高速时钟（HSCLK）的频率。可选择OSCLK、1/2OSCLK、1/4OSCLK或1/8OSCLK。该LSI的系统时钟（SYSCLK）的最大工作频率保证为500kHz。系统复位时，选择1/8OSCLK。

•OSCM0（位2）
OSCM0位用于选择高速时钟产生电路的模式。
可选择外部时钟输入模式。
只有在停止高速振荡时（FCON1的ENOSC位为“0”），才能更改OSCM0的设置。系统复位时，选择RC振荡模式。
模式固定为RC振荡模式，读取ML610Q415时，该位始终返回“0”。

•输出C1、输出C0（位5、4）
OUTC1和OUTC0位用于选择高速输出时钟的频率，该时钟在使用端口的辅助功能时输出。
可选择OSCLK、1/2OSCLK、1/4OSCLK或1/8OSCLK。
系统复位时，选择1/8OSCLK。

注：
−要使用OSCM0位切换高速时钟生成电路的模式，请停止高速振荡
并将系统时钟设置为低速时钟（将FCON1的ENOSC位和SYSCLK设置为“0”）。
−该LSI的系统时钟（SYSCLK）的最大保证工作频率为500kHz。连接到P10/OSC0引脚的外部时钟不得超过500kHz。有关规范的更多详细信息，请参阅
附录C，“电气特性”



##### 6.2.3 频率控制寄存器1（FCON1）

FCON1是一种特殊的功能寄存器（SFR），用于控制高速时钟产生电路和选择系统时钟。
[位描述]

•SYSCLK（位0）
SYSCLK位用于选择系统时钟。它允许使用FCON0的高速时钟频率选择位（SYSC1，0）选择低速时钟（LSCLK）或高速时钟（1/nOSCLK:n=1、2、4、8）。
当高速时钟的振荡停止（ENOSC bit=“0”）时，SYSCLK位固定为“0”，系统时钟选择低速时钟（LSCLK）。
系统时钟固定为HSCLK，读取ML610Q415时，该位始终返回“1”。

•ENOSC（位1）
ENOSC位用于选择启用/禁用高速时钟振荡器的振荡。
在停止模式下，高速时钟的振荡总是enable exept，在ML610Q415上读取时，该位总是返回“1”。

•ENMLT（位2）
ENMLT位用于选择启用/禁用2×低速时钟（LSCLK×2）的操作。

##### 6.3.1.1 低速时钟产生电路

图6-2显示了低速时钟生成电路的配置。 图显示在 PDF 91页

ML610Q411/ML610Q412：
低速时钟产生电路配备有外部32.768khz晶体。要使用微调电容器匹配振荡频率，请根据需要连接外部电容器（CGL和CDL）。
在停止模式下，VDDX断电以停止低速振荡，XT0和XT1引脚变为Hiz（高阻抗状态）。当FCON1的ENMLT位设置为“1”时，2×低速时钟电路开始产生LSCLK×2（64kHz）。
ML610Q415：
LSCLK由高速时钟产生电路和1/16器件产生。不需要外部晶体振荡器。在停止模式下，高速时钟振荡停止。当FCON1的ENMLT位设置为“1”时，2×低速时钟电路开始产生LSCLK×2（62.5kHz）。

笔记：
−在尽可能靠近LSI的地方安装一个晶体，并确保引起噪声的信号和电源接线正常
不要靠近水晶和它的接线。
−注意，振荡可能因冷凝而停止

##### 6.3.1.2 低速时钟产生电路的操作

ML610Q411/ML610Q412：
低速时钟产生电路通过上电复位激活。
在通电后经过低速振荡开始周期（TXTL）和振荡稳定周期（8192计数）之后，向外围电路提供低速时钟（LSCLK）。
低速时钟产生在停止模式下停止振荡。当通过外部中断释放停止模式来恢复振荡时，在经过低速振荡开始周期（TXTL）和低速时钟（LSCLK）振荡稳定周期之后，向外围电路提供LSCLK。停止模式见第4章“MCU控制功能”。
图6-3-1显示了低速时钟产生电路的波形。低速振荡开始时间（TXTL）见附录C“电气特性”。

图 PDF 92页

注：
打开电源后，CPU开始以高速时钟（500 kHz RC振荡）运行。建议在通过检查低速时基计数器的128 Hz中断请求位（Q128H）是否为“1”来确认低速时钟正在振荡后，切换到低速时钟。如果在低速时钟振荡之前切换时钟，CPU将停止运行，直到低速时钟开始振荡。

ML610Q415：
低速时钟（LSCLK）与高速时钟（HSCLK）同时开始供电。有关高速时钟生成的详细信息，请参阅第6.3.2章“高速时钟”。
低速时钟产生电路以停止模式停止振荡。当通过外部中断释放停止模式来恢复振荡时，在经过低速振荡开始周期（TRC）和高速时钟（HSCLK）振荡稳定周期（128计数）之后，HSCLK和LSCLK同时被提供给外围电路。停止模式见第4章“MCU控制功能”。图6-3-2显示了低速时钟产生电路的波形。低速振荡开始时间（TXTL）见附录C“电气特性”。

##### 6.3.2 高速时钟

频率控制寄存器0（FCON0）的OSCM0位的设置允许为高速时钟产生电路选择500 kHz RC振荡模式或外部时钟输入模式。

##### 6.3.2.1 500 kHz RC振荡

在RC振荡模式（OSCM0=“0”）下，当振荡启动后RC振荡时钟脉冲计数达到128（ENOSC设置为“1”）时，启动OSCLK（高速振荡时钟）的供电。
在500 kHz RC振荡模式下，P10/OSC0引脚都可用作通用输入端口。
图6-4显示了RC振荡模式下的电路配置。

笔记：
−RC振荡模式允许在VDD=1.3 V至3.6 V的范围内。
−系统复位模式解除后，在RC振荡时钟脉冲计数达到8192后，OSCLK开始供电。
停止模式解除后，OSCLK开始供电。

##### 6.3.2.2 外部时钟输入模式

在外部时钟输入模式下，外部时钟从P10/OSC0引脚输入。图6-5显示了外部时钟输入模式下的电路配置。

笔记：
−外部时钟输入模式在ML610Q415上不可用。
−外部时钟输入模式可在1.8 V至3.6 V的VDD范围内使用。根据需要选择频率
使用电源电压检测电路（BLD）确定工作电压范围。
−由于二极管包括在P10/OSC0引脚和VDD之间以及P10/OSC0引脚和VSS之间，因此不要
向P10/OSC0引脚施加高于VDD和低于VSS的电压。
−如果P10/OSC0引脚在外部时钟输入模式下保持打开，则可能会产生过大电流。因此，确保
输入“H”电平（VDD）或“L”电平（VSS）。
−该LSI的系统时钟（SYSCLK）的最大保证工作频率为500kHz。外部
连接到P10/OSC0引脚的时钟不得超过500kHz。有关规范的更多详细信息，请参见附录C“电气特性”

##### 6.3.2.3高速时钟产生电路的操作

通过上电复位产生，在500Hz RC振荡模式下激活高速时钟产生电路。
由于上电复位的发生，电路进入系统复位模式，然后在经过高速振荡时钟（OSCLK）的高速RC振荡开始时间（TRC）和振荡稳定时间（计数：8192）之后，切换到程序操作模式，同时，向外围电路提供高速时钟（HSCLK）。
图6-6显示了上电时高速时钟产生电路的波形。图 PDF 96页
振荡开始时间（TRC），见附录C“电气特性”。

高速时钟产生电路允许通过使用频率控制寄存器0和1（FCON0和FCON1）来选择振荡模式和振荡的开始/停止。
在FCON0中选择高速振荡模式和高速振荡频率后，可以通过将ENOSC位设置为“1”来启动振荡。在振荡开始之后，HSCLK在高速振荡时钟的高速振荡开始周期（TRC）和振荡稳定周期之后开始向外围电路提供时钟。
高速时钟产生电路以停止模式停止振荡。当通过外部中断释放停止模式时，HSCLK在高速时钟的高速振荡开始周期（TRC）和振荡稳定周期过后向外围电路提供时钟。振荡稳定周期是128个时钟脉冲的持续时间。

图6-7显示了晶体/陶瓷振荡模式下高速时钟产生电路的波形。 图PDF 97页

##### 6.3.3 系统时钟切换

通过使用频率控制寄存器（FCON0、FCON1），可以在高速时钟（HSCLK）和低速时钟（LSCLK）之间切换系统时钟。此功能在ML610Q415上不可用。
图6-8显示了系统时钟切换处理流程（HSCLK→LSCLK），图6-11显示了系统时钟切换处理流程（LSCLK→HSCLK）。

注：
−ML610Q415上没有将HSCLK切换到LSCLK的功能。
−电源接通后或系统时钟从HSCLK切换到LSCLK后
从停止模式返回，CPU变为非活动状态，直到LSCLK开始向外围电路提供时钟。因此，建议在通过检查时基计数器中断请求位（Q128H）是否为“1”来确认LSCLK正在振荡之后，切换到LSCLK。

图  PDF 99页

注：
−ML610Q415上没有将HSCLK切换到LSCLK的功能。
−如果系统时钟在高速时钟之前从低速时钟切换到高速时钟
（HSCLK）开始振荡，CPU变为非活动状态，直到HSCLK开始向外围电路提供时钟。

##### 6.4 指定端口寄存器

当您想确保时钟输出功能正常工作时，请检查是否指定了相关的端口寄存器。有关端口寄存器的详细信息，请参阅第20章“端口2”

##### 6.4.1 作为高速时钟输出的P21（OUTCLK）功能

将P21MD位（P2MOD寄存器的位1）设置为“1”，以指定高速时钟输出作为P21的辅助功能。

将P21C1位（P2CON1寄存器的位1）设置为“1”，将P21C0位（P2CON0寄存器的位1）设置为“1”，以将P21指定为CMOS输出。

P21D位（P2D寄存器的位1）的数据对高速时钟输出功能没有影响，因此不关心该功能的数据。

-：位不存在。
*：位与高速时钟功能无关

**：不关心数据。

注：
P21（端口2）是一个仅输出端口，没有用于选择数据方向（输入或输出）的寄存器。

##### 6.4.2将P22（LSCLK）用作低速时钟输出

将P22MD位（P2MOD寄存器的位2）设置为“1”，以将低速时钟输出指定为P22的辅助功能。

将P22C1位（P2CON1寄存器的位2）设置为“1”，将P22C0位（P2CON0寄存器的位2）设置为“1”，以将P22指定为CMOS输出。

P22D位（P2D寄存器的bit2）的数据对低速时钟输出功能没有影响，因此不关心该功能的数据。

-：位不存在。
*：位与低速时钟功能无关

**：不关心数据。

注：
P22（端口2）是一个仅输出端口，没有用于选择数据方向（即输入或输出）的寄存器。

## 第7章 时基计数器

##### 7.1 楷述

该LSI包括一个低速时基计数器（LTBC）和一个高速时基计数器（HTBC），它们为外围电路生成基频。通过使用时基计数器，可以周期性地生成事件。
有关输入时钟，请参阅第6章“时钟生成电路”。有关本章中描述的中断许可、中断请求标志等，请参阅第5章“中断”。

##### 7.1.1 特征

•LTBC通过划分低速时钟（LSCLK）频率产生T32KHZ至T1HZ信号。
•HTBC通过划分高速时钟（HSCLK）频率生成HTB1至HTB32信号。
•LTBC允许频率调整（调整范围：约−488ppm至+488ppm。调整精度：
使用低速时基计数器频率调整寄存器（LTBADJH和
LTBADJL）。(*1)
•能够产生128Hz、32Hz、16Hz和2Hz中断。(*2)
注：
（*1）此功能可用于具有低速晶体振荡时钟的ML610Q411和ML610Q412。（*2）对于ML610Q415，频率将为{122Hz、30.5Hz、15.3Hz和1.9Hz}±RC振荡的温度变化。

##### 7.2 配置

图7-1和图7-2分别显示了低速时基计数器和高速时基计数器的配置。

图 在 PDF 103页

LTBR :  低速时基计数器寄存器
LTBADJL：低速时基计数器频率调整

LTBADJH：低速时基计数器频率调整寄存器

注：
HSCLK的频率根据频率控制寄存器0（FON0）的SYSC1位和SYSC0位中的指定数据而变化

##### 7.2.1 寄存器说明 寄存器列表

图片 PDF 105页

##### 7.2.2 低速时基计数器（LTBR）

LTBR是一个特殊功能寄存器（SFR），用于读取低速时基计数器的T128HZ-T1HZ输出。对LTBR执行写入操作时，T128HZ-T1HZ输出设置为“0”。
注：
TBC中断（128Hz中断、32Hz中断、16Hz中断或2Hz中断）*可能发生，具体取决于LTBR写入定时（见图7-4，“通过写入LTBR的中断定时和复位定时”）。因此，在软件编程时要小心。
（*）对于ML610Q415，频率将为{122Hz、30.5Hz、15.3Hz和1.9Hz}±RC振荡的温度变化。

##### 7.2.3 高速时基计数器除法寄存器（HTBDR）

HTBDR是一个特殊的函数寄存器（SFR），用于设置4位1/n计数器的除法比。
[位描述]
•HTD3-HTD0（位3-0）
HTD3-HTD0位用于设置4位1/n计数器的分频比。可选择的比率包括1/1到1/16。

图 PDF 107页

*1: 表示高速振荡时钟HSCLK为500kHz时的频率。

##### 7.2.4 低速时基计数器频率调整寄存器L和H（LTBADJL、LTBADJH）

LTBADJL和LTBADJH是特殊功能寄存器（sfr），用于设置低速时基时钟的频率调整值。
[位描述]
•LADJS，LADJ9-LADJ8（位2-0）LADJ7-LADJ0（位7-0）
LADJS和LADJ9到LADJ0位用于调整频率。
调整范围：约−488ppm至+488ppm。
调整精度：约0.48ppm
频率调整值（LTBADJH，LTBADJL）与调整率的对应关系见第7.3.3节“低速时基计数器频率调整功能”。

##### 7.3.1 低速时基计数器

系统复位后，低速时基计数器（LTBC）从LSCLK下降沿的0000H开始计数。LTBC的T128HZ、T32HZ、T16HZ和T2HZ输出用作时基中断，并在每个输出的下降沿请求中断。每个LTBC输出还用作外围电路的操作时钟。
LTBC的T128HZ到T1HZ的输出数据可以从低速时基计数器寄存器（LTBR）中读取。读取数据时，读取LTBR两次，并检查两个值是否一致，以防止在计数期间读取未定义的数据。
图7-3显示了读取LTBR的程序示例。 图PDF 109页

执行写入操作时，LTBR复位，T128HZ至T1HZ输出设置为“0”。写入数据无效。由于在写入LTBR期间，如果T128Hz到T1Hz输出中出现下降沿，则会发生中断，因此在软件编程时要小心。
图7-4显示了通过写入LTBR的时基计数器输出的中断生成定时和复位定时。图 PDF 109页

##### 7.3.2 高速时基计数器

高速时基计数器配置为4位1/n计数器（n=1到16）。
在4位1/n计数器中，由高速时基计数器除法寄存器（HTBDR）选择的除法时钟（1/16×HSCLK到1/1×HSCLK）被生成为HTBCLK。HTBCLK用作定时器，也用作PWM的操作时钟。
图7-5显示了HTBCLK的输出波形。

##### 7.3.3 低速时基计数器频率调整功能

频率调整（调整范围：约−488ppm至+488ppm。调整精度：通过使用低速时基计数器频率调整寄存器（LTBADJH和LTBADJL），LTBC的T8KHZ到T1HZ的输出可以达到约0.48ppm）。
表7-1显示了频率调整值（LTBADJH，LTBADJL）与调整比率之间的对应关系。

图片 PDF 111页

可通过使用以下方程式获得要在LTBADJH和LTBADJL中设置的调整值（LADJ10到LADJ0）：
调整值=频率调整率×2097152（十进制）
=频率调整率×200000h（十六进制）
例1：调整时+15.0ppm（获取时间）调整值=+15.0ppm×2097152（十进制）
=+15.0×10−6×2097152=+31.45728（十进制）
≅01Fh（十六进制）
示例2：调整−25.5ppm（损失时间）时，调整值=−25.5ppm×2097152（十进制）
=−25.5×10−6×2097152=−53.477376（十进制）≅7CCh（十六进制）
注：
LTBC的低速时钟（LSCLK）和T32KHZ和T16KHZ的输出不通过频率调整功能进行调整。
频率调整精度不能保证精度，包括温度变化引起的晶体振荡频率变化（32.768kHz）。
该功能可用于具有低速晶体振荡时钟的ML610Q411和ML610Q412。它不能用于ML610Q415，因为ML610Q415使用500kHz RC振荡时钟（31.25kHz）的1/16用于低速时钟（LSCLK），因为与晶体振荡相比，该频率具有显著的温度变化

##### 7.3.4 16位定时器2-3频率测量模式的信号生成

在时基内容块中生成用于16位定时器2-3频率测量模式的信号（437C）。有关频率测量功能的详细信息，请参阅第10章“定时器”。频率测量功能在ML610Q415上不可用。

注：
ML610Q415上没有使用16位定时器2和3的频率测量功能。

## 第八章 捕获

##### 8.1 楷述

此LSI有两个捕获电路通道，用于在发生P00和P01中断时将低速基极计数器（LTBC）的T4KHZ到T32HZ信号捕获到捕获寄存器。电路根据时基计数器的时间捕捉每个中断发生的时间。
有关来自P00或P01引脚的外部中断（P00INT、P01INT），请参阅第5章“中断”和第18章“端口0”。

##### 8.1 特征

时基捕获×2ch（4096Hz至32Hz）

##### 8.1.2 配置

图8-1显示了捕获电路的配置。图 PDF 114页

##### 8.1.3 指针列表

---

P00/CAP0    捕获0输入引脚用作P00引脚的辅助功能。

---

P01/CAP1  捕获1个输入引脚用作P01引脚的辅助功能。

---

##### 8.2.1 寄存器列表

图 PDF 115页

##### 8.2.2  捕获控制寄存器（CAPCON）

CAPCON是一种特殊的功能寄存器（SFR），用于控制捕获电路。
[位描述]

•ECAP0（位0）
ECAP0位用于启动或停止捕获0的操作。

•ECAP1（位1）
ECAP1位用于启动或停止捕获1的操作。

##### 8.2.3 捕获状态寄存器（CAPSTAT）

CAPSTAT是一种特殊的功能寄存器（SFR），用于指示捕获电路的状态。
[位描述]

•CAPF0（位0）
CAPF0位是指示是否在捕获数据寄存器0中捕获数据的标志
（0）或否。
当CAPF0位设置为“1”时，表示在捕获数据寄存器0（CAPR0）中捕获数据。
当CAPF0位设置为“1”时，下一个捕获操作停止。因此，执行写入操作以捕获数据寄存器0（CAPR0），将CAPF0位清除为“0”。

•CAPF1（位1）
CAPF1位是指示是否在捕获数据寄存器0中捕获数据的标志
（1）是否。
当CAPF0位设置为“1”时，表示在捕获数据寄存器0（CAPR1）中捕获数据。
当CAPF1位设置为“1”时，下一个捕获操作停止。因此，执行写入操作以捕获数据寄存器1（CAPR1），将capf0位清除为“0”。

##### 8.2.4 捕获数据寄存器0（CAPR0）

CAPR0是一种存储捕获数据的寄存器。
当将CAPF0标志（CAPSTAT寄存器的位0）设置为“0”生成P00中断请求时，捕获低速时基计数器（LTBC）的T4KHZ至T32HZ信号。
写入CAPR0将CAPSTAT的CAPF0标志设置为“0”。即使数据写入CAPR0，CAPR0的值也不会更改。

##### 8.2.5 捕获数据寄存器1（CAPR1

CAPR1是存储捕获数据的寄存器。
当在CAPF1标志（CAPSTAT寄存器的位1）设置为“0”的情况下生成P01中断请求时，捕获低速时基计数器（LTBC）的T4KHZ至T32HZ信号。
写入CAPR1会将CAPSTAT的CAPF1标志设置为“0”。CAPR1的值即使写入数据也不会改变。

##### 8.3 操作说明

捕获电路通过设置捕获控制寄存器（CAPCON）的ECAP0或ECAP1位来开始捕获操作。
当外部中断控制寄存器0或1（EXICON0或EXICON1）选择的P00或P01引脚的输入触发器生成，且P00或P01中断请求标志（QP00或QP01）设置为“1”时，低速时基计数器（LTBC）的T4KHZ至T32HZ信号被捕捉到捕捉寄存器0或1（CAPR0或CAPR1）上下一个低速时钟（LSCLK）下降沿，同时，捕获状态寄存器（CAPSTAT）的捕获标志（CAPF0或CAPF1）设置为“1”。
当捕获标志（CAPF0，CAPF1）为“1”时，以下捕获操作停止。
读取捕获寄存器0或1（CAPR0，CAPR1）中捕获的值后，对捕获寄存器0或1（CAPR0，CAPR1）执行写入操作（写入数据无意义），将捕获标志（CAPF0，CAPF1）清除为“0”，并等待下一个P00或P01中断。
图8-2显示了捕获操作的计时。图 PDF 120页

注：
当CPU以高速（HSCLK）运行时，在生成P00或P01中断请求后，检查捕获标志（CAPF0，CAPF1）是否设置为“1”，然后读取捕获数据寄存器0或1（CAPR0，CAPR1）。

## 第九章 1kHz定时器（1kHzTM）

##### 9.1 楷述

该LSI包括1 kHz计时器，用于测量1/1000秒。
1kHz定时器对通过除以低速时基计数器（LTBC）的T2KHZ输出频率（*）而产生的1kHz（*）信号进行计数，并产生10Hz或1Hz中断（1kHz定时器中断）。
利用1khz定时器，可以容易地获得1/1000秒，其难以在时基计数器的基础上产生，由十进制数表示。该定时器可用于秒表的周期测量。
关于时基计数器，请参阅第7章“时基计数器”。
（*）ML610Q411/Q412:T2KHZ=2.048kHz，1kHz:1.024kHz ML610Q415:T2KHZ=1.953kHz，1kHz:0.977kHz

##### 9.1.1 特征

•10 Hz/1 Hz中断选择功能

##### 9.1.2 配置

图9-1显示了1kHz定时器的配置。图 PDF 122页

##### 9.2 寄存器说明

寄存器列表 

##### 9.2.2 1 kHz定时器计数寄存器（T1KCRL、T1KCRH）

T1KCRL和T1KCRH是特殊功能寄存器（SFR），用于读取1 kHz定时器的十进制计数值。当对T1KCRL或T1KCRH执行写操作时，T1KCRL或T1KCRH的有效位分别为“0”。
[位描述]
•T1KC11至T1KC0（T1KCRH：位7至0，T1KCRL：位7至4）
T1KC11到T1KC0表示1 kHz定时器的计数值

##### 9.2.3 1 kHz定时器控制寄存器（T1KCON）

T1KCON是一个特殊的功能寄存器（SFR），用于控制1khz定时器。
[位描述]

•T1KRUN（位0）
T1KRUN位用于控制1 kHz定时器计数器计数操作的启动/停止。

•T1KSEL（位1）
T1LSEL位用于选择1 kHz定时器的中断周期。可选择10 Hz或1 Hz中断。

##### 9.3 操作说明

通过将1kHz定时器控制寄存器（T1KCON）的T1KRUN位设置为“1”，1kHz定时器开始对1kHz定时器计数器寄存器L或H（T1KCRL、T1KCRH）进行计数。
通过将低速定时器基本计数器（LTBC）的T2KHz信号频率（2.048kHz）除以二元/三元计数器，定时器产生1kHz信号。基于1kHz信号，由T1KCRL和T1KCRH的十进制计数器生成1kHz定时器中断请求信号（T1KINT）。1kHz定时器中断的周期可以使用T1KCON的T1KSEL位在10Hz中断或1Hz中断之间选择。
当对T1KCRL或T1KCRH执行写操作时，二进制/三元计数器的值和T1KCRL或T1KCRH的值被清除为“0”。
可以从T1KCRL和T1KCRH读取数据。在1kHz定时器操作启动状态下从T1KCRL或T1KCRH读取数据时，读取T1KCRL或T1KCRH两次，并检查值是否匹配，以防止在计数期间读取未定义的数据。
图9-2显示了读取T1KCL和T1LCRH的程序示例。

图 PDF 126



## 第十章 定时器

##### 10.1 楷述

该LSI包括4个8位定时器通道。
输入时钟见第6章“时钟产生电路”。

##### 10.2 特征

•当定时器计数器寄存器（TMnC，n=0到3）和定时器数据寄存器（TMnD）的值重合时，产生定时器中断（TMnINT）。
•通过组合定时器0和定时器1或定时器2和定时器3配置的定时器可用作16位定时器。
•对于计时器时钟，可以使用低速时钟（LSCLK）、高速时基时钟（HTBCLK）或外部时钟
挑选出来的。
•16位定时器2和3具有时钟频率测量模式，可计算HTBCLK并生成定时器
计数结束时中断（TM3INT）。利用计数数据通过软件知道频率，可以更准确地确定波特率。

##### 10.1.2 配置

图10-1显示了定时器的配置。 图 PDF 128页

##### 10.2.1 寄存器列表

图 PDF 130页

##### 10.2.2 定时器0数据寄存器（TM0D）

TM0D是一个特殊功能寄存器（SFR），用于设置要与定时器0计数器寄存器（TM0C）值进行比较的值。
注：
定时器停止时设置TM0D（当TM0CON1寄存器的T0STAT位为“0”时）。当在TM0D中写入“00H”时，TM0D被设置为“01H”。

##### 10.2.3 定时器1数据寄存器（TM1D）

TM1D是一个特殊功能寄存器（SFR），用于设置要与定时器1计数器寄存器（TM1C）的值进行比较的值。
注：
定时器停止时设置TM1D（当TM1CON1寄存器的T1STAT位为“0”时）。当在TM1D中写入“00H”时，TM1D被设置为“01H”。

##### 10.2.4 定时器2数据寄存器（TM2D）

TM2D是一个特殊功能寄存器（SFR），用于设置要与定时器2计数器寄存器（TM2C）的值进行比较的值。
注：
定时器停止时设置TM2D（当TM2CON1寄存器的T2STAT位为“0”时）。当在TM2D中写入“00H”时，TM2D被设置为“01H”。

##### 10.2.5 定时器3数据寄存器（TM3D）

TM3D是一个特殊功能寄存器（SFR），用于设置要与定时器3计数器寄存器（TM3C）的值进行比较的值。
注：
定时器停止时设置TM3D（当TM3CON1寄存器的T3STAT位为“0”时）。在TM3D中写入“00H”时，TM3D设置为“01H”。

##### 10.2.6 定时器0计数器寄存器（TM0C）

TM0C是一个特殊的函数寄存器（SFR），它的功能是8位二进制计数器。
当执行对TM0C的写入操作时，TM0C被设置为“00H”。写入的数据没有意义。
在16位定时器模式和16位定时器频率测量模式中，如果对低阶TM0C或高阶TM1C执行写入操作，则低阶和高阶都设置为“0000H”。
在定时器工作期间，根据定时器时钟和系统时钟的条件，可能无法读取TM0C的内容。
表10-1显示了在定时器运行期间，对于定时器时钟和系统时钟的每种情况，TM0C读取是启用还是禁用。

图 PDF 135页

##### 10.2.7 定时器1计数寄存器（TM1C）

TM1C是一个特殊的函数寄存器（SFR），它的功能是8位二进制计数器。
当执行对TM1C的写入操作时，TM1C被设置为“00H”。写入的数据没有意义。
在16位定时器模式和16位定时器频率测量模式中，如果对低阶TM0C或高阶TM1C执行写入操作，则低阶和高阶都设置为“0000H”。
在16位定时器模式下读取TM1C时，确保先读取TM0C，因为在读取TM0C时，TM1C的计数值存储在TM1C锁存器中。
在定时器操作期间，根据定时器时钟和系统时钟的条件，可能无法读取TM1C的内容。
表10-2显示了在定时器时钟和系统时钟的每个条件下，在定时器操作期间，TM1C读取是启用还是禁用。

##### 10.2.8 定时器2计数寄存器（TM2C）

TM2C是一个特殊的函数寄存器（SFR），它的功能是8位二进制计数器。
当执行对TM2C的写入操作时，TM2C被设置为“00H”。写入的数据没有意义。
在16位定时器模式和16位定时器频率测量模式中，如果对低阶TM2C或高阶TM3C执行写入操作，则低阶和高阶都设置为“0000H”。
在定时器工作期间，根据定时器时钟和系统时钟的条件，可能无法读取TM2C的内容。
表10-3显示了在定时器运行期间，对于定时器时钟和系统时钟的每种情况，TM2C读取是启用还是禁用。

##### 10.2.9 定时器3计数寄存器（TM3C）

TM3C是一个特殊的函数寄存器（SFR），它的功能是8位二进制计数器。
当执行对TM3C的写入操作时，TM3C被设置为“00H”。写入的数据没有意义。
在16位定时器模式和16位定时器频率测量模式中，如果对低阶（TM2C）或高阶（TM3C）执行写入操作，则低阶和高阶都设置为“0000H”。
在16位定时器模式下读取TM3C时，确保先读取TM2C，因为在读取TM2C时，TM3C的计数值存储在TM3C锁存器中。
在定时器操作期间，根据定时器时钟和系统时钟的条件，可能无法读取TM3C的内容。
表10-4显示了在定时器运行期间，对于定时器时钟和系统时钟的每种情况，TM3C读取是启用还是禁用。

图 PDF 136页

##### 10.2.10 定时器0控制寄存器0（TM0CON0）

TM0CON0是控制计时器0的特殊函数（SFR）。
在定时器0停止时重写TM0CON0（TM0CON1寄存器的T0STAT为“0”）。
[位描述]
•T0CS1，T0CS0（位1，0）
ML610Q411/ML610Q412/ML610Q415用户手册
T0CS1和T0CS0位用于选择定时器0的工作时钟。LSCLK、HTBCLK或外部时钟（P44/T02P0CK）可由这些位选择。

•T01M16（位2）
T01M16位用于选择定时器0和定时器1的工作模式。
在8位定时器模式中，定时器0和定时器1中的每一个作为8位定时器独立地工作。
在16位定时器模式下，定时器0和定时器1连接，它们作为16位定时器工作。
在16位定时器模式下，定时器1由定时器0溢出信号递增。不生成定时器0中断（TM0INT）。

##### 10.2.11 定时器1控制寄存器0（TM1CON0）

TM1CON0是控制定时器1的特殊函数（SFR）。
在定时器1停止时重写TM1CON0（TM1CON1寄存器的T1STAT为“0”）。
[位描述]
•T1CS1、T1CS0（位1、0）

T1CS1和T1CS0位用于选择定时器1的工作时钟。LSCLK、HTBCLK或外部时钟（P45/T13P0CK）可由这些位选择。
在通过将TM0CON的T01M16设置为“1”来选择16位定时器模式的情况下，T1CS1和T1CS0的值无效。

##### 10.2.12 定时器2控制寄存器0（TM2CON0）

TM2CON0是控制定时器2的特殊函数（SFR）。
在定时器2停止时重写TM2CON0（TM2CON1寄存器的T2STAT为“0”）。
[位描述]
•T2CS1、T2CS0（位1、0）
T2CS1和T2CS0位用于选择定时器2的操作时钟。LSCLK、HTBCLK或外部时钟（P44/T02P0CK）可由这些位选择。

•T23MFM、T23M16（位3、2）
T23MFM位和T23M16位用于选择定时器2和定时器3的工作模式。。
在8位定时器模式中，定时器0和定时器1中的每一个作为8位定时器独立地工作。
在16位定时器模式下，定时器2和定时器3连接，它们作为16位定时器工作。
在16位定时器模式下，定时器3由定时器2溢出信号递增。不生成定时器2中断（TM2INT）。
在16位定时器频率测量模式下，定时器2和定时器3连接在一起，它们作为16位时钟计数器来测量频率。不生成定时器2中断（TM2INT）。

•T2FMA7~T2FMA4（位7~4）
T2FMA7位~T2FMA4位表示LSI具有频率测量模式。这些位是只读的，不管写什么数据，总是返回初始值。

注：
ML610Q415没有频率测量模式。T23MFM位为只读，尽管在ML610Q415上写入任何数据，但始终返回“0”。

##### 10.2.13 定时器3控制寄存器0（TM3CON0）

TM3CON0是控制定时器3的特殊功能（SFR）。
当计时器3停止时重写TM3CON0（TM3CON1寄存器的T3STAT为“0”）。
[位描述]
•T3CS1、T3CS0（位1、0）

T3CS1和T3CS0位用于选择定时器3的操作时钟。LSCLK、HTBCLK或外部时钟（P44/T13P1CK）可通过这些位选择。
如果通过将TM2CON的T23M16设置为“1”选择16位定时器模式，则T3CS1和T3CS0的值无效

##### 10.2.14 定时器0控制寄存器1（TM0CON1）

TM0CON1是一个特殊功能寄存器（SFR），用于控制定时器0。
[位描述]

•T0RUN（位0）
T0RUN位用于控制定时器0的停止/启动。

•T0STAT（位7）
T0STAT位用于指示计时器0的“计数停止”/“计数进行中”。

##### 10.2.15 定时器1控制寄存器1（TM1CON1）

TM1CON1是一个特殊功能寄存器（SFR），用于控制定时器1。

[位描述]

*T1RUN（bi t 0）

T1RUN位用于控制定时器1的计数停止/启动。
在16位定时器模式下，确保将该位设置为“0”。无论T1RUN的值是多少，定时器1都会因定时器0溢出信号而递增。

•T1STAT（位7）
T1STAT位用于指示定时器1的“计数停止”/“计数进行中”。在16位定时器模式下，该位将读取“0”。

##### 10.2.16 定时器2控制寄存器1（TM2CON1）

TM2CON1是一个特殊的功能寄存器（SFR），用于控制定时器2。

[位描述]

•T2RUN（位0）

T2RUN位用于控制定时器2的停止/启动。
设置T2RUN位可以强制取消16位定时器测频模式下的计数。在这种情况下，TM3INT不会出现。

•T2STAT（位7）
T2STAT位用于指示定时器2的“计数停止”/“计数进行中”。

##### 10.2.17 定时器3控制寄存器1（TM3CON1）

TM3CON1是一个特殊功能寄存器（SFR），用于控制定时器3。

[位描述]

•T3RUN（位0）

T3RUN位用于控制定时器3的停止/启动。
在16位定时器模式和16位定时器频率测量模式下，确保将该位设置为“0”。无论T3RUN的值是多少，定时器2溢出信号都会导致定时器3递增。

•T3STAT（位7）
T3STAT位用于指示定时器3的“计数停止”/“计数进行中”。在16位定时器模式和16位定时器频率测量模式下，该位将返回“0”。

##### 10.3.1 定时器模式操作

当定时器0到3控制寄存器1（TMnCON1）的TnRUN位被设置为“1”并且在第二个下降沿上增加计数值时，定时器计数器（TMnC）在定时器0到3控制寄存器0（TMnCON0）选择的定时器时钟（TnCK）的第一个下降沿被设置为工作状态（TnSTAT被设置为“1”）。
当TM0到TM3C的计数值和定时器0到3数据寄存器（TMnD）重合时，定时器0到3中断（TMnINT）在下一个定时器时钟下降沿发生，TMnC复位到“00H”，递增计数继续。
当TnRUN位设置为“0”时，TMnC在计时器时钟（TnCK）下降一次后停止计数。通过检查定时器0–3控制寄存器1（TMnCON1）的TnSTAT位是否为“0”，确认TMnC已停止。当TnRUN位再次设置为“1”时，TMn从先前的值重新开始递增计数。要将TMnC初始化为“00H”，请在TMnC中执行写操作。
定时器中断周期（TTMI）由以下等式表示。
TTMI=TMnD+1（n=0到3）/TnCK（Hz）
TMnD：定时器0至3数据寄存器（TMnD）设定值（01H至0FFH）
TnCK：定时器0到3控制寄存器0（TMnCON0）选择的时钟频率
在TnRUN位被设置为“1”之后，定时器由定时器时钟同步，并且开始计数，以便在第一个定时器中断之前发生最大1个时钟周期的错误。从第二次开始的定时器中断周期是恒定的。
图10-2显示了定时器0到3的操作时序图。

注：
即使向TnRUN位写入了“0”，计数操作也会一直持续到下一个定时器时钟脉冲的下降沿（定时器0到3状态标志（TnSTA）处于“1”状态）。因此，定时器0到3中断（TMnINT）可能发生。

##### 10.3.2 16位定时器频率测量模式操作

16位定时器2和3中的频率测量模式用于计算500kHz RC振荡时钟的频率，该时钟通常具有温度变化和生产公差。
采用频率测量方式可以使uart波特率时钟或定时器功能具有更高的精度。
（1） 读取计数数据，计算并设置为uart通信波特率寄存器，可以使波特率时钟更准确。
（2） 读取计数数据，计算并将其设置为计时器数据寄存器，可以在正常计时器模式下进行更精确的计时。
注：
此功能在ML610Q415上不可用，因为它没有低速晶体振荡时钟。
图10-3显示了频率测量模式下的操作时序。图 PDF 148页

（1） 高速时钟（HSCLK，HTBCLK）必须与FCONn寄存器相结合，处于振荡状态。并根据需要设置HTBDR寄存器（高速时基计数器设备寄存器）。
（2） 将T2RUN位（TM2CON1寄存器的位0）和T3RUN位（TM3CON1寄存器的位0）重置为“0”以停止计时器。然后，检查T2STAT位（TM2CON1寄存器的位7）和T3STAT位（TM3CON1寄存器的位7）是否为“0”，以确保计时器停止。
（3） 将T23MFM位（TM2CON0寄存器的位3）设置为“1”（频率测量模式），将T23M16位（TM2CON0寄存器的位2）设置为“1”（16位模式），将T2CS1-0位（TM2CON0寄存器的位1/0）设置为“01”（HTBCLK模式）。

（4） 将“FFH”设置为TM2D寄存器和TM3D寄存器。
（5） 将TM2C寄存器和TM3C寄存器清除为“00H”。
（6） 将T2RUN位（TM2CON1寄存器的位0）设置为“1”，开始计时。
（7） 在（T23MFM位==“1”）&（（TM23M16位==“1”）&（T2RUN位==“1”）的条件下，计数从64Hz时钟信号的上升沿开始。
（8） 437C信号变为“1”后，计数在下一个定时器时钟（HTBCLK）的下降沿停止。同时，T2RUN位和T2STAT位变为“0”，中断信号TM3INT激活。
（9） 检查T2STAT位或TM3INT中断发生后，读取TM2C寄存器和TM3C寄存器的数据（N1）。
例如利用N1，发生9600Hz定时器中断。
假设HTBCLK为600kHz，N1=600000*437/32768
=8001（十进制）
=1F41（十六进制）
=0001 1111 0100 0001（二进制）
因为（437/32768）秒相当于9600Hz（更准确地说，9598Hz）的128个时钟，是计数N1的一个除法
乘以128等于HTBCLK频率和9600Hz之间的频率比（N2）。
7
因为128=2，所以可以通过截断N1（二进制）的右边七位来确定计算。
N2=8001（十进制）/128（十进制）=0001 11110（二进制）
=3E（十六进制）
=62（十进制）
这表明9600Hz大约是HTBCLK周期的62倍。
因此，如果将3DH（=3EH-1）设置为定时器寄存器和定时器开始计数，则每62次HTBCLK计数可发生的TMnINT中断周期为：
tTMnINT=（1/600000）*62=0.10333ms（9677Hz）

##### 10.3.3 设置uart波特率的16位定时器频率测量模式应用

例如，当目标波特率为9600bps，时钟为HSCLK（500kHz）时，UART0波特率寄存器（UA0BRTH，UA0BRTL）应设置如下。见第14.3.2节。在UART章节。
UA0BRTH，UA0BRTL=500000/9600-1=51（十进制）=33（十六进制）
然而，实际500kHz RC振荡时钟存在温度变化和生产容差，用500kHz的定值计算不能得到准确的波特率。为了补偿它，在运行UART通信之前，在频率测量模式下计数频率以再次设置波特率。
在频率测量模式下完成时钟计数后，假设HTBCLK为451kHz，TM2C寄存器和TM3C寄存器的数据为：
N1=451000*437/32768
=6014（十进制）
=177E（十六进制）
=1011101111110（二进制）
由于（437/32768）秒相当于9600Hz（更准确地说，9598Hz）下的128个时钟，因此计数（N1）除以128等于HTBCLK和9600Hz之间的频率比（N2）。
对于计算，波特率的准确性取决于数据的截断（1）或舍入（2）。
UA0BRTH寄存器和UA0BRTL寄存器必须设置如下。见上一节10.3.2。以及第14.3.2节。在UART章节。
UA0BRTH，UA0BRTL=（HTBCLK与9600Hz的频率比）-1=（N1/128）-1=N2-1
（1） 计算中的舍入数据
N1=1011101111110（二进制）
N2=101111（二进制）=47（十进制）=2F（十六进制）
将N2-1（=2E）设置为UA0BRTH和UA0BRTL寄存器。
在这种情况下，实际波特率为9595.744681。。[bps]，因此精确度=（（9595.744681/9600）-1）*100=-0.04..[%]。
（2） Trancate data in calucuation（波特率精度变差）N1=1011101111110（二进制）
N2=101110（二进制）=46（十进制）=2E（十六进制）
将N2-1（=2D）设置为UA0BRTH和UA0BRTL寄存器。
在这种情况下，实际波特率为9804.347826。。[bps]，因此精确度=（（9804.347826/9600）-1）*100=2.12..[%]。

## 第11章 PWM （脉宽调制）

##### 11.1 楷述

此LSI包括一个16位PWM（脉宽调制）通道。
PWM输出（PWM0）功能分配给P43（端口4）和P34（端口3）作为第三功能。有关端口4和端口3的功能，请参阅第21章“端口4”和第20章“端口3”。

##### 11.1.1 特点

•周期约为4us（@HTBCLK）到2s（@LSCLK）的PWM信号可以在LSI外部生成和输出。
•PWM信号的输出逻辑可以切换到正逻辑或负逻辑。
•当PWM信号周期、占空比和周期与占空比重合时，会发生PWM中断（PW0INT）。
•对于PWM时钟，一个低速时钟（LSCLK）、一个高速时基时钟（HTBCLK）和一个外部时钟
可使用。

##### 11.1.2 配置

图11-1显示了PWM电路的配置。图片 PDF 152页

PW0PL:PWM0周期寄存器L 

PW0PH:PWM0周期寄存器H 

PW0PBUF:PWM0周期缓冲区

PW0DL:PWM0占空寄存器L 

PW0DH:PWM0占空寄存器H 

PW0DBUF:PWM0占空缓冲区

PW0CL:PWM0计数器寄存器L

PW0CH:PWM0计数器寄存器H
PW0CON0:PWM0控制寄存器0
PW0CON1:PWM0控制寄存器1

##### 11.1.3 引脚列表

---

P43/PWM0    PWM0输出引脚用于P43引脚的辅助功能。

---

P34/PWM0    PWM0输出引脚用于P34引脚的辅助功能。

---

##### 11.2.1 寄存器列表

图片 PDF 153页

##### 11.2.2 PWM0周期寄存器（PW0PL、PW0PH）

PW0PH和PW0PL是设置PWM0周期的特殊功能寄存器（SFRs）。

注：
当PW0PH或PW0PL设置为“0000H”时，PWM0周期缓冲器（PW0PBUF）设置为“0001H”。

##### 11.2.3 PWM0占空比寄存器（PW0DL、PW0DH）

PW0DH和PW0DL是用于设置PWM0职责的特殊功能寄存器（SFRs）。
注：
将PW0DH和PW0DL设置为小于PW0PH和PW0PL设置的值。

##### 11.2.4 PWM0计数器寄存器（PW0CH、PW0CL）

PW0CL和PW0CH是作为16位二进制计数器工作的特殊功能寄存器（SFRs）。
当数据写入PW0CL或PW0CH时，PW0CL和PW0CH设置为“0000H”。写入的数据没有意义。
当从PW0CL读取数据时，PW0CH的值被锁存。读取PW0CH和PW0CL时，请使用字型指令或预读PW0CL。
根据PWM时钟和系统时钟的组合，无法读取PWM操作期间的PW0CH和PW0CL内容。

表11-1显示了PWM时钟和系统时钟的每个组合的PW0CH和PW0CL读取启用/禁用。

图 PDF 156页

##### 11.2.5 PWM0控制寄存器0（PW0CON0）

PW0CON0是控制PWM的特殊功能寄存器（SFR）。
[位描述]
•P0CS1，P0CS0（位1，0）
P0CS1和P0CS0位用于选择PWM0操作时钟。可选择时钟（P44/T02P0CK）。

•P0IS1、P0IS0（位3、2）
P0IS1和P0IS0位用于选择PWM0中断发生的点。可选择“期间重合时”、“职责重合时”或“期间与职责重合时”。

•P0NEG（位4）
P0NEG位用于输出为“1”，当选择输出逻辑。当选择正逻辑时，选择PWM0负逻辑的初始值，PWM0输出的初始值为“0”。

##### 11.2.6 PWM0控制寄存器1（PW0CON1）

PW0CON1是一种特殊的功能寄存器（SFR），用于控制PWM0。

[位描述]

•P0RUN（位0）
P0RUN位用于控制PWM0的计数停止/启动。

•P0FLG（第6位）
P0FLG位用于读取PWM0的输出标志。
当执行对PW0CH或PW0CL的写入操作时，此位设置为“1”

•P0STAT（位7）
P0STAT位表示PWM0的“计数停止”或“计数进行中”。

##### 11.3 操作说明

当PWM0控制寄存器1（PW0CON1）的P0RUN位设置为“1”时，PWM0计数器寄存器（PW0CH，PW0CL）在由PWM0控制寄存器0（PW0CON0）选择的PWM时钟（P0CK）的第一个下降沿设置为工作状态（P0STAT设置为“1”），并在第二个下降沿上递增计数值。
当PWM0计数器寄存器的计数值与PWM0占空比缓冲器（PW0DBUF）的值重合时，在P0CK的下一个定时器时钟下降沿上，PWM标志（P0FLG）被设置为“0”。
当PWM0计数器寄存器的计数值和PWM0周期缓冲器（PW0PBUF）的值重合时，P0CK的下一个下降沿上的PWM标志（P0FLG）被设置为“1”，PWM0计数器寄存器被设置为“0000H”，递增计数继续。同时，PWM0占空寄存器（PW0DH，PW0DL）的值被传输到PWM0占空缓冲器（PW0DBUF），PWM0周期寄存器（PW0PH，PW0PL）的值被传输到PWM0周期缓冲器（PW0PBUF）。
当P0RUN位设置为“0”时，PWM0计数器寄存器在PWM时钟（P0CK）下降一次后停止计数。通过检查PWM0控制寄存器1（PW0CON1）的PnSTAT位是否为“0”，确认PW0CH和PW0CL已停止。当P0RUN位再次设置为“1”时，PWM0计数器寄存器从P0CK下降沿上一个值重新开始递增计数。
要将PWM0计数器寄存器初始化为“0000H”，请在PW0CH或PW0CL中执行写操作。此时，P0FLG也设置为“1”。在计数停止期间（P0RUN处于“1”状态），当数据写入PWM0占空寄存器（PW0DH，PW0DL）时，数据被传输到PWM0占空缓冲区（PW0DBUF），当数据写入PWM0周期寄存器（PW0PH，PW0PL）时，数据被传输到PWM0周期缓冲区（PW0PBUF）。
PWM时钟、PWM0中断发生的点以及PWM输出的逻辑由PWM0控制寄存器0（PW0CN0）选择。
PWM0信号的周期（TPWP）和占空比的前半持续时间（TPWD）由以下等式表示。
TPWP公司=
TPWP公司=
PW0P+1 /P0CK（赫兹）
PW0D+1 /P0CK（赫兹）
PW0P: PWM0周期寄存器（PW0PH，PW0PL）设置值（0001H到0FFFFH）

PW0D: PWM0占空寄存器（PW0DH，PW0DL）设置值（0000H到0FFFEH）
P0CK：由PWM0控制寄存器0（PW0CON0）选择的时钟频率

P0RUN位设置为“1”后，计数开始与PWM时钟同步。这会导致up错误
至发出第一个PWM中断时的1个时钟脉冲。从第二次开始的PWM中断周期是固定的
图11-2显示了PWM0的操作时序。

图 PDF 160页

注：
即使将“0”写入P0RUN位，计数操作也会一直持续到下一个PWM时钟脉冲的下降沿（PWM0状态标志（P0STAT）处于“1”状态）。因此，可能发生PWM0中断（PW0INT）。

##### 11.4 指定端口寄存器

当您想确保PWM功能正常工作时，请检查是否指定了相关的端口寄存器。有关端口寄存器的详细信息，请参阅第22章“端口4”和第21章“端口3”。

##### 11.4.1 将P43（PWM0）用作PWM输出

将P43MD1位（P4MOD1寄存器的位3）设置为“1”，将P43MD0位（P4MOD0寄存器的位3）设置为“0”，以将PWM输出指定为P43的第三功能。图 PDF 161页

将P43C1位（P4CON1寄存器的位3）设置为“1”，将P43C0位（P4CON0寄存器的位3）设置为“0”，将P43DIR位（P4DIR寄存器的位3）设置为“0”，以将P43指定为CMOS输出。 图 PDF 161页

P43D位（P4D寄存器的bit3）的数据对PWM输出功能没有影响，因此不关心该功能的数据。

*：位与PWM功能无关

**：不关心数据。

##### 11.4.2 将P34（PWM0）用作PWM输出

将P34MD1位（P3MOD1寄存器的位4）设置为“1”，将P34MD0位（P3MOD0寄存器的位4）设置为“0”，以将PWM输出指定为P34的第三功能。图 PDF 162页

将P34C1位（P3CON1寄存器的位4）设置为“1”，将P34C0位（P3CON0寄存器的位4）设置为“0”，并将P34DIR位（P3DIR寄存器的位4）设置为“0”，以将P34指定为CMOS输出。图 PDF 162页

P34D位（P3D寄存器的bit4）的数据不影响PWM输出功能，因此不必关心该功能的数据。

-：位不存在。
*：位与PWM功能无关

**：不关心数据。

## 第十二章 看门狗定时器

##### 12.1 楷述

此LSI包含一个看门狗定时器（WDT），该定时器在系统无条件复位（自由运行操作）时工作，以便检测MCU的未定义状态并从该状态返回。
如果WDT计数器在WDT溢出周期内由于清除WDT计数器失败而溢出，则看门狗定时器请求WDT中断（不可屏蔽中断）。当第二次溢出发生时，看门狗定时器产生WDT复位信号，并将模式转换为系统复位模式。
中断见第5章“中断”，WDT中断见第3章“复位功能”。

##### 12.1.1 特点

•不可屏蔽中断
•自由运行（无法停止）
•软件可选择的四种溢流周期之一
ML610Q411/Q412：125ms、500ms、2s、8s
ML610Q415:131ms，524ms，2.1s，8.4s

•第二次溢出产生复位



##### 12.1.2 配置

图12-1显示了看门狗定时器的配置。

图 PDF 164页

##### 12.2.1寄存器列表

---

0F00EH    看门狗定时器控制寄存器

---

0F00FH    看门狗定时器模式寄存器

---

##### 12.2.2 看门狗定时器控制寄存器（WDTCON）

WDTCON是一个特殊的函数寄存器（SFR），用于清除WDT计数器。
读取WDTCON时，从位0读取内部指针（WDP）的值。
[位描述]

•WDP/d0（位0）
从该位读取内部指针（WDP）的值。在系统复位或看门狗定时器溢出时，WDP被重置为“0”，并且每次写入WDTCON时都被反转。
•d7-d0（位7-0）
此位用于写入数据以清除WDT计数器。在WDP为“0”的情况下写入“5AH”，在WDP为“1”的情况下写入“0A5H”。
注：
在系统复位或释放停止模式后，再释放低速时钟，写入WDTCON变为启用
（LSCLK）振荡开始。在低速时钟振荡开始之前，即使写入WDTCON，WDP也不会反转。因此，在写入WDTCON之前，请检查WDP以确定写入“5AH”或“0A5H”。

##### 12.2.3看门狗定时器模式寄存器（WDTMOD）

WDTMOD是一个特殊的函数寄存器，用于设置看门狗定时器的溢出周期。
[位描述]

•WDT1-0（位1-0）
这些位用于选择看门狗定时器的溢出周期。
WDT1和WDT0位设置WDT计数器的溢出周期（TWOV）。可选择125ms、500ms、2s和8s中的一个。

##### 12.3 操作说明

WDT计数器在系统复位解除和低速时钟振荡开始后开始计数。。当内部指针（WDP）为“0”时写入“5AH”，然后当WDP为“1”时通过写入“0A5H”清除WDT计数器。
在系统复位时或WDT计数器溢出时，WDP被重置为“0”，并且每当数据写入WDTCON时，WDP被反转。
当WDT计数器无法在WDT计数器溢出周期（TWOV）内清除时，会发生看门狗定时器中断（WDTINT）。如果在看门狗定时器中断之后执行的软件处理未清除WDT计数器，并且再次发生溢出，则WDT复位发生，并且模式切换到系统复位模式。
对于WDT计数器的溢出周期（TWOV），看门狗模式寄存器（WDTMOD）可以选择125ms、500ms、2s和8s中的一个。
在表12-1所示的WDT计数器清除周期内清除WDT计数器。

图 PDF 168页



图12-2显示了看门狗定时器操作的示例。图 PDF 169页

1 WDT计数器在系统复位解除和低速时钟振荡开始后开始计数。
2 WDT计数器的溢出周期（TWOV）设置为WDTMOD。
3 “5AH”写入WDTCON。（内部指针0→1）
4 “0A5H”写入WDTCON并清除WDT计数器。（内部指针1→0）
5 “5AH”写在WDTCON上。（内部指针0→1）
6 异常发生后写入WDTCON的“5AH”不能作为内部数据
指针设置为“1”。（内部指针1→0）
7 尽管“0A5H”被写入WDTCON，但由于内部指针为“0”且
6中不接受写“5AH”。（内部指针0→1）
8 WDT计数器溢出并生成看门狗定时器中断请求（WDTINT）。在这种情况下
内部指针被清除为“0”。
9 如果WDT计数器即使在看门狗定时器中断后执行的软件处理也没有清除
WDT计数器再次溢出，WDT复位发生，模式切换到系统复位模式。
注：
•在停止模式下，看门狗定时器操作也停止。
•在停止模式下，看门狗定时器操作不会停止。当WDT中断发生时，暂停模式为
释放。
•看门狗定时器无法检测所有异常操作。即使CPU失去控制，看门狗定时器
在WDT计数器被清除的操作状态下，无法检测到异常。





## 第十三章 同步串口

##### 13.1 楷述

该LSI包括8/16位同步串行端口（SSIO）的一个信道，并且还可以通过使用一个GPIO作为芯片使能管脚来控制与SPI接口结合的设备。
输入时钟见第6章“时钟产生电路”。
使用同步串行端口时，必须设置端口4的第三功能。有关端口4的第三级功能，请参阅第21章“端口4”。

##### 13.1.1 特点

•主或从可选
•MSB优先或LSB优先可选
•数据长度可选择8位长度或16位长度

##### 13.1.2 配置

图13-1 显示了同步串行端口的配置。图 PDF 171页

##### 13.1.3 针脚列表

---

P40/SIN0  P44/SIN0      接收输入数据。用于P40和P44引脚的第三功能

---

P41/SCK0   P45/SCK0     同步时钟输入/输出。用于P41和P45引脚的第三功能。

---

P42/SOUT0   P46/SOUT0   传输数据输出。用于P42和P46引脚的第三功能。

----



##### 13.2.1 寄存器列表

----

0F280H     串口0发送/接收缓冲器 L

---

0F281H     串口0发送/接收缓冲器 H

---

0F282H     串口0控制寄存器

---

0F284H     串口0模式寄存器0

---

0F285H     串口0模式寄存器1

---



##### 13.2.2 串口发送/接收缓冲器（SIO0BUFL、SIO0BUFH）

SIO0BUFL和SIO0BUFH是特殊功能寄存器（SFR），用于写入同步串行端口的发送数据和读取同步串行端口的接收数据。
当数据写入SIO0BUFL和SIO0BUFH时，数据写入发送寄存器（SIO0TRL和SIO0TRH），当数据从SIO0BUFL和SIO0BUFH读取时，读取接收寄存器（SIO0RCL和SIO0RCH）的内容。

##### 13.2.3 串行端口控制寄存器（SIO0CON）

SIO0CON是一个特殊的功能寄存器（SFR），用于控制同步串行端口。
[位描述]

•S0EN（位0）
S0EN位用于指定同步串行通信的开始。向该位写入“1”将启动8-/16位数据通信。当8-/16位数据通信终止时，该位自动设置为“0”。
系统复位时，S0EN位设置为“0”。

##### 13.2.4 串行端口模式寄存器0（SIO0MOD0）

SIO0MOD0是一个特殊的功能寄存器（SFR），用于设置同步串行端口的模式。
[位描述]

•S0DIR（位0）
S0DIR用于选择LSB first或MSB first。

•S0MD1、S0MD0（位2、1）
S0MD1和S0MD0位用于选择同步串行端口的发送、接收或发送/接收模式。

•S0LG（位3）
S0LG位用于指定发送/接收缓冲器的位长度，8位或16位长度。系统复位时，S0LG位设置为“0”

注：
•在传输/接收期间，不要更改任何SIO0MOD0寄存器设置。
•使用同步串口时，必须设置GPIO的三级功能。有关端口4的第三级功能，请参阅第21章“端口4”。

##### 13.2.5 串行端口模式寄存器1（SIO0MOD1）

SIO0MOD1是一个特殊功能寄存器（SFR），用于设置同步串行端口的模式。
[位描述]
•S0CK2至S0CK0（位2至0）
S0CK2到S0CK0位用于选择同步串行端口的传输时钟。当选择内部时钟时，该LSI被设置为主模式，当选择外部时钟时，它被设置为从模式。

图 PDF 177页

•S0CKT（位4）
S0CKT位用于选择时钟输出相位后的转换。

##### 13.3.1 传输操作

当“1”写入串行模式寄存器（SIO0MOD0）的S0MD1位，“0”写入S0MD0位时，该LSI被设置为传输模式。
当传输数据写入串行端口传输/接收缓冲器（SIO0BUFL和H）并且串行端口控制寄存器（SIO0CON）的S0EN位设置为“1”时，传输开始。当8/16位数据传输终止时，发生同步串行端口中断（SIO0INT），S0EN位设置为“0”。
从GPIO的第三功能引脚（P42/SOUT0或P46/SOUT0）输出传输数据。
当在串行端口模式寄存器（SIO0MOD1）中选择内部时钟时，LSI被设置为主模式，当选择外部时钟（P41/SCK0或P45/SCK0）时，LSI被设置为从模式。
串行端口模式寄存器（SIO0MOD0）允许选择MSB first/LSB first。
传输数据输出引脚（P42/SOUT0或P46/SOUT0）和传输时钟输入/输出引脚（P41/SCK0或P45/SCK0）必须设置为第三功能。
图13-2和13-3分别显示了时钟类型0和时钟类型1的同步串行端口的传输操作波形（8位长度，LSB优先，时钟类型0和1）。

图 PDF 178页

##### 13.3.2 接收操作

当“0”写入串行模式寄存器（SIO0MOD0）的S0MD1位，“1”写入S0MD0位时，该LSI被设置为接收模式。
当串行端口控制寄存器（SIO0CON）的S0EN位设置为“1”时，开始接收。当8/16位数据的接收终止时，发生同步串行端口中断（SIO0INT），S0EN位设置为“0”。
从GPIO的第三功能引脚（P40/SIN0或P44/SIN0）输入接收数据。
当在串行端口模式寄存器（SIO0MD1）中选择内部时钟时，LSI被设置为主模式，当选择外部时钟（P41/SCK0或P45/SCK0）时，LSI被设置为从模式。
串行端口模式寄存器（SIO0MOD0）允许选择MSB优先或LSB优先。
接收数据输入引脚（P40/SIN0或P44/SIN0）和传输时钟输入/输出引脚（P41/SCK0或P45/SCK0）必须设置为第三功能。
图13-4和13-5分别显示了时钟类型0和时钟类型1的同步串行端口的接收操作波形（8位长度，MSB优先，时钟类型0和1）。

图 PDF 179页

##### 13.3.3 发送/接收操作

当“1”写入串行模式寄存器（SIO0MOD0）的S0MD1位，“1”写入S0MD0位时，该LSI被设置为发送/接收模式。
当串行端口控制寄存器（SIO0CON）的S0EN位设置为“1”时，传输/接收开始。当8/16位数据的发送/接收终止时，发生同步串行端口中断（SIO0INT），S0EN位设置为“0”。
接收数据从GPIO的第三功能引脚（P40/SIN0或P44/SIN0）输入，发送数据从GPIO的第三功能引脚（P42/SOUT0或P46/SOUT0）输出
当在串行端口模式寄存器（SIO0MD1）中选择内部时钟时，LSI被设置为主模式，当选择外部时钟（P41/SCK0或P45/SCK0）时，LSI被设置为从模式。
串行端口模式寄存器（SIO0MOD0）允许选择MSB优先或LSB优先。
接收数据输入引脚（P40/SIN0或P44/SIN0）、传输数据输出引脚（P42/SOUT0或P46/SOUT0）和传输时钟输入/输出引脚（P41/SCK0或P45/SCK0）必须设置为第三功能。
图13-6显示了同步串行端口的发送/接收操作波形（16位长度，LSB优先，时钟类型0）。

图PDF 180页

##### 13.4 指定端口寄存器

当您想确保SSIO功能正常工作时，请检查是否指定了相关的端口寄存器。有关端口寄存器的详细信息，请参阅第21章“端口4”。
13.4.1将P42（SOUT0）、P41（SCK0）和P40（SIN0）用作SSIO/“主模式”
将P42MD1-P40MD1位（P4MOD1寄存器的位2-0）设置为“1”，将P42MD0-P40MD0位（P4MOD0寄存器的位2-0）设置为“0”，以指定SSIO作为P42、P41和P40的辅助函数。

图 PDF 181页



将P42C1-P41MC1位（P4CON1寄存器的位2-1）设置为“1”，将P42C0-P41C0位（P4CON0寄存器的位2-1）设置为“1”，并将P42DIR-P41DIR位（P4DIR寄存器的位2-1）设置为“0”，以将P42-P41指定为CMOS输出。
将P40DIR位（P4DIR寄存器的位0）设置为“1”，以指定P40作为输入引脚。
P40C1位和P40C0位的数据设置取决于连接到P40的应用电路。

P42D-P40D位（P4D寄存器的bit2-0）的数据对SSIO函数没有影响，因此不必关心函数的数据。

*：位与SSIO函数无关

**：不关心数据
$：任意

##### 13.4.2 将P42（SOUT0）、P41（SCK0）和P40（SIN0）用作SSIO/“从属模式”
将P42MD1-P40MD1位（P4MOD1寄存器的位2-0）设置为“1”，将P42MD0-P40MD0位（P4MOD0寄存器的位2-0）设置为“0”，以指定SSIO作为P42、P41和P40的辅助函数。它们的设置与主模式相同。

图 PDF 182页

将P42C1位（P4CON1寄存器的位2）设置为“1”，将P42C0位（P4CON0寄存器的位2）设置为“1”，并将P42DIR位（P4DIR寄存器的位2）设置为“0”，以将P42指定为CMOS输出。
将P41DIR-P40DIR位（P4DIR寄存器的位1-0）设置为“1”，以指定P41和P40作为输入引脚。
P41C1位、P40C1位、P41C0位和P40C0位的数据设置取决于连接到P41和P40的应用电路。

P42D-P40D位（P4D寄存器的bit2-0）的数据对SSIO函数没有影响，因此不必关心函数的数据。

*：位与SSIO（使用P42、P41和P40）功能无关

**：不关心数据
$：任意

##### 13.4.3 将P46（SOUT0）、P45（SCK0）和P44（SIN0）用作SSIO/“主模式”

将P46MD1-P44MD1位（P4MOD1寄存器的位6-位4）设置为“1”，将P46MD0-P44MD0位（P4MOD0寄存器的位6-位4）设置为“0”，以将SSIO指定为P46、P45和P44的辅助函数。

图 PDF 183

将P46C1-P45MC1位（P4CON1寄存器的位6-bit5）设置为“1”，将P46C0-P45C0位（P4CON0寄存器的位6-bit5）设置为“1”，并将P46DIR-P45DIR位（P4DIR寄存器的位6-bit5）设置为“0”，以将P46-P45指定为CMOS输出。
将P44DIR位（P4DIR寄存器的位4）设置为“1”，以指定P44作为输入引脚。
P44C1位和P44C0位的数据设置取决于连接到P44的应用电路。

P46D-P44D位（P4D寄存器的位6-4）的数据对SSIO函数没有影响，因此不必关心函数的数据。

-：位与SSIO（使用P46、P45和P44）功能无关

**：不关心数据
$：任意

##### 13.4.4 作为SSIO/“从模式”的P46（SOUT0）、P45（SCK0）和P44（SIN0）功能

将P46MD1-P44MD1位（P4MOD1寄存器的位6-位4）设置为“1”，将P46MD0-P44MD0位（P4MOD0寄存器的位6-位4）设置为“0”，以将SSIO指定为P46、P45和P44的辅助函数。它们的设置与主模式相同。

图 PDF 184

将P46C1位（P4CON1寄存器的位6）设置为“1”，将P46C0位（P4CON0寄存器的位6）设置为“1”，并将P46DIR位（P4DIR寄存器的位6）设置为“0”，以将P46指定为CMOS输出。
将P45DIR-P44DIR位（P4DIR寄存器的位5-4）设置为“1”，以指定P45和P44作为输入引脚。
P45C1位、P44C1位、P45C0位和P44C0位的数据设置取决于连接到P45和P44的应用电路。

P46D-P44D位（P4D寄存器的位6-4）的数据对SSIO函数没有影响，因此不必关心函数的数据。

-：位与SSIO（使用P46、P45和P44）功能无关

**：不关心数据
$：任意



## 第十四章 通用异步收发器

##### 14.1 楷述

该LSI包括一个异步串行接口UART（通用异步收发器）通道。
输入时钟见第6章“时钟产生电路”。
使用UART需要设置端口4的辅助功能。
4，见第21章，“端口4”。

##### 14.1.1 特点

•5位/6位/7位/8位数据长度可选
•奇偶校验、偶校验或无校验可选
•可选择1个停止位或2个停止位
•提供ParityErrorFlag、OverflowerErrorFlag、framingerrorflag和TransmitBufferStatusFlag。

•作为通信逻辑可选择的正逻辑或负逻辑
•LSB优先或MSB优先可选择作为通信方向
•内置波特率发生器

##### 14.1.2 配置

图14-1显示了UART的配置。

图 PDF 186页

##### 14.1.3 针脚列表

---

P02/RXD0   UARTO 数据输入针脚 用于P02引脚的辅助功能。

---

P42/RXD0   UART0数据输入引脚用于P42引脚的辅助功能。

---

P43/TXD0    UART0数据输出引脚用于P43引脚的辅助功能。

---

##### 14.2.1寄存器列表

----

0F290H UART0发送/接收缓冲器

----

0F291H UART0控制寄存器

---

0F292H UART0模式寄存器0

---

0F293H UART0模式寄存器1

---

0F294H UART0波特率寄存器L

---

0F295H UART0波特率寄存器H

---

0F296H UART0状态寄存器

---



##### 14.2.2 UART0发送/接收缓冲器（UA0BUF）

UA0BUF是一个特殊功能寄存器（SFR），用于存储UART的发送/接收数据。
在传输模式下，将传输数据写入UA0BUF。要连续传输数据，请确保UART0状态寄存器（UA0STAT）的U0FUL标志为“0”后，将下一个数据写入UA0BUF。可以读取写入UA0BUF的任何值。
在接收模式下，由于接收终止时接收的数据存储在UA0BUF中，因此在接收终止时使用UART0中断读取UABUF的内容。在连续接收时，只要接收终止，BA0BUF就会更新。在接收模式下，任何对BA0BUF的写入都被禁用。
选择5位、6位、7位或8位数据长度时不需要的位在传输模式下无效，在接收模式下设置为“0”。
注：
对于传输模式下的操作，在UAOBUF中设置传输数据之前，请确保先设置传输模式（UA0MOD0和UA0MOD1）。

##### 14.2.3 UART0控制寄存器（UA0CON）

UA0CON是一个特殊的功能寄存器（SFR），用于启动/停止UART的通信。
[位描述]

•U0EN（位0）
U0EN位用于指定UART通信操作的开始。当U0EN设置为“1”时，UART通信开始。在传输模式下，该位在传输终止时自动设置为“0”。在接收模式下，继续接收操作。要终止接收，请通过软件将位设置为“0”。

##### 14.2.4 UART0模式寄存器0（UA0MOD0）
地址：0F292H

访问：R/W
访问大小：8/16位

初始值：00H

UA0MOD0是一个特殊功能寄存器（SFR），用于设置UART的传输模式。

[位描述]

•U0IO（位0）
U0IO位用于选择发送或接收模式。

•U0CK1、U0CK0（位2,1）
U0CK1和U0CK0位用于选择要输入到UART0波特率发生器的时钟。

•U0RSEL（bit4）
U0RSEL位用于选择UART0的接收数据输入引脚。

笔记：
-通信停止时，务必设置UA0MOD0寄存器，通信过程中不要重写。
-当为时钟指定LSCLK×2时，通过设置位2（ENMLT）启用2×低速时钟的操作
将频率控制寄存器1（FCON1）设置为“1”。
-选择P42引脚作为接收数据输入引脚时，需要配置端口4辅助端口的设置
功能。有关端口4辅助功能设置的详细信息，请参阅第21章“端口4”。

##### 14.2.5 UART0模式寄存器1（UA0MOD1）

地址：0F293H

访问：R/W
访问大小：8/16位

初始值：00H

UA0MOD1是一个特殊功能寄存器（SFR），用于设置UART的传输模式。
[位描述]
•U0LG1、U0LG0（位1,0）
U0LG1和U0LG0位用于指定UART通信中的数据长度。

•U0PT1、U0PT0（位3、2）
U0PT1和U0PT0位用于在UART通信中选择“偶奇偶校验”、“奇奇偶校验”或“无奇偶校验”。

•U0STP（位4）
U0STP位用于选择UART通信中的停止位长度。

•U0NEG（位5）
U0NEG位用于在UART通信中选择正逻辑或负逻辑。

•U0DIR（位6）
U0DIR位用于在UART的通信中选择LSB first或MSB first。

注：
在通信停止时，始终设置UA0MOD1寄存器，在通信期间不要重写。

##### 14.2.6 UART0波特率寄存器L、H（UA0BRTL、UA0BRTH）

地址：0F294H

访问：R/W
访问大小：8/16位

初始值：0FFH

地址：0F295H

访问：R/W

访问大小：8位

初始值；0FH

UA0BRTL和UA0BRTH是特殊功能寄存器（SFR），用于设置波特率发生器的计数值，该发生器生成波特率时钟。
波特率发生器的计数值与波特率之间的关系见第14.3.2节“波特率”。
注：
在停止通信时，始终设置UA0BRTL和UA0BRTH寄存器，并且在通信期间不要重写它们。

##### 14.2.7 UART0状态寄存器（UA0STAT）

地址：0F296H

访问：R/W

访问大小：8位

初始值：00H

UA0STAT是一个特殊功能寄存器（SFR），用于指示UART的发送或接收操作状态。当任何数据写入UA0STAT时，所有标志都初始化为“0”。

[位描述]

•U0FER（位0）
U0FER位用于指示UART帧错误的发生。
当起始位或停止位出现错误时，U0FER位设置为“1”。此位在每次接收完成时更新。
在传输模式下，U0FER位固定为“0”。
此位在每次接收时更新

•U0OER（位1）
U0OER位用于指示UART发生溢出错误。
如果发送/接收缓冲器（UA0BUF）中的接收数据在读取之前再次被接收，则该位被设置为“1”。即使接收被U0EN位停止，然后重新开始接收，该位也被设置为“1”，除非之前的接收数据没有被读取。因此，即使不需要数据，也要确保始终从发送/接收缓冲区读取数据。
在传输模式下，U0OER位固定为“0”。

•U0PER（位2）
U0PER位用于指示UART奇偶校验错误的发生。
当接收数据的奇偶校验和附加到数据的奇偶校验位不一致时，该位被设置为“1”。每当接收到数据时，都会更新U0PER。
在传输模式下，U0PER位固定为“0”。

•U0FUL（位3）
U0FUL位用于指示UART的发送/接收缓冲区的状态。
当传输数据以传输模式写入UA0BUF时，该位设置为“1”，当传输数据传输到移位寄存器时，该位设置为“0”。要连续传输数据，请在检查U0FUL标志是否设置为“0”后，将下一个传输数据写入UA0BUF。
在接收模式下，U0FUL位固定为“0”

0 发送/接收缓冲区中没有数据。（初始值）

1 发送/接收缓冲器中有数据。

##### 14.3.1 传输数据格式

在传输数据格式中，一帧包含起始位、数据位、奇偶校验位和停止位。在这种格式中，可以选择5到8位作为数据位。对于奇偶校验位，可以选择“有奇偶校验位”、“无奇偶校验位”、“偶奇偶校验”或“奇奇偶校验”。对于停止位，“1停止位”或“2停止位”可用，对于传输方向，“LSB优先”或“MSB优先”可供选择。对于串行输入/输出逻辑，可以选择正逻辑或负逻辑。所有这些选项都通过UART0模式寄存器（UA0MOD1）设置。
图14-2和图14-3分别显示了正逻辑输入/输出格式和负逻辑输入/输出格式

图 PDF 196页

##### 14.3.2波特率

波特率由波特率发生器产生。
波特率发生器通过对UART0模式寄存器0（UA0MOD0）的波特率时钟选择位（U0CK1，U0CK0）选择的时钟进行计数来生成波特率。波特率发生器的计数值可通过写入UART0波特率寄存器H或L（UA0BRTH，UA0BRTL）来设置。最大计数为4096。
UA0BRTH和UA0BRTL的设定值用下式表示。
时钟频率（Hz）UA0BRTH，L=波特率（bps）–1
表14-2列出了典型波特率的计数值。

图 PDF 197页

注：
-当UA0BRTH或UA0BRTL设置为小于“0007H”的值时，将从UA0BRTH或UA0BRTL读取设置的值，但波特率时钟计数器的值与UA0BRTH或UA0BRTL设置为“0008H”时的值相同。
-当为时钟指定65.536 kHz（LSCLK×2）时，通过将频率控制寄存器1（FCON1）的位2（ENMLT）设置为“1”，启用2×低速时钟的操作。
-用定时器补偿500kHz的RC振荡，可在9600bps时支持+/-2%或更小的误差。见第10.3.2节，“频率测量模式”。

##### 14.3.3 传输数据方向

图14-4显示了发送/接收缓冲器和发送/接收数据之间的关系。

图 PDF 198页

注：
当TXD0引脚设置为接收模式下的辅助功能输出时，TXD0引脚输出“H”电平。

##### 14.3.4 传输操作

通过将UART0模式寄存器0（UA0MOD0）的U0IO位设置为“0”来选择传输模式，并将UART0控制寄存器（UA0CON）的U0EN位设置为“1”来启动传输。
图14-5显示了传输的操作时序。图 PDF 200页
当U0EN位设置为“1”（1）时，波特率发生器生成波特率设置的内部传输时钟并开始传输。
起始位通过内部传输时钟（2）的下降沿输出到TXD0引脚。随后，输出发送数据、奇偶校验位和停止位。
当输出起始位（2）时，请求UART0中断。在UART0中断程序中，下一个要发送的数据被写入发送/接收缓冲器（UA0BUF）。
当要发送的下一个数据被写入发送/接收缓冲器（UA0OBUF）时，发送缓冲器状态标志（U0FUL）被设置为“1”（3），并且在发送停止位之后在内部传输时钟（4）的下降沿上请求UART0中断。如果UART0中断例程在没有将下一个数据写入发送/接收缓冲器的情况下终止，则U0FUL位未设置为“1”（5），并且传输一直持续到停止位的传输，则U0EN位重置为“0”，并请求UART0中断。
要写入发送/接收缓冲器的下一个发送数据的有效期是从中断的产生到停止位传输的终止。(6)

##### 14.3.5 接收操作

通过使用UART0模式寄存器0（UA0MOD0）的U0RSEL位选择接收数据输入引脚，然后将UA0MOD0的U0IO位设置为“0”以选择接收模式，然后将UART0控制寄存器（UA0CON）的U0EN位设置为“1”来启动接收。
图14-6显示了接收的操作定时。图PDF 201页
当接收操作开始时，LSI检查发送到输入引脚RXD0的数据，并等待开始位的到来。当检测到起始位（2）时，LSI生成以起始位检测点为基准设置的波特率的内部传输时钟，并执行接收操作。
移位寄存器在内部传输时钟的上升沿将输入到RXD的数据移位。数据和奇偶校验位被移入移位寄存器，5到8位的接收数据被传输到发送/接收缓冲器（UA0BUF），同时内部传输时钟下降3。
LSI请求在内部传输时钟的上升沿上的UART0中断，该内部传输时钟随后是接收数据的内部传输时钟（4），并检查停止位错误和奇偶校验位错误。当检测到错误时，LSI将UART0状态寄存器（UA0STAT）的相应位设置为“1”。
如图14-6所示，设置内部传输时钟的上升，使其可能落在接收数据的位间隔的中间。
接收继续，直到U0EN位被程序重置为“0”。当U0EN位在接收期间重置为“0”时，接收到的数据可能会被销毁。当U0EN位在图14.6中的“U0EN重置启用期间”重置为“0”时，接收的数据受到保护。

##### 14.4 指定端口寄存器

当您想确保UART功能正常工作时，请检查是否指定了相关的端口寄存器。有关端口寄存器的详细信息，请参阅第21章“端口4”和第18章“端口0”。

##### 14.4.1 将P43（TXD0）和P42（RXD0）用作UART。
将P43MD1-P42MD1位（P4MOD1寄存器的位3-位2）设置为“0”，将P43MD0-P42MD0位（P4MOD0寄存器的位3-位2）设置为“1”，以将UART指定为P43和P42的辅助功能。

图 PDF 203页

将P43C1位（P4CON1寄存器的位3）设置为“1”，将P43C0位（P4CON0寄存器的位3）设置为“1”，并将P43DIR位（P4DIR寄存器的位3）设置为“0”，以将P43指定为CMOS输出。
将P42DIR位（P4DIR寄存器的位2）设置为“1”，以指定P42作为输入引脚。
P42C1位和P42C0位的数据设置取决于连接到P42的应用电路。

P43D-P42D位（P4D寄存器的bit3-2）的数据对UART函数没有影响，因此不必关心函数的数据。

*：位与UART无关（使用P43和P42）功能

**：不关心数据
$：任意

注：
接收引脚（RXD）由U0RSEL位（UA0MOD0寄存器的位4）选择。将位重置为“0”（初始值）选择P02引脚，将位设置为“1”选择P43引脚。

##### 14.4.2 将P43（TXD0）和P02（RXD0）用作UART。

图 PDF 204 页

将P43MD1位（P4MOD1寄存器的位3）设置为“0”，将P43MD0位（P4MOD0寄存器的位3）设置为“1”，以将UART指定为P43的辅助功能

将P43C1位（P4CON1寄存器的位3）设置为“1”，将P43C0位（P4CON0寄存器的位3）设置为“1”，并将P43DIR位（P4DIR寄存器的位3）设置为“0”，以将P43指定为CMOS输出。

P43D位（P4D寄存器的bit3）的数据对UART函数没有影响，所以不关心函数的数据。

P02是一个只输入的端口，因此不需要指定数据方向（即输入或输出）。P02C1位和P02C0位的数据设置取决于连接到P02的应用电路。

P02D位（P0D寄存器的位2）的数据对UART功能没有影响，因此不关心该功能的数据。

*：位与UART无关（使用P43和P02）功能

**：不关心数据
$：任意

注：
接收引脚（RXD0）由U0RSEL位（UA0MOD0寄存器的位4）选择。将位设置为“0”（初始值）选择P02引脚，将位设置为“1”选择P43引脚。
即使P42被P42MD1位、P42MD0位、P42C1位、P42C0位和P42IDR位指定为RXD0，将“0”设置为U0RSEL位也会优先选择P02引脚作为RXD0。
P02（端口0）是一个仅输入端口，没有可以选择数据方向（输入或输出）或模式（主要或次要功能）的寄存器。

## 第十五章 I2C 总线接口

##### 15.1 楷述

此LSI包括1个I2C总线接口（主）通道。
端口4的辅助功能分配给I2C总线接口数据输入/输出引脚和I2C总线接口时钟输入/输出引脚。有关端口4，请参阅第21章“端口4”。

##### 15.1.1 特征

•主功能
•支持的通信速度包括标准模式(500kHz时为50kbps高速铁路）。

•7位地址格式（可支持10位地址）

注：
此LSI不支持仲裁功能（多主机）和时钟同步（握手）。

##### 15.1.2 配置

图15-1显示了I2C总线接口的配置。

图 PDF 207页

I2C0RD     I2c总线0接收注册

I2C0SA     I2c总线0从地址寄存器

I2C0TD     I2C传输数据寄存器总线0控制寄存器

I2C0CON  I2C总线0控制寄存器

I2C0MOD  I2C总线0模式寄存器

I2C0STAT   I2C总线状态寄存器

##### 15.1.3 针脚列表

---

P40/SDA       I2C总线接口数据输入/输出引脚。用于P40引脚的辅助功能。

---

P41/SCL        I2C总线接口时钟输入/输出引脚。用于P41引脚的辅助功能。

---

##### 15.2.1 寄存器列表

---

0F2A0H      I2C总线0接收寄存器

---

0F2A1H      I2C总线0从地址寄存器

----

0F2A2H      I2C总线0传输数据寄存器

---

0F2A3H      I2C总线0控制寄存器

---

0F2A4H       I2C总线0模式寄存器

---

0F2A5H      I2C总线0状态寄存器

---

##### 15.2.2  I2C总线0接收寄存器（I2C0RD）

地址：0F2A0H

访问：R

访问大小：8位

初始值：00H

I2C0RD是一个只读特殊功能寄存器（SFR），用于存储接收数据。

I2C0RD在每次接收完成后更新。

[位描述]
•I20R7-I20R0（位7-0）
I20R7到I20R0位用于存储接收数据。输入到SDA引脚的信号在从地址的传输和与SCL引脚上的信号上升沿同步的数据传输/接收时接收。由于输出到SDA和SCL管脚的数据不仅在数据接收时接收，而且在从地址数据发送和数据发送时接收，因此可以检查是否确实发送了发送数据。

##### 15.2.3 I2C总线0从地址寄存器 （I2C0SA）

地址：0F2A1H

访问：R/W

访问大小：8位

初始值：00H

I2C0SA是一个特殊功能寄存器（SFR），用于设置从设备的地址和发送/接收模式。
[位描述]

•I20RW（位0）
I20RW位用于选择数据传输模式（写入）或数据接收模式（读取）。

•I20A6-I20A0（位7-1）
I20A6到I20A0位用于设置通信目的地的地址

##### 15.2.4 I2C总线0传输数据寄存器（I2C0TD）

地址：0F2A2H

访问：R/W

访问大小：8位

初始值：00H

I2C0TD是一种特殊功能寄存器（SFR），用于设置传输数据。
[位描述]

•I20T7-0（位7-0）
I20T7至0位用于设置传输数据

##### 15.2.5 I2C总线0控制寄存器（I2C0CON）

地址：0F2A3H

访问：R/W

访问大小：8位

初始值：00H

I2C0CON是一种特殊功能寄存器（SFR），用于控制发送和接收操作。
[位描述]

•I20ST（位0）
I20ST位用于控制I2C总线接口的通信操作。当I20ST位设置为“1”时，通信开始。在发送/接收确认之后，当在控制寄存器设置等待状态中将“1”覆盖到I20ST位时，通信再次开始。当I20ST位设置为“0”时，强制停止通信。
只有当I2C总线接口处于操作启用状态（I20EN=“1”）时，I20ST位才能设置为“1”。当I20SP位设置为“1”时，I20ST位设置为“0”。

•I20SP（位1）
I20SP位是用于请求停止条件的只写位。切换到停止状态，通信停止。读取I20SP位时，始终读取“0”。
当I20SP位设置为“1”时，I2C总线

•I20RS（位2）
I20RS位是一个只写位，用于请求重复启动。当该位在数据通信期间设置为“1”时，I2C总线切换到重复启动条件，通信从从从机地址重新启动。
I20RS只能在通信激活时设置为“1”（I20ST=“1”）读取I20RS位时，“0”总是为读。

•I20ACT（位7）
I20ACT位用于设置接收完成时输出的确认信号。

##### 15.2.6 I2C总线0模式寄存器（I2C0MOD）

地址：0F2A4H

访问：R/W

访问大小：8位

初始值：00H

I2C0MOD是一个特殊功能寄存器（SFR），用于设置操作模式。
[位描述]

•I20EN（位0）
I20EN位用于启用I2C总线接口的操作。只有当I20EN位设置为“1”时，才能设置I20ST位，并且I20BB标志开始操作。当I20EN位设置为“0”时，与I2C总线0相关的所有SFR都将初始化。

•I20MD（位1）
I20MD位用于设置I2C总线接口的通信速度。使用I2C总线接口功能时，请将位设置为“1”。

•I20DW1，I20DW0（位3,2）
I20DW1和I20DW0位用于设置I2C总线接口的通信速度降低率。请将两位都设置为“0”。此功能不需要在ML610Q411/Q412/Q415上使用。

•I20SYN（位4）
I20SYN位用于选择是否使用时钟同步功能（握手功能）。
注：此LSI不支持时钟同步功能或多主机。请始终将位设置为“0”

##### 15.2.7 I2C总线0状态寄存器（I2C0STAT）

地址：0F2A5H

访问：R/W

访问大小：8位

初始值：00H

I2C0STAT是一个只读特殊功能寄存器（SFR），用于指示I2C总线接口的状态。
[位描述]

•I20BB（位0）
I20BB位用于指示I2C总线接口的使用状态。当I2C总线上生成启动条件时，该位设置为“1”，当生成停止条件时，该位设置为“0”。在多主机模式下，
即使另一个主设备正在使用I2C总线，该位也被设置为“1”。I2C0MOD的位为“0”。
当I20EN

•I20ACR（位1）
I20ACR位用于存储接收到的确认信号。
接收从机地址并完成数据传输或接收的时间。当I2C0MOD的I20EN位为“0”时。
每次I20ACR位设置为“0”时接收确认信号

•I20ER（位2）
I20ER位是表示传输错误的标志。当传输的位的值和SDA引脚的值不一致时，该位设置为“1”。即使I20ER设置为“1”，SDA仍然保持输出，直到随后的字节数据通信终止。
当执行对I2C0CON的写入操作时，I20ER位设置为“0”。
I2C0MOD的I20EN位设置为“0”。
当12CoMD的i20en位设置为“0”时，I20ER位设置为“0”

##### 15.3.1 通信操作模式

当通过使用I2C总线0模式寄存器（I2C0MOD）选择通信模式时，开始通信，通过使用I20EN位启用I2C功能，在I2C总线0从地址寄存器中设置从地址和数据通信方向，并将“1”写入I2C总线0控制寄存器（I2C0CON）的I20ST位。
##### 15.3.1.1 启动条件
当“1”写入I2C总线0控制寄存器的I20ST位（（I2C0CON），同时停止通信（I20ST位为“0”）时，通信开始，启动条件波形输出到SDA和SCL引脚。
在执行启动条件之后，LSI切换到从地址传输模式。

##### 15.3.1.2 重复启动条件

当在通信期间将“1”写入I2C总线0控制寄存器的I20RS和I20ST位（（I2C0CON）时（I20ST位为“1”），重复的启动条件波形输出到SDA和SCL引脚。如果仍希望在总线上进行通信，它可以生成一个重复的启动条件，寻址另一个从机并反转发送/接收，而无需首先生成停止条件（见图15-4数据发送/接收模式（写入/读取）切换时的操作定时）。
在执行重复启动条件之后，LSI切换到从地址传输模式。

##### 15.3.1.3 从机地址传输模式
在从地址传输模式下，I2C总线0从地址寄存器（I2C0SA）的值（从地址和数据通信方向）首先在MSB中传输，最后在I2C总线0状态寄存器（I2CSTAT）的I20ACR位中接收确认信号。I20ACR位在收到确认“0”后变为“0”，I20ACR位在收到确认“1”后变为“1”。
在确认接收完成时，LSI移到I2C总线0控制寄存器（I2C0CON）设置等待状态（控制寄存器设置等待状态）。
当LSI转移到I2C总线0控制寄存器（I2C0CON）设置等待状态（控制寄存器设置等待状态）时，从SDA引脚输出的I2C0SA值存储在I2C0RD中。

##### 15.3.1.4 数据传输方式
在数据传输模式下，I2C0TD的值首先在MSB中传输，最后在I2C总线0状态寄存器（I2CSTAT）的I20ACR位中接收确认信号。I20ACR位在收到确认“0”后变为“0”，I20ACR位在收到确认“1”后变为“1”。
在确认接收完成时，LSI移到I2C总线0控制寄存器（I2C0CON）设置等待状态（控制寄存器设置等待状态）。
SDA引脚输出的I2C0TD值存储在I2C0RD中。

##### 15.3.1.5 数据接收模式
在数据接收模式下，输入到SDA引脚的值与输出到SCL引脚的串行时钟上升沿同步接收，最后，I2C总线0控制寄存器（I2C0CON）的I20ACT位的值作为确认输出。例如，如图15-3和图15-4所示，在I20ACT位设置为“0”（I2CON=“01H”）之后，输出确认“0”（“图上的确认传输”），并且在I20ACT位设置为“1”（I2CON=“81H”）之后，输出确认“1”（“图上的非确认传输”）。
在确认传输完成时，LSI转移到I2C总线0控制寄存器（I2C0CON）设置等待状态（控制寄存器设置等待状态）。
接收到的数据在确认信号输出后存储在I2C0RD中。确认信号输出在I2C总线0状态寄存器（I2CSTAT）的I20ACR位中接收。

##### 15.3.1.6 控制寄存器设置等待状态

、当LSI转移到控制寄存器设置等待状态时，产生I2C总线接口中断（I2C0INT）。
在控制寄存器设置等待状态中，确认I2C总线0状态寄存器（I2C0STAT）的发送标志（I20ER）和确认接收数据（I20ACR），并且在数据接收时，在CPU中读取I2C0RD的内容并选择下一操作模式。

当“1”写入控制寄存器设置等待状态的I20ST位时，LSI移到数据传输或
接收模式。当“1”写入I20SP位时，LSI切换到停止状态。I20RS位和I2ST位，操作切换到重复启动条件。

##### 15.3.1.7 停止条件

在停止条件下，停止条件波形输出到SDA和SCL引脚。波形输出时，产生I2C总线接口中断（I2C0INT）。

##### 15.3.2 通信操作时序

图15-2至15-4显示了每种通信模式的操作时序和控制方法。

图 PDF 217 页

图15-5显示了发生确认错误时的操作时序和控制方法 图 PDF 218页

当传输位和SDA引脚的值不一致时，I2C总线0状态寄存器（I2C0STAT）的I20ER位设置为“1”，SDA引脚保持输出，直到随后的字节数据通信终止。通过写入I2C总线0控制寄存器（I2C0COCON），I20ERR位被初始化为“0”。
图15-6显示了传输失败时的操作时序和控制方法。

图 PDF 218页

##### 15.3.3 操作波形

图15-7显示了SDA和SCL信号以及I20BB标志的操作波形。通信速度和HSCLK时钟计数之间的关系。
表15-1显示了 

图 PDF 219页

注意
-设置HSCLK时钟计数，以便在HSCLK为500kHz时将通信速度设置为50kbps。

##### 15.4 指定端口寄存器

当您想确保I2C总线接口功能正常工作时，请检查是否指定了相关的端口寄存器。有关端口寄存器的详细信息，请参阅第21章“端口4”。

##### 15.4.1将P41（SCL）和P40（SDA）用作I2C

将P41MD1-P40MD1位（P4MOD1寄存器的位1-0）设置为“0”，将P41MD0-P40MD0位（P4MOD0寄存器的位1-0）设置为“1”，以指定I2C作为P41和P40的辅助功能。

图 PDF 220页

将P41C1-P40C1位（P4CON1寄存器的位1-0）设置为“1”，将P41C0-P40C0位（P4CON0寄存器的位1-0）设置为“0”，并将P41DIR-P40DIR位（P4DIR寄存器的位1-0）设置为“0”，以将P41和P40指定为Nch开漏输出。I2C总线上需要漏极开路/集电极开路输出，以避免H电平和L电平之间的冲突。

P41D-P40D位（P4D寄存器的位1-0）的数据对I2C函数没有影响，因此不关心函数的数据。

*：位与I2C功能无关

**：不关心数据

## 第十六章 NMI引脚

##### 16.1 楷述

这个LSI包括一个输入端口（NMI），它产生一个不可屏蔽的中断。关于中断，见第5章“中断”。

##### 16.1.1 特征

•不可屏蔽中断引脚。
•允许使用上拉电阻器或高阻抗输入选择输入。

•对NMI中断（NMINT）应用噪声滤波器。

##### 16.1.2 配置

图16-1显示了NMI引脚的配置。图 PDF 222页



##### 16.1.3 引脚列表

---

NMI     不可屏蔽中断输入端口。

---

##### 16.2.1 寄存器列表

---

0F200H   NMI数据寄存器

---

0F201H    NMI控制寄存器

----

##### 16.2.2 NMI数据寄存器 （NMID）

地址： 0F200H

访问：R

访问空间：8bits

初始值：依靠引脚状态

NMID是一个只读的特殊功能寄存器（SFR），用于读取NMI引脚级别。
[位描述]

•NMI（位0）
NMI位用于读取NMI引脚的电平。

##### 16.2.3 NMI控制寄存器 （NMICON）

地址： 0F201H

访问：R/W

访问空间：8bits

初始值：00H

NMICON是一个特殊功能寄存器（SFR），用于选择NMI引脚的输入模式。
[位描述]

•NMIC（位0）
NMIC位用于选择带或不带上拉电阻器的输入模式。

##### 16.3 操作说明

不可屏蔽NMI中断（NMIINT）分配给NMI引脚。
NMI引脚允许使用NMI控制寄存器（NMICON）选择带有上拉电阻器的输入模式或高阻抗输入模式。在系统复位时，选择带有上拉电阻器的输入模式。
NMI引脚的电平可以通过读取NMI数据寄存器（MMID）来读取。

##### 16.3.1 中断请求

当持续时间超过最小NMI中断脉冲宽度后，NMI引脚发生电平变化时，将生成不依赖于主中断启用标志（MIE）的不可屏蔽中断。
图16-2显示了NMI中断生成时序。

图 PDF 226页

## 第17章 端口0

##### 17.1 楷述

此LSI包括端口0（P00到P03），这是一个4位输入端口。

##### 17.1.1 特点

•所有位都支持可屏蔽中断功能。
•允许选择中断禁用模式、下降沿中断模式、上升沿中断模式或两者
每个位的中断模式。
•允许为每个位选择有/无中断采样。（采样频率：T16KHZ）
•允许选择高阻抗输入模式、带下拉电阻器的输入模式或带上拉电阻器的输入模式
每个位的电阻器。
•P00和P01引脚可用作捕捉电路的触发输入引脚，P02引脚可用作触发输入引脚
UART0的RXD0输入引脚。

##### 17.1.2 配置

图17-1显示了端口0的配置。图 PDF 228页

##### 17.1.3 针脚列表

---

P00/EXI0/CAP0     输入端口，外部0中断，捕捉0触发信号输入

---

P01/EXI1/CAP1     输入端口，外部1中断，捕获1触发信号输入

---

P02/EXI2/RXD0     输入端口，外部2中断，UART0数据输入（RXD0）

---

P03/EXI3     输入端口，外部3中断

---

##### 17.2.1 寄存器列表

---

0F204H      端口0数据寄存器0

---

0F206H      端口0控制寄存器0

---

0F207H      端口0控制寄存器1

---

0F020H      外部中断控制寄存器0

---

0F021H      外部中断控制寄存器1

---

0F022H      外部中断控制寄存器2

---

##### 17.2.2 端口0数据寄存器（P0D）

地址：0F204H

访问：R

访问大小：8位

初始值：依赖于针脚的状态

P0D是一个特殊功能寄存器（SFR），只读取端口0的引脚电平。
[位描述]
•P03D-P00D（位3-0）
P03D到P00D位用于读取端口0的引脚电平。

##### 17.2.3 端口0控制寄存器0，1（p0con0，p0con1）

地址：0F206H

访问：R/W

访问大小：8位

初始值：00H

地址：0F207H

访问：R/W

访问大小：8位

初始值：00H

P0CON0和P0CON1是特殊功能寄存器（SFR），用于选择端口0的输入模式。

[位描述]
•P03C0-P00C0，P03C1-P00C1（位3-0）
ML610Q411/ML610Q412/ML610Q415用户手册
P03C0至P00C0位和P03C1至P00C1位用于选择高阻抗输入模式、带下拉电阻器的输入模式或带上拉电阻器的输入模式。P0nC0位和P0nC1位确定P0n的输入模式（例如：当P02C0=“0”和P02C1=“1”时，P02处于带有上拉电阻器的输入模式）。

##### 17.2.4 外部中断控制寄存器0，1（EXICON0，EXICON1）

地址：0F020H

访问：R/W

访问大小：8位

初始值：00H

----

地址：0F021H

访问：R/W

访问大小：8位

初始值：00H

EXICON0和EXICON1是特殊功能寄存器（SFR），用于选择端口0的中断边缘。

[位描述]
•P03E0-P00E0，P03E1-P00E1（位3-0）
P03E0至P00E0位和P03E1至P00E1位用于选择中断禁用模式、下降沿中断模式、上升沿中断模式或两个边缘中断模式。P0nE0位和P0nE1位决定P0n的中断模式（例如：当P02E0=“0”和P02E1=“1”时，P02处于上升沿中断模式）。

##### 17.2.5 外部中断控制寄存器2（EXICON2）

地址：0F022H

访问：R/W

访问大小：8位

初始值：00H

EXICON2是一个特殊的功能寄存器（SFR），用于选择有采样或无采样中断的信号边缘检测。

[位描述]
•P03SM-P00SM（位3-0）
P03SM到P00SM位用于选择端口0中断的信号边缘检测（带或不带采样）。采样时钟为低速时基计数器（LTBC）的T16KHZ。

P00SM

---

0     检测P00中断的输入信号边缘，无需采样（初始值）。

---

1    通过采样检测P00中断的输入信号边缘。

---

P01SM

---

0     检测P01中断的输入信号边缘，无需采样（初始值）。

---

1     通过采样检测P01中断的输入信号边缘。

---

P02SM

---

0     检测P02中断的输入信号边缘，无需采样（初始值）。

---

1     通过采样检测P02中断的输入信号边缘。

---

P03SM

---

0      检测P03中断的输入信号边缘，无需采样（初始值）。

---

1      通过采样检测P03中断的输入信号边缘。

---

注：
在停止模式下，由于16 kHz采样时钟停止，因此无论P00SM到P03SM中设置的值如何，都不会执行采样。

##### 17.3 操作说明

对于端口0的每个引脚，端口0控制寄存器0和1（P0CON0和P0CON1）的设置允许选择高阻抗输入模式、带下拉电阻器的输入模式或带上拉电阻器的输入模式。系统复位时选择高阻抗输入模式。
通过读取端口0数据寄存器（P0D），可以读取端口0的引脚电平

##### 17.3.1 外部中断/捕获功能

端口0引脚（P00、P01、P02、P03）可用于P00至P03中断（P00INT至P03INT）。P00到P03中断是可屏蔽的，可以选择中断启用或禁用。有关中断的详细信息，请参阅第5章“中断”。
P00和P01引脚可用作捕捉电路的触发输入，P02引脚可用作UART0的RXD0输入引脚。
有关捕获功能和UART功能，请分别参阅第8章“捕获”和第14章“UART”。

##### 17.3.2 中断请求

当用外部中断控制寄存器0、1或2（EXICON0、EXICON1或EXICON2）选择的中断边出现在端口0引脚时，可屏蔽P00（P01、P02或P03）中断（P00INT、P01INT、P02INT或P03INT）。图17-2显示了上升沿中断模式、下降沿中断模式和无采样的两种边缘中断模式下的P00至P03中断生成时序，以及上升沿中断模式下有采样的P00至P03中断生成时序。

图 PDF 234页

## 第18章 端口1

##### 18.1 楷述

此LSI包含一个2位输入端口，端口1（P10、P11）。
端口1可以有一个外部时钟输入引脚作为辅助功能。
关于外部时钟输入，参见第6章“时钟产生电路”。

##### 18.1.1 特点

•允许为每个位选择高阻抗输入模式、带下拉电阻器的输入模式或带上拉电阻器的输入模式。
•允许外部时钟输入引脚作为辅助功能。

##### 18.1.2 配置

图18-1显示了端口1的配置。

图 PDF 237页

##### 18.1.3 引脚列表

---

P10/OSC0     高速晶体/陶瓷振荡引脚，外部时钟输入引脚

---

P11          -

----

##### 18.2.1 寄存器列表

---

0F208H      端口1数据寄存器

---

0F20AH     端口1控制寄存器0

----

0F20BH      端口1控制寄存器1

----

##### 18.2.2端口1数据寄存器（P1D）

地址：0F208H

访问：R

访问尺寸：8位

初始值：依靠与引脚状态

P1D是专用于读取端口1引脚输入电平的特殊功能寄存器（SFR）。

[位描述]
•P11D、P10D（位1、0）
P11D和P10D位用于读取端口1引脚的输入电平。

（*）在外部时钟输入模式下（当FCON0寄存器的OSCM0位设置为“1”时），读取P10D位返回“0”。

##### 18.2.3 端口1控制寄存器0，1（p1con0，p1con1）

地址：0F20AH

访问：R/W

访问大小：8/16位

初始值：00H

地址：0F20BH

访问：R/W

访问大小：8位

初始值：00H

P1CON0和P1CON1是特殊功能寄存器（sfr），用于选择端口1的输入模式。

[位描述]
•P11C0、P10C0、P11C1、P00C1（位1-0）
P11C0、P10C0、P11C1和P00C1位用于选择高阻抗输入模式、带下拉电阻器的输入模式或带上拉电阻器的输入模式。

注：
当使用P10作为外部时钟输入引脚时，确保将P10引脚设置为高阻抗输入模式。

##### 18.3.1 输入端口功能

对于端口1的每个引脚，可以通过设置端口1控制寄存器0和1（P1CON0和P1CON1）来选择高阻抗输入模式、带下拉电阻器的输入模式和带上拉电阻器的输入模式之一。系统复位时，选择高阻抗输入模式作为初始状态。
端口1引脚的输入电平可以通过读取端口1数据寄存器（P1D）来读取。

##### 18.3.2 次要功能

外部时钟输入引脚作为辅助功能分配给端口1。为P10引脚提供时钟，并通过将频率控制寄存器0（FCON0）的OSCM0位设置为“1”来选择外部时钟输入模式。
注：
没有提供端口模式寄存器用于在端口1的主要功能和次要功能之间切换。当使用端口1引脚作为外部时钟输入时，引脚模式根据FCON0寄存器的OSCM0位中设置的值进行切换。
有关FCON0寄存器和外部时钟输入的详细信息，请参阅第6章“时钟生成电路”。

##### 

## 第十九章 端口2

##### 19.1 楷述

此LSI包括专用于输出的3位端口2（P20到P22）。
端口2可以输出低速时钟（LSCLK）、高速输出时钟（OUTCLK）和旋律作为辅助功能。时钟输出和蜂鸣器0（BZ0）输出分别见第6章“时钟产生电路”和第23章“蜂鸣器”。

##### 19.1.1 特征

•允许直接LED驱动。
•允许选择高阻抗输出模式、P通道开漏输出模式、N通道开漏输出模式
模式，或每个位的CMOS输出模式。
•允许输出低速时钟（LSCLK）、高速时钟（OUTCLK）或蜂鸣器0（BZ0）作为辅助
功能。

##### 19.1.2 配置

图19-1显示了端口2的配置。图 PDF 243页

##### 19.1.3 引脚列表

----

P20/LED0/LSCLK       输出端口 直接驱动LED

---

P21/LED1/OUTCLK    输出端口 直接驱动LED

---

P22/LED2         输出端口 直接驱动LED

---

##### 19.2.1 寄存器列表

---

0F210H        端口2数据注册

----

0F212H        端口2控制寄存器0

---

0F213H        端口2控制寄存器1

---

0F214H        端口2模式寄存器

----



##### 19.2.2 端口2数据寄存器（P2D）

地址：0F210H

访问：R/W

访问大小：8位

初始值：00H

P2D是一个特殊功能寄存器（SFR），用于设置端口2的输出值。写入P4D的值是可读的。
[位描述]
•P22D-P20D（位2-0）
P22D到P20D位用于设置端口2引脚的输出值。
这个寄存器的值被输出到端口4。

---

P22D

---

0         P22引脚的输出电平：“L”

---

1          P22引脚的输出电平：“H”

---

P21D

---

0         P21引脚输出电平“L”

---

1         P21引脚输出电平“H”

---

P20D

---

0          P20引脚输出电平"L"

---

1          P20引脚输出电平"H"

---

##### 19.2.3 端口2控制寄存器0，1（P2CON0，P2CON1）

地址：0F212H

访问：R/W

访问大小：8/16位

初始值：00H

地址：0F213H

访问：R/W

访问大小：8位

初始值：00H

P2CON0和P2CON1是特殊功能寄存器（SFR），用于选择输出引脚端口2的输出状态。
[位描述]
•P22C0-P20C0，P22C1-P20C1（位3-0）
P22C0至P20C0和P22C1至P20C1位用于选择高阻抗输出模式、P通道开漏输出模式、N通道开漏输出模式或CMOS输出模式。
要直接驱动LED，请选择N通道开漏输出模式。

图 PDF 246页

P22引脚：P通道开漏输出模式

##### 19.2.4 端口2模式寄存器（P2MOD）

地址：0F214H

访问：R/W

访问大小：8位

初始值：00H

P2MOD是一个特殊功能寄存器（SFR），用于选择端口2的主要功能或次要功能

[比特说明]

•P22MD（位2）
P22MD位用于选择P22引脚的主功能或辅助功能。

---

0     通用输出端口功能（初始值）

---

1     蜂鸣器0（BZ0）输出功能

---

•P21MD（位1）
P21MD位用于选择P21引脚的主要功能或次要功能。

---

0     通用输出端口功能（初始值）

----

1     高速输出时钟（OUTCLK）输出功能

---

•P20MD（位0）
P20MD位用于选择P20引脚的主要功能或次要功能。

---

0       通用输出端口功能（初始值）

---

1      低速时钟（LSCLK）输出功能

---

注：
端口2（P20、P21和P22）的输出特性在每个位（P20MD、P21MD、P22MD）为“1”时对应于VOL1和VOH1，在位为“0”时对应于VOL2和VOH2，见附录C“电气特性”。

##### 19.3.1 输出端口功能
对于端口2的每个管脚，可以通过设置端口2控制寄存器0和1（P2CON0和P2CON1）来选择高阻抗输出模式、P通道开漏输出模式、N通道开漏输出模式和CMOS输出模式中的任何一种。在系统复位时，选择高阻抗输出模式作为初始状态。
根据端口2数据寄存器（P2D）中设置的值，“L”电平或“H”电平信号输出到端口2的每个引脚。

##### 19.3.2 次要功能

低速时钟（LSCLK）输出、高速输出时钟（OUTCLK）输出或蜂鸣器0（MD0）输出作为辅助功能分配给端口2。辅助功能可通过将端口2模式寄存器（P2MOD）的P22MD到P20MD位设置为“1”来使用。
时钟输出和蜂鸣器0（BZ0）输出分别见第6章“时钟产生电路”和第23章“蜂鸣器”。

## 第20章 端口3

##### 20.1 楷述

此LSI包括端口3（P30到P35），这是一个6位输入/输出端口。
该端口还可用作RC-ADC（通道0）振荡引脚（IN0、CS0、RS0、RT0、RCT0、RCM）以及二次和三次模式中的PWM输出引脚。
关于RC-ADC和PWM，参见第24章“RC振荡型A/D转换器”和第11章“PWM”。

##### 20.1.1 特点

•允许在输出模式下为每个位选择高阻抗输出、P通道开漏输出、N通道开漏输出或CMOS输出。
•允许在每个位的输入模式下选择高阻抗输入、带下拉电阻器的输入或带上拉电阻器的输入。
•RC-ADC（通道0）振荡引脚（IN0、CS0、RS0、RT0、RCT0、RCM）和PWM输出引脚（PWM0）可用作辅助功能。

##### 20.1.2 配置

图20-1显示了端口3的配置。

图 PDF 250页

##### 20.1.3 指针列表

---

PN30/IN0      RC-ADC振荡波形输入引脚

---

P31/CS0        RC-ADC的参考电容器连接引脚

---

P34/RCT0/PWM0      RC-ADC测量用电阻/电容传感器连接引脚

----

P32/RS0     RC-ADC的参考电阻连接引脚

---

P33/RT0     RC-ADC测量用电阻传感器连接引脚

---

P35/RCM     RC-ADC的RC振荡监视器引脚

----

##### 20.2.1 寄存器列表

---

0F218H     端口3数据寄存器        P3D

---

0F219H     端口3方向寄存器       P3DIR

---

0F21AH    端口3控制寄存器0     P3CON0

---

0F21BH    端口3控制寄存器1      P3CON1

---

0F21CH   端口3模型寄存器0       P3MOD0

---

0F21DH 端口3模型寄存器1        P3MOD1

---

##### 20.2.2 端口3数据寄存器（P3D）

地址：0F218H

访问：R/W

访问大小：8位

初始值：00H

P3D是一个特殊功能寄存器（SFR），用于设置输出到端口3引脚的值或读取端口3的输入电平。在输出模式下，此寄存器的值输出到端口3引脚。写入P3D的值是可读的。在输入模式下，读取P3D时读取端口3引脚的输入电平。使用后面描述的端口模式寄存器（P3DIR）选择输出模式或输入模式。
[位描述]
•P35D-P30D（位5-0）
P35D到P30D位用于在输出模式下设置端口3引脚的输出值，并在输入模式下读取端口3引脚的引脚电平。

图 PDF 253页

##### 20.2.3 端口3方向寄存器（P3DIR）

地址：0F219H

访问：R/W

访问大小：8位

初始值：00H

P3DIR是一个特殊功能寄存器（SFR），用于选择端口3的输入/输出模式。
[位描述]
•P35DIR-P30DIR（位5-0）
P35DIR至P30DIR引脚用于设置端口3引脚的输入/输出方向。

图 PDF 254页

##### 20.2.4 端口3控制寄存器0，1（P3CON0，P3CON1）

地址：0F21AH

访问：R/W

访问大小：8/16位

初始值：00H

----

地址：0F21BH

访问：R/W

访问大小：8位

初值：00H

---

P3CON0和P3CON1是特殊功能寄存器（SFR），用于选择端口3引脚的输入/输出状态。输入/输出状态在输入模式和输出模式之间是不同的。使用P3DIR寄存器选择输入或输出。
[位描述]
•P35C1-P30C1、P35C0-P30C0（位5-0）
P35C1至P30C1引脚和P35C0至P30C0引脚用于在输出模式下选择高阻抗输出、P通道开漏输出、N通道开漏输出或CMOS输出，以及在输入模式下选择高阻抗输入、使用下拉电阻器输入或使用上拉电阻器输入。

图 PDF 256页

##### 20.2.5 端口3模式寄存器0、1（P3MOD0、P3MOD1）

地址：0F21CH

访问：R/W

访问大小：8/16位

初始值：00H

----

地址：0F21DH

访问：R/W

访问大小：8位

初始值：00H

---

P3MOD0和P3MOD1是特殊功能寄存器（SFR），用于选择端口3的主要、次要或第三功能。
[位描述]
•P35MD1、P35MD0（位5）
P35MD1和P35MD0位用于选择P35引脚的主要或次要功能。

•P34MD1、P34MD0（位4）
P34MD1和P34MD0位用于选择P34引脚的主要、次要或第三功能。

•P33MD1、P33MD0（位3）
P33MD1和P33MD0位用于选择P33引脚的主要或次要功能。

•P32MD1、P32MD0（位2）
P32MD1和P32MD0位用于选择P32引脚的主要或次要功能。

•P31MD1、P31MD0（位1）
P31MD1和P31MD0位用于选择P31引脚的主要或次要功能。

•P30MD1、P30MD0（位0）
P30MD1和P30MD0位用于选择P30引脚的主要或次要功能。

注：
如果上述任何位组合被设置为“禁止”，并且端口3的相应位被单独指定为
输出模式（在port3控制寄存器中选择），相应引脚的状态是固定的，与port3寄存器（P3D）的内容无关
高阻抗输出模式：高阻抗P通道开漏输出模式：高阻抗N通道开漏输出模式：固定为“L”CMOS输出模式：高阻抗：固定为“L”
当使用RC-ADC作为辅助功能时，将每个引脚指定为“高阻抗输入”甚至RC振荡监视器引脚。上拉或下拉输入使绘制电流。

##### 20.3.1 输入/输出端口功能
对于端口3的每个引脚，通过设置端口3方向寄存器（P3DIR）选择输出或输入。
在输出模式下，可以通过设置端口3控制寄存器0和1（P3CON0和P3CON1）来选择高阻抗输出模式、P通道开漏输出模式、N通道开漏输出模式或CMOS输出模式。
在输入模式下，通过设置端口3控制寄存器0和1（P3CON0和P3CON1），可以选择高阻抗输入模式、带下拉电阻器的输入模式或带上拉电阻器的输入模式。
在系统复位时，选择高阻抗输出模式作为初始状态。
在输出模式下，根据端口3数据寄存器（P3D）设置的值，“L”或“H”电平输出到端口3的每个引脚。
在输入模式下，可以从端口3数据寄存器（P3D）读取端口3每个引脚的输入电平。

##### 20.3.2 二级和三级功能

二级和三级功能作为RC-ADC（通道0）振荡引脚（IN0、CS0、RS0、RT0、RCT0、RCM）和PWM输出引脚（PWM0）分配给端口3。通过设置端口3模式寄存器（P3MOD0、P3MOD1）的P35MD0至P30MD0位和P35MD1至P30MD1位，这些引脚可用于第二或第三功能模式。关于RC-ADC和PWM，参见第24章“RC振荡型A/D转换器”和第11章“PWM”。
注：
除P35/RCM以外的所有端口3引脚配置为A/D转换期间RC-ADC功能专用的引脚。因此，如果存在任何未使用的管脚，则该管脚不能在A/D转换期间用作其主要功能。对于RC-ADC，参见第24章“RC振荡型A/D转换器”。

## 第21章 端口4

##### 21.1 楷述

此LSI包括端口4（P40到P47），这是一个8位输入/输出端口。
此端口可以具有I2C总线、RC-ADC、同步串行端口和PWM输出功能作为二级和三级功能。
参考以下章节：
I2C总线：
通用异步收发器：
RC-ADC：
同步串口：PWM：

##### 21.1.1特点

第15章“I2C总线接口”
第14章“UART”
第24章RC振荡型A/D转换器第13章同步串口
第11章“PWM”
•允许为输出模式中的每个位选择高阻抗输出、P通道开漏输出、N通道开漏输出或CMOS输出。
•允许为输入模式中的每个位选择高阻抗输入、带下拉电阻器的输入或带上拉电阻器的输入。
•P44和P45引脚可用作定时器和PWM的外部时钟输入引脚。
•I2C总线接口引脚（SDA、SCL）、UART引脚（RXD0、TXD0）、RC-ADC（通道1）振荡引脚（IN1，
CS1、RS1、RT1）、同步串行端口引脚（SIN0、SCK0、SOUT0）和PWM输出引脚（PWM0）可用作辅助功能。

##### 21.1.2 配置

图21-1显示了端口4的配置。

图 PDF 261页

##### 21.1.3 指针列表

图PDF 262页

##### 21.2.1 寄存器列表

---

0F220H   端口4数据寄存器    P4D

---

0F221H  端口4方向寄存器    P4DIR

---

0F222H 端口4控制寄存器0    P4CON0

---

0F223H   端口4控制寄存器1  P4CON1

----

0F224H   端口4模式寄存器0   P4MOD0

---

0F225H    端口4模式寄存器1  P4MOD1

----

##### 21.2.2 端口4数据寄存器（P4D）

地址：0F220H

访问：R/W

访问大小：8位

初始值：00H

P4D是一个特殊功能寄存器（SFR），用于设置输出到端口4引脚的值或读取端口4的输入电平。在输出模式下，该寄存器的值输出到端口4引脚。写入P4D的值是可读的。在输入模式下，端口4引脚的输入电平在读取P4D时读取。使用后面描述的端口模式寄存器（P4DIR）选择输出模式或输入模式。
[位描述]
•P47D-P40D（位7-0）
P47D到P40D位用于在输出模式下设置端口4引脚的输出值，并在输入模式下读取端口4引脚的引脚电平。

图 PDF 264 页

##### 21.2.3 端口4方向寄存器（P4DIR）

地址：0F221H

访问：R/W

访问大小：8位

初始值：00H

P4DIR是一个特殊功能寄存器（SFR），用于选择端口4的输入/输出模式。
[位描述]
•P47DIR-P40DIR（位7-0）
P47DIR至P40DIR引脚用于设置端口4引脚的输入/输出方向。

##### 21.2.4 端口4控制寄存器0，1（P4CON0，P4CON1）

地址：0F222H

访问：R/W

访问大小：8/16位

初始值：00H

---

地址：0F223H

访问：R/W

访问大小：8位

初始值：00H

---

P4CON0和P4CON1是特殊功能寄存器（SFR），用于选择P4引脚的输入/输出状态。输入/输出状态在输入模式和输出模式之间是不同的。使用P4DIR寄存器选择输入或输出。
[位描述]
•P47C1-P40C1、P47C0-P40C0（位7-0）
P47C1至P40C1引脚和P47C0至P40C0引脚用于在输出模式下选择高阻抗输出、P通道开漏输出、N通道开漏输出或CMOS输出，以及在输入模式下选择高阻抗输入、使用下拉电阻器输入或使用上拉电阻器输入。



##### 21.2.5 端口4模式寄存器0、1（P4MOD0、P4MOD1）

地址：0F224H

访问：R/W

访问大小：8/16位

初始值：00H

---

地址：0F225H

访问：R/W

访问大小：8位

初始值：00H

---

P4MOD0和P4MOD1是特殊功能寄存器（sfr），用于选择P4的主要、次要或第三功能。
[位描述]
•P47MD1、P47MD0（位7）
P47MD1和P47MD0位用于选择P47引脚的主要或次要功能。

•P46MD1、P46MD0（位6）
P46MD1和P46MD0位用于选择P46引脚的主要、次要或第三功能。

•P45MD1、P45MD0（位5）
P45MD1和P45MD0位用于选择P45引脚的主要、次要或第三功能。

•P44MD1、P44MD0（位4）
P44MD1和P44MD0位用于选择P44引脚的主要、次要或第三功能。

•P43MD1、P43MD0（位3）
P43MD1和P43MD0位用于选择P43引脚的主要、次要或第三功能。

•P42MD1、P42MD0（位2）
P42MD1和P42MD0位用于选择P42引脚的主要、次要或第三功能

•P41MD1、P41MD0（位1）
P41MD1和P41MD0位用于选择P41引脚的主要、次要或第三功能。

•P40MD1、P40MD0（位0）
P40MD1和P40MD0位用于选择P40引脚的主要、次要或第三功能。

注：
如果任何位组合
输出模式（在port4控制寄存器中选择），相应引脚的状态是固定的，与port4寄存器（P4D）的内容无关
高阻抗输出模式：高阻抗P通道开漏输出模式：高阻抗N通道开漏输出模式：固定为“L”CMOS输出模式：高阻抗：固定为“L”

当使用RC-ADC作为辅助功能时，将每个引脚指定为“高阻抗输入”甚至RC振荡监视器引脚。上拉或下拉输入使绘制电流。

##### 21.3.1输入/输出端口功能

对于端口4的每个引脚，通过设置端口4方向寄存器（P4DIR）选择输出或输入。
在输出模式下，可以通过设置端口4控制寄存器0和1（P4CON0和P4CON1）来选择高阻抗输出模式、P通道开漏输出模式、N通道开漏输出模式或CMOS输出模式。
在输入模式下，通过设置端口4控制寄存器0和1（P4CON0和P4CON1），可以选择高阻抗输入模式、带下拉电阻器的输入模式或带上拉电阻器的输入模式。
在系统复位时，选择高阻抗输出模式作为初始状态。
在输出模式下，“L”或“H”电平根据端口4数据寄存器（P4D）设置的值输出到端口4的每个引脚。
在输入模式下，可以从端口4数据寄存器（P4D）读取端口4的每个引脚的输入电平。

##### 21.3.2 二级和三级功能

二级和三级功能分配给端口4，作为I2C总线0引脚（SDA、SCL）、UART 0引脚（RXD0、TXD0）、RC-ADC（通道1）振荡引脚（IN1、CS1、RS1、RT1）、同步串行端口0引脚（SIN0、SCK0、SOUT）和PWM输出引脚（PWM0）。通过设置端口4模式寄存器（P4MOD0、P4MOD1）的P47MD0至P40MD0位和P47MD1至P40MD1位，这些引脚可用于第二或第三功能模式。

I2C总线：
通用异步收发器：
RC-ADC：
同步串口：PWM：
第15章“I2C总线接口”
第14章“UART”
第24章RC振荡型A/D转换器第13章同步串口
第11章“PWM”

注：
端口4的P44到P47引脚配置为A/D转换期间RC-ADC功能专用的引脚。因此，如果存在任何未使用的管脚，则该管脚不能在A/D转换期间使用。对于RC-ADC，参见第24章“RC振荡型A/D转换器”。



## 第22章 端口 A

##### 22.1 楷述

ML610Q411/ML610Q415包括端口A（PA0到PA7），这是一个8位输入/输出端口。此功能不包括在ML610Q412中。

##### 22.1.1 特征

•允许为输出模式中的每个位选择高阻抗输出、P通道开漏输出、N通道开漏输出或CMOS输出。
•允许为输入模式中的每个位选择高阻抗输入、带下拉电阻器的输入或带上拉电阻器的输入。

##### 22.1.2 配置

图22-1显示了端口A的配置。

图 PDF 273 页

##### 22.1.3 针脚列表

PA0~PA7    输入和输出的端口

##### 22.2.1 寄存器列表

----

0F250H    端口A数据寄存器       PAD

---

0F251H    端口A方向寄存器      PADIR

----

0F252H    端口a控制寄存器0     PACON0

---

0F253H    端口a控制寄存器1     PACON1

---

##### 22.2.2 端口A数据寄存器（PAD）

地址：0F250H

访问：R/W

访问大小：8位

初始值：00H

---

PAD是一个特殊功能寄存器（SFR），用于设置输出到端口a引脚的值或读取端口a的输入电平。在输出模式下，此寄存器的值输出到端口4引脚。写入PAD的值是可读的。在输入模式下，读取PAD时读取端口A引脚的输入电平。通过使用后面描述的端口模式寄存器（PADIR）选择输出模式或输入模式。
[位描述]
•PA7D-PA0D（位7-0）
PA7D到PA0D位用于在输出模式下设置端口A引脚的输出值，并在输入模式下读取端口A引脚的引脚电平。

图 PDF 275页

##### 22.2.3 端口A方向寄存器（PADIR）

地址：0F251H

访问：R/W

访问大小：8位

初始值：00H

---

PADIR是一个特殊的功能寄存器（SFR），用于选择端口a的输入/输出模式。
[位描述]
•PA7DIR-PA0DIR（位7-0）
PA7DIR至PA0DIR引脚用于设置端口A引脚的输入/输出方向。

##### 22.2.4 端口A控制寄存器0.1（PACON0、PACON1）

地址：0F252H

访问：R/W

访问大小：8位

初始值：00H

---

地址：0F253H

访问：R/W

访问大小：8位

初始值：00H

---

PACON0和PACON1是特殊功能寄存器（sfr），用于选择端口A引脚的输入/输出状态。输入/输出状态在输入模式和输出模式之间是不同的。使用PADIR寄存器选择输入或输出。
[位描述]
•PA7C1-PA0C1、PA7C0-PA0C0（位7-0）
PA7C1至PA0C1引脚和PA7C0至PA0C0引脚用于在输出模式下选择高阻抗输出、P通道开漏输出、N通道开漏输出或CMOS输出，以及在输入模式下选择高阻抗输入、使用下拉电阻器输入或使用上拉电阻器输入。

图PDF 277 页

##### 22.3.1输入/输出端口功能
对于端口A的每个引脚，通过设置端口A方向寄存器（PADIR）来选择输出或输入。
在输出模式下，通过设置端口A控制寄存器0和1（PACON0和PACON1），可以选择高阻抗输出模式、P通道开漏输出模式、N通道开漏输出模式或CMOS输出模式。
在输入模式下，通过设置端口a控制寄存器0和1（PACON0和PACON1），可以选择高阻抗输入模式、带下拉电阻器的输入模式或带上拉电阻器的输入模式。
在系统复位时，选择高阻抗输出模式作为初始状态。
在输出模式下，“L”或“H”电平根据端口A数据寄存器（PAD）设置的值输出到端口A的每个引脚。
在输入模式下，可以从端口A数据寄存器（PAD）读取端口A每个引脚的输入电平。

## 第23章 蜂鸣器

##### 23.1 楷述

此LSI包括蜂鸣器驱动器的一个通道。
要使用蜂鸣器驱动器，应设置端口2的辅助功能。有关端口2的次要功能，请参阅第19章“端口2”。有关此蜂鸣器驱动器中使用的时钟，请参阅第6章“时钟生成电路”。

##### 23.1.1 特点

•在蜂鸣器输出模式下，可设置4种输出模式、8种频率和15种工作。

##### 23.1.2 配置

图23-1显示了蜂鸣器驱动器的配置。

图 PDF 281页

##### 23.1.3 针脚列表

---

P22/MD0      蜂鸣器0信号输出引脚用作p22引脚的辅助

----

##### 23.2.1 寄存器列表

---

0F2C0H    蜂鸣器0控制寄存器      MD0CON

---

0F2C1H   蜂鸣器0速度码寄存器    MD0TMP

---

0F2C2H    蜂鸣器0刻度代码寄存器  MD0TON

---

0F2C3H    蜂鸣器0音长码寄存器   MD0LEN

----



##### 23.2.2 蜂鸣器0控制寄存器      MD0CON

地址：0F2C0H

访问：R/W

访问大小：8位

初始值：00H

---

MD0CON是控制蜂鸣器的特殊功能寄存器（SFR）。

[描述位]

•M0RUN（位0）
M0RUN位用于控制蜂鸣器输出的启动/停止。

注：
蜂鸣器输出采用2×低速时钟（LSCLK×2）。
通过将频率控制寄存器1（FCON1）的第2位（ENMLT）设置为“1”来启用2×低速时钟，然后通过将M0RUN设置为“1”来启动蜂鸣器输出。

##### 23.2.3 蜂鸣器0时间码寄存器（MD0TMP）

地址：0F2C1H

访问：R/W

访问大小：8位

初始值：00H

---

MD0TMP是一个特殊的功能寄存器（SFR），用于选择蜂鸣器声音波形的输出模式。

[位描述]
•M0TM1、M0TM0（位1-0）

##### 23.2.4 蜂鸣器0刻度码寄存器（MD0TON）

地址：0F2C2H

访问：R/W

访问大小：8位

初始值：00H

----

MD0TON是一个特殊功能寄存器（SFR），用于选择蜂鸣器输出频率。

[描述位]

• M0TN2, M0TN1, M0TN0 (bits 2-0)

（*）因为LSCLK是由ML610Q415上的RC振荡产生的，所以频率根据RC振荡的特性而变化。

##### 23.2.5 蜂鸣器0音调长度代码寄存器（MD0LEN）

地址：0F2C3H

访问：R/W

访问大小：8位

初始值：00H

---

MD0LEN是一个特殊功能寄存器（SFR），用于选择蜂鸣器输出占空比。

[描述位]

•M0LN3、M0LN2、M0LN1、M0LN0（位3-0）

##### 23.3.1 蜂鸣器输出操作

按以下步骤输出蜂鸣器声音。

（1） 使用蜂鸣器速度码寄存器（MD0TMP）选择蜂鸣器输出模式。
（2） 使用蜂鸣器0音调长度代码寄存器选择蜂鸣器输出波形高电平宽度的占空比
（MD0LEN）。
（3） 在蜂鸣器0标度注销器（MD0TON）中设置蜂鸣器输出频率。
（4） 将频率控制寄存器1（FCON1）的位2（ENMLT）设置为“1”，以启用2×低速时钟。
（5） 当蜂鸣器0控制寄存器（MD0CON）的M0RUN位设置为“1”时，波形相当于
蜂鸣器声音输出。
图23-4显示了每个蜂鸣器输出模式的输出波形。

图 PDF 287页

##### 23.4 指定端口寄存器

当您想确保蜂鸣器功能正常工作时，请检查是否指定了相关的端口寄存器。有关端口寄存器的详细信息，请参阅第19章“端口2”。

##### 23.4.1 将P22（MD0）用作蜂鸣器输出

将P22MD位（P2MOD寄存器的位0）设置为“1”，以将蜂鸣器输出指定为P22的辅助功能。

将P22C1位（P2CON1寄存器的位0）设置为“1”，将P22C0位（P2CON0寄存器的位0）设置为“1”，以将P22指定为CMOS输出。

P22D位（P2D寄存器的位0）的数据不影响蜂鸣器功能，因此不关心该功能的数据。

-：位不存在。
*：位与蜂鸣器功能无关

**：不关心数据。

注：
-Port2是一个仅输出端口，没有用于选择数据方向（输入或输出）的寄存器。
-当P22MD位为“1”时，端口22的输出特性对应于VOL1和VOH1（选择旋律/蜂鸣器作为第二个功能），当P22MD位为“0”时，端口22的输出特性对应于VOL2和VOH2，如附录C“电气特性”所示。

## 第24章 RC振荡型A/D转换器

##### 24.1 楷述

该大规模集成电路具有内置的2通道RC振荡型a/D转换器（RC-ADC）。
RC-ADC通过计算振荡器时钟将电阻值或电容值转换为数字值，振荡器时钟的频率根据连接到RC振荡器电路的电阻器或电容器而变化。通过使用热敏电阻或湿度传感器作为电阻器，可以形成温度计或湿度计。
此外，RC-ADC的RC振荡器电路的两个通道中的每一个都可以使用不同的传感器来拓宽RC-ADC的应用范围；例如，转换器可以用于扩展测量范围或两点测量。
有关输入时钟，请参阅第6章“时钟生成电路”

##### 24.1.1 特点

•按时间划分的双通道系统

##### 24.1.2 配置

RC-ADC由两个RC振荡器电路组成，形成两个通道，计数器A（RADCA0–2）和计数器B
（RADCB0–2）作为24位二进制计数器和RC-ADC控制电路（RADCON、RADMOD）。RC-ADC的配置。

图 PDF 291页

##### 24.1.3 针脚列表

---

P30/IN0       通道0振荡输入引脚。用于P30引脚的辅助功能。

---

P31/CS0      通道0参考电容器连接引脚。用于P31引脚的辅助功能。

---

P34/RCT0    与电阻/电容传感器连接的针脚，用于测量频道0。用于P34引脚的辅助功能。

---

P32/RS0       通道0参考电阻器连接引脚。用于P32引脚的辅助功能。

---

P33/RT0       用于连接通道0上测量用电阻传感器的引脚。用于P33引脚的辅助功能。

---

P35/RCM      RC振荡监视器引脚。用于P35引脚的辅助功能。

---

P44/IN1       通道1振荡输入引脚。用于P44引脚的辅助功能。

---

P45/CS1       通道1参考电容器连接引脚。用于P45引脚的辅助功能。

---

P46/RS1       通道1参考电阻器连接引脚。用于P46引脚的辅助功能。

---

P47/RT1       用于连接通道1上测量用电阻传感器的针脚。用于P47引脚的辅助功能。

---

##### 24.2.1 寄存器列表

---

0F300H    RC-ADC计数器A寄存器0     RADCA0

---

0F301H    RC-ADC计数器A寄存器1    RADCA1

---

0F302H    RC-ADC计数器A寄存器2     RADCA2

---

0F304H    RC-ADC计数器B寄存器0     RADCB0

---

0F305H    RC-ADC计数器B寄存器1     RADCB1

---

0F306H    RC-ADC计数器B寄存器2    RADCB2

---

0F308H    RC-ADC模式寄存器      RADMOD

----

0F309H    RC-ADC控制寄存器     RADCON

----

##### 24.2.2 RC-ADC计数器A寄存器（RADCA0–2）

地址：0F300H

访问：R/W

访问大小：8位

初始值：00H

---

地址：0F301H

访问：R/W

访问大小：8位

初始值：00H

---

地址：0F302H

访问：R/W

访问大小：8位

初始值：00H

---

RADCA0–2作为24位二进制计数器（计数器A），是用于执行读/写操作以计数器A本身的特殊功能寄存器（SFR）。
注：
将数据写入RC-ADC计数器A寄存器后，请务必读取它，以检查数据是否已正确写入。
当数据写入后开始A/D转换时，在A/D转换期间读取已写入的值（RARUN=1）。
当A/D转换终止（RARUN=0）时，将读取计数值。

##### 24.2.3 RC-ADC计数器B寄存器（RADCB0–2）

地址：0F304H

访问：R/W

访问大小：8位

初始值：00H

---

地址：0F305H

访问：R/W

访问大小：8位

初始值：00H

---

地址：0F306H

访问：R/W

访问大小：8位

初始值：00H

---

RADCB0–2作为24位二进制计数器（计数器B），是用于对计数器B本身执行读/写操作的特殊功能寄存器（SFR）。
注：
将数据写入RC-ADC计数器B寄存器后，请务必读取该寄存器，以检查数据是否已正确写入。
当数据写入后开始A/D转换时，在A/D转换期间读取已写入的值（RARUN=1）。
当A/D转换终止（RARUN=0）时，将读取计数值。

##### 24.2.4 RC-ADC模式寄存器（RADMOD）

地址：0F308H

访问：R/W

访问大小：8位

初始值：00H

---

RADMOD是一种特殊功能寄存器（SFR），用于选择RC-ADC的a/D转换模式。
[位描述]

•OM3-0（位3-0）
OM3–0位用于为RC振荡器电路选择振荡模式。

•RADI（bit4）
RADI位用于选择是通过计数器A或计数器B的溢出来生成RC-ADC中断请求信号（RADINT）

•机架2-0（位7-5）
RACK2–0位用于选择内容A（BSCLK）的基本时钟。

注：
当为基本时钟指定LSCLK×2时，通过将频率控制寄存器1（FCON1）的位2（ENMLT）设置为“1”，启用2×低速时钟的操作。

##### 24.2.5 RC-ADC控制寄存器（RADCON）

地址：0F309H

访问：R/W

访问大小：8位

初始值：00H

---

RADCON是一种特殊的功能寄存器（SFR），用于控制RC-ADC的a/D转换操作。
[位描述]

•RARUN（位0）
RARUN位用于启动或停止RC-ADC的A/D转换。当RARUN设置为“1”时，A/D
转换开始，当设置为“0”时，A/D转换停止。设置为“1”，位自动复位为“0”。
系统复位时RARUN设置为“0”。

##### 24.3 操作说明
ML610Q411/ML610Q412/ML610Q415用户手册第24章RC振荡型A/D转换器
计数器A（RADCA0–2）是一个24位二进制计数器，用于计算基准时钟（BSCLK），它用作时间标准。计数器A最多可计数0ffffh。
计数器B（RADCB0–2）是一个24位二进制计数器，用于计算RC振荡器电路的振荡器时钟（RCCLK）。计数器B最多可计数0ffffh。
计数器A和B具有溢出标志（分别是OVFA和OVFB）。每个溢出输出产生RC-ADC中断请求信号（RADINT）。使用RC-AC模式寄存器（RADMOD）的RADI位选择是否通过计数器A或计数器B上的溢出生成溢出中断：将RADI设置为“0”指定计数器A溢出，将其设置为“1”指定计数器B溢出。
RC-AD控制寄存器（RADCON）的RARUN位用于启动或停止RC-ADC转换操作。当RARUN设置为“0”时，振荡器电路停止，因此将不执行计数。当RARUN设置为“1”时，RC振荡开始，RC振荡器时钟（RCCLK）和基时钟（BSCLK）通过计数器B和计数器A开始计数。
RC振荡部分基于RCOSC0和RCOSC1两种振荡电路，共有八种振荡模式，模式选择由RC-ADC模式寄存器（RADMOD）完成。
当分别使用1）RC振荡器电路RCOSC0、2）RC振荡器电路RCOSC1和3）输出RC振荡波形的RC监视器引脚（RCM）时，P30–34、P44–47和P35必须配置为其辅助功能输入或输出。RC振荡器电路的配置见第24.1.2节“配置”；端口3的二次功能见第20章“端口3”；端口4的二次功能见第21章“端口4”。

##### 24.3.1 RC振荡器电路

RC-ADC通过将参考电阻器（或电容器）和电阻传感器（或电容传感器）如热敏电阻之间的振荡频率比转换为数字数据来执行A/D转换。
通过使RC振荡在基准侧和具有基准电容的传感器侧都发生，RS振荡器电路本身的误差因子被消除，从而使得能够执行传感器本身特性的A/D转换。
另外，通过计算基准侧的振荡频率和传感器侧的振荡频率之间的比率，然后计算所计算的比率和传感器特性预先具有的温度之间的相关性，可以基于所计算的比率获得温度。
表24-1列出了八种振荡模式，其中一种由RC-ADC模式寄存器（RADMOD）OM3–0位选择。

图 PDF 297页

在表24-1中，模式0和模式7是在RC振荡器电路停止时，将输入到IN0或IN1引脚的外部时钟用于测量的模式。
如表24-1所示，为防止同时振荡时发生振荡干扰，规定了两个振荡器电路RCOSC0和RCOSC1，因此它们不能同时工作。
振荡频率frclk与RC常数之间的关系由以下公式表示：
1/FRCCLK = TRCCLK=KRCCLK*R*C
其中tRCCLK是振荡器时钟的周期，kRCCLK为比例常数，R􏰀C电容CS、CT、（CS+CVR）和（CT+CVR）的乘积，电阻RS和RT.CS，CT，（CS+CVR）、（CT+CVR）、RS和RT涉及振荡。kRCCLK的值根据电源电压VDD、RI、R或C的值略有变化。

表24-2列出了典型KRCLK值。

笔记：

•在端口3和端口4引脚中，用于RC-ADC功能的引脚使用模式寄存器（P3MOD0、P3MOD1、P4MOD0、，必须配置为对应的端口。

•除P35/RCM外的所有端口3引脚（见第24.1.3节“引脚列表”）配置为专用于端口的引脚
A/D转换期间的RC-ADC功能。因此，在A/D转换过程中，除了P35之外的所有端口3引脚不能在振荡模式0、1、2、3或4（由RADMOD寄存器选择）中用作其主要功能。同样，在5、6或7号振荡模式下，端口4的P44至P47引脚不能用作其主要功能。

图24-2至24-5显示了振荡器电路配置、每个配置的振荡模式以及OM3–0位设置。

图 PDF 299页

注：
上图中未使用的引脚RCT0被配置为a/D转换期间RC-ADC功能的专用引脚；因此，在A/D转换期间，RCT0不能用作端口（第34页）。

注：
上图中未使用的引脚RT0被配置为a/D转换期间RC-ADC功能的专用引脚；因此，在a/D转换期间，RT0不能用作端口（P33页）。

##### 24.3.2 计数器A/计数器B参考模式
RC-ADC转换操作有以下两种模式：

•计数器A参考模式（RADMOD RADI=“0”）
在这种模式中，门时间由计数器a和用作时间基准的基准时钟（BSCLK）确定，然后RC振荡器时钟（RCCLK）由计数器B在门时间内计数，以使计数器B的内容成为a/D转换值。
A/D转换值与RC振荡频率成正比。

•计数器B参考模式（RADMOD RADI=“1”）
在该模式中，门时间由计数器B和RC振荡器时钟（RCCLK）确定，并且用作时间基准的基时钟（BSCLK）由计数器a在门时间内计数，以使计数器a的内容成为a/D转换值。

D/D转换值与RC振荡频率成反比。

（1） 操作计数器参考模式
图24-6显示了参考模式下的操作定时。

以下是参考模式下的操作步骤示例：

1. 预设为计数器A（RADCA2–0）从最大值+1（1000000H）减去计数值“nA0”得到的值。计数值“nA0”和BSCLK时钟周期的乘积表示门时间。
2. 将“000000H”预设到计数器B（RADCB2–0）。
3. 将RADMOD的OM3–OM0位设置为所需振荡模式（见表16-1）。
4. 将RADMOD的RADI位设置为“0”，以指定计数器溢出产生中断请求信号。
5. 将RADCON的RARUN位设置为“1”，开始A/D转换。

当RARUN被设置为“1”并且RCON信号（与基准时钟下降同步的信号）被设置为“1”时，计数器A开始对基准时钟（BSCLK）进行计数。当计数器A溢出时，RARUN位自动重置为“0”（6），计数终止。同时，发生RC-ADC中断请求（RADIN）（7）。
当RCON信号设置为“1”时，RC振荡器电路开始工作，计数器B开始对RC振荡器时钟（RCCLK）计数。当RARUN位由于计数器A溢出而重置为“0”时，RC振荡停止，计数器B停止计数。
计数器B的最终计数值“nB0”是选通时间“nA0􏰀tBSCLK”期间的RCCLK计数值，用以下表达式表示：
nB0≅nA0•tBSCLK≅fRCCLK tRCCLK
其中tBSCLK表示BSCLK周期，tRCCLK表示RCCLK周期。也就是说，“nB0”是与RC振荡频率fRCCLK成比例的值。

图 PDF 301页

（2） 计数器参考模式下的操作

图24-7显示了计数器B参考模式下的操作定时。

以下是计数器B参考模式下的操作步骤示例

1. 为计数器B（RADCB2–0）预置通过从最大值+1（1000000H）中减去计数值“nB1”获得的值。计数值“nB1”和RCCLKclock周期的乘积表示选通时间。

2. 预设“000000 h”计数器A（RADCA2–0）。

3. 将RADMOD的OM3–OM0位设置为所需振荡模式（见表16-1）。

4. 将RADMOD的RADI位设置为“1”，以指定计数器B溢出产生中断请求信号。

5. 将RADCON的RARUN位设置为“1”，开始A/D转换。

   

当RARUN位被设置为“1”并且RCON信号（与基时钟下降同步的信号）被设置为“1”时，RC振荡器电路开始工作并且计数器B开始RC振荡器时钟（RCCLK）的计数。当计数器B溢出时，RARUN位自动复位（6），转换操作终止。同时，发生RC-ADC中断请求（RADINT）。(7)
当RCON信号设置为“1”时，计数器A开始对基本时钟（BSCLK）进行计数。当RARUN位由于计数器B溢出而复位时，计数器A停止计数。
计数器A的最终计数“nA1”是选通时间“nB1􏰀tRCCLK”期间的CLK计数值，用以下表达式表示：
nA1≅nB1•tRCCLK≅1 tBSCLK fRCCLK
也就是说，“nA1”是与RC振荡频率fRCCLK成反比的值。

图 PDF 303页

##### 24.3.3 RC振荡型A/D转换器的使用示例

本节介绍了以热敏电阻测温为例，对计数器A和B参考模式下的传感器值执行A/D转换的方法。
图24-8显示了使用RCOSC0的1热敏电阻RC振荡器电路的配置。图 PDF 304页

图24-9显示了热敏电阻RT0的温度特性。图 PDF 304页

RT0表示为温度T的函数，公式如下：

RT0 = f(T)

图24-10显示了A/D转换的理想特性，假设RT0是模拟量。在理想特性下，A/D转换值nT0将仅依赖于RT0。假设nT0与RT0成比例，让比例常数为K，那么nT0与温度T有以下关系：
nT0=K􏰀RT0=K􏰀f（T）。。。。。。表达式A
因此，通过执行符合以下条件的转换处理，可以将温度T表示为数字值：
图24-9所示的nT0软件特性。

要将RT0值转换为数字值，该比率用于a）连接到RT0引脚的热敏电阻器和连接到CS0引脚的电容器的振荡频率，以及b）连接到RS0引脚的参考电阻器（理想情况下应无温度特性）和连接到CS0引脚的电容器的振荡频率。这是为了使电阻以外的条件相等，以消除振荡特性中的误差因素。
如图24-9和24-11所示，RT0值取决于温度T，并且假设RS0值是恒定的，而不考虑温度T。如果使用这些电阻的振荡频率fOSC到温度T的特性与图24-12和24-13中的实线相似，则是理想的；然而，实际上，由于集成电路温度特性等误差因素，它们看起来像虚线。
由于fRCCLK（RT0）和fRCCLK（RS0）的条件除了电阻外是相同的，所以误差比几乎相同；因此，利用fRCCLK（RT0）和fRCCLK（RS0）之间的比值几乎可以消除误差。fRCCLK（RT0）和fRCCLK（RS0）之间的比率相当于上述A/D转换值nT0，理想情况下，该值仅取决于RT0。

图24-14显示了一个从模拟值RT0转换为数字值（即a/D转换）的一个周期的时序图，作为该方法的示例。
基本上，一个A/D转换周期必须包括两个步骤，如图24-14所示。需要两个步骤的原因是参考电阻器和热敏电阻器必须首先单独振荡，然后使用它们的振荡频率之间的比率，如上所述。
在下面的示例中，使用以下组合执行这两个步骤的操作：•第一步=RC振荡，RS0处于参考模式
•第二步=RC振荡，RT0处于计数器B参考模式
除此之外，还有几种可能的A/D转换方法。
在上述方法中，第二步骤的操作时间（栅极时间）根据热敏电阻RT0的值而波动。为避免操作时间波动，建议使用以下组合的方法：
•第一步=RC振荡，RS0处于计数器B参考模式
•第二步=参考模式下RT0的RC振荡

下面以图24-14为例说明A/D转换过程。

图 PDF 307页

<第一步>

1. 将基准时钟设置为32.768 kHz。（在FCON0中写“00H”。）
2. 在计数器A中预设“1000000H–nA0”
3. 在计数器B中预设“000000H”。
4. 在RADMOD中写入“01H”以选择参考模式和使用参考模式的振荡模式
   电阻RS0。
5. 在RADCON中写入“01H”，以启动A/D转换操作。
6. 在SBYCON的HLT位写入“1”（见第4章“MCU”），将设备设置为停止模式。

注：
在本例中，nA0被设置为4B0H，因为在具有参考电阻器RS0的振荡模式中的栅极时间“nA0􏰀tBSCLK”被设置为0.3666秒（在ML610Q411/Q412的情况下）。nA0值与A/D转换的量化误差裕度有关：nA0值越大，误差裕度越小。
为了减少CPU操作对RC振荡器电路的噪声污染，建议在RC振荡器工作时，将器件持续置于停止模式。
从该时间点开始，RC振荡器电路（RCOSC0）以参考电阻RS0继续振荡约0.366秒。然后，当计数器A溢出时，RADINT信号被设置为“1”，并且生成RC-ADC中断请求（部分（A））。此外，中断请求的生成释放了暂停模式（部分（b））
同时，A/D转换操作停止（第（c）节，RARUN bit=“0”）。至“000000H”。
此时计数器B的内容用以下表达式表示：
nB0=nA0􏰀tBSCLK。。。。。。表达B tRCCLK（RS0）
这就完成了第一步中的操作。

<第二步>

7. 根据计数器B“nB0”的内容计算“1000000H–nB0”，并在计数器B中设置获得的值。
   此时，需要清除计数器A；但是，由于计数器已设置为“000000H”，因此不需要进行任何处理。

8. 在RADMOD中写入“12H”，选择计数器B参考模式和使用热敏电阻RT0的振荡模式。

9. 在RADCON中写入“01H”开始A/D转换操作。

10. 在SBYCON的HLT位写入“1”（见第4章“MCU”），将设备设置为停止模式。

    

RC振荡器电路（RCOSC0）从此点开始随热敏电阻RT0振荡，直到计数器B溢出。该周期等于第一步中获得的“nB0”与使用RT0的振荡周期tRCCLK（RT0）的乘积。当计数器B溢出时，RADINT信号设置为“1”，并生成RC-ADC中断请求（第节）
（d） ）。此外，中断请求的生成释放了暂停模式（部分（e）），同时，A/D转换操作停止（部分（f），RARUN bit=“0”）。
这就完成了第二步中的操作。
此时计数器A的内容成为A/D转换值nA1，其由以下表达式表示：
nA1=nB0􏰀tRCCLK（RT0）。。。。。。表达式C tBSCLK
根据表达式B和C，nA1由以下表达式表示：
nA1=nA0􏰀tRCCLK（RT0）。。。。。。表达式D

其中tRCCLK（RS0）是参考电阻器RS0的振荡器时钟周期，tRCCLK（RT0）是热敏电阻器RT0的振荡器时钟周期。
由于振荡周期由“tRCCLK=kRCCLK􏰀R􏰀C”表示，因此tRCCLK（RS0）和tRCCLK（RT0）由以下表达式表示：
tRCCLK（RS0）=kRCCLK􏰀（CS0+CVR）􏰀RS0
...... 表达式E当表达式E替换表达式D时，nA1将为：
tRCCLK（RT0）=kRCCLK􏰀（CS0+CVR）􏰀RT0
nA1=nA0􏰀
RT0 RS0
由于“nA0”（“本例中为4B0H”）和RS0是值固定的常数，“nA1”是与RT0成比例的数字值。这个“nA1”对应于表达式A中的“nT0”。
最后介绍了用热敏电阻实现A/D转换的方法。已经获得的“nA1”还必须根据晶体管的温度电阻特性通过程序转换为诸如温度计的温度指示值之类的值。
24.3.4监测RC振荡
RC振荡器时钟（RCCLK）可以使用端口3的P35引脚的辅助功能输出。有关P35的辅助功能的详细信息，请参阅第20章“端口3”。
监视RC振荡有助于检查RC振荡器电路的特性。也就是说，可以测量传感器（例如热敏电阻）与振荡频率之间的关系。例如，可以通过检查包含热敏电阻的RC振荡器的环境温度、热敏电阻RT0的振荡频率和参考电阻器RS0的振荡频率之间的关系来获得从上述nA1值到温度指示值的转换系数。
注：
•P35（RCM）是振荡时钟的监视器引脚。通道0（P34-P30）和通道1（P47-P44）共用监视器引脚。
•请使用P35（RCM）进行评估，并在实际应用中运行时禁用输出，以将噪声降至最低。

##### 24.4 指定端口寄存器

当您想确保RC-ADC功能正常工作时，请检查是否指定了相关端口寄存器。有关端口寄存器的详细信息，请参阅第20章“端口3”和第21章“端口4”。

##### 24.4.1将P35（RCM）、P34（RCT0）、P33（RT0）、P32（RS0）、P31（CS0）和P30（IN0）用作RC-ADC（Ch0）

将P35MD1-P30MD1位（P3MOD1寄存器的位5-0）设置为“0”，将P35MD0-P30MD0位（P3MOD0寄存器的位5-0）设置为“1”，以将RC-ADC指定为P35、P34、P33、P32、P31和P30的辅助功能。

将P34C1-P30C1位（P3CON1寄存器的位4-0）设置为“0”，将P34C0-P30C0位（P3CON0寄存器的位4-0）设置为“0”，并将P34DIR-P30DIR位（P3DIR寄存器的位4-0）设置为“1”，以将P34-P30指定为高阻抗输入。
P34C1-P30C1位和P34C0-P30C0位可以设置为全部“1”，而不是全部“0”，以选择高阻抗输入。将P35C1位（P3CON1寄存器的位5）设置为“1”，将P35C0位（P3CON0寄存器的位5）设置为“1”，并将P35DIR位（P3DIR寄存器的位5）设置为“0”，以将P35指定为CMOS输出。

P35D-P30D位（P3D寄存器的bit5-0）的数据对RC-ADC功能没有影响，因此不必关心该功能的数据。

-：位不存在。
*：位与RC-ADC通道0无关（使用P35、P34、P33、P32、P31和P30）功能

**：不关心数据

##### 24.4.2 将P47（RT1）、P46（RS1）、P45（CS1）和P44（IN1）用作RC-ADC（Ch1）

将P47MD1-P44MD1位（P4MOD1寄存器的位7-位4）设置为“0”，将P47MD0-P44MD0位（P4MOD0寄存器的位7-位4）设置为“1”，以将RC-ADC指定为P47、P46、P45和P44的辅助功能。

将P47C1-P44C1位（P4CON1寄存器的位7-4）设置为“0”，将P47C0-P44C0位（P4CON0寄存器的位7-4）设置为“0”，并将P47DIR-P44DIR位（P4DIR寄存器的位7-4）设置为“1”，以将P47-P44指定为高阻抗输入。
P47C1-P44C1位和P47C0-P44C0位可以设置为全部“1”，而不是全部“0”，以选择高阻抗输入。

P47D-P44D位（P4D寄存器的位7-4）的数据对RC-ADC功能没有影响，因此不必关心该功能的数据。

*：位与RC-ADC通道1无关（使用P47、P46、P45和P44）功能

**：不关心数据

注：
输出引脚P31-P34和P45-P47的状态根据RADMOD寄存器OM0-OM3位指定的RC振荡模式而变化。



## 第25章 逐次逼近型A/D转换器

##### 25.1 楷述

该大规模集成电路具有内置的2通道逐次逼近型a/D转换器（SA-ADC）。

##### 25.1.1 特征

•内置采样/保持12位逐次逼近型A-D转换器，可从2个通道中选择通道

##### 25.1.2 配置

图25-1显示了SA-ADC的配置。

图 PDF 313页

##### 25.1.3 针脚列表

---

AVDD    逐次逼近型A/D正电源引脚转换器

---

VREF     逐次逼近型A/D转换器的基准电源引脚

---

AVSS     逐次逼近型A/D转换器的负电源引脚

---

AIN0     逐次逼近型A/D转换器输入引脚0

---

AIN1     逐次逼近型A/D转换器输入引脚1

---

##### 25.2.1 寄存器列表

---

0F2D0H       SA-ADC返回寄存器0L   SADR0L

---

0F2D1H      SA-ADC返回寄存器0H    SADR0H

---

0F2D2H      SA-ADC返回寄存器1L     SADR1L

----

0F2D3H      SA-ADC返回寄存器1H     SADR1H

---

0F2F0H       SA-ADC控制寄存器0       SADCON0

---

0F2F1H       SA-ADC控制寄存器1       SADCON1

---

0F2F2H      SA-ADC模式寄存器0       SADMOD0

---

##### 25.2.2 SA-ADC结果寄存器0L（SADR0L）

地址：0F2D0H

访问：R

访问大小：8/16位

初始值：00H

---

SADR0L是一种特殊功能寄存器（SFR），用于在通道0上存储SA-ADC转换结果。A/D转换后更新SADR0L。
[位描述]
•SAR03-SAR00（位7-4）
SAR03–SAR00位用于存储通道0上A/D转换结果（12位）的第3位到第0位的值。

##### 25.2.3 SA-ADC结果寄存器0H（SADR0H）

地址：0F2D1H

访问：R

访问大小：8位

初始值：00H

----

SADR0H是一种特殊功能寄存器（SFR），用于在通道0上存储SA-ADC转换结果。A/D转换后更新SADR0H。
[位描述]
•SAR0B-SAR04（位7-0）
SAR0B3–SAR04位用于存储通道0上A/D转换结果（12位）的第11位到第4位的值。

##### 25.2.4 SA-ADC结果寄存器1L（SADR1L）

地址：0F2D2H

访问：R

访问尺寸：8/16位

初始值：00H

SADR1L是一种特殊功能寄存器（SFR），用于在通道1上存储SA-ADC转换结果。A/D转换后更新SADR1L。

[位描述]
•SAR13-SAR10（位7-4）
SAR13–SAR10位用于存储通道1上A/D转换结果（12位）的第3位到第0位的值。

##### 25.2.5 SA-ADC结果寄存器1H（SADR1H）

地址：0F2D3H

访问：R

访问大小：8位

初始值：00H

SADR1H是一种特殊功能寄存器（SFR），用于在通道1上存储SA-ADC转换结果。A/D转换后更新SADR1H。
[位描述]
•SAR1B-SAR14（位7-0）
SAR1B–SAR14位用于存储通道1上A/D转换结果（12位）的位11到位4的值。

##### 25.2.6 SA-ADC控制寄存器0（SADCON0）

地址：0F2F0H

访问：R/W

访问大小：8/16位

初始值：02H

SADCON0是一个特殊的功能寄存器（SFR），用于控制SA-ADC的操作。

SALP(位0)

---

0      仅单A/D转换（初始值）

---

1     连续A/D转换

---

该位用于选择A/D转换是仅对每个通道执行一次还是连续执行。当该位设置为“0”时，仅对每个通道执行一次A/D转换，当该位设置为“1”时，根据SA-ADC模式寄存器（SADMOD0）的设置连续执行A/D转换。
笔记：
当SADCON1寄存器的SARUN位为“0”（A/D转换未激活）时，设置SALP位。
使用SADMOD0寄存器选择一个通道。有关详细信息，请参阅第25.3.2节，A/D转换通道设置。

##### 25.2.7 SA-ADC控制寄存器1（SADCON1）

地址：0F2F1H

访问：R/W

访问大小：8位

初始值：00H

---

SADCON1是一种特殊功能寄存器（SFR），用于控制SA-ADC的操作。

[描述位]

SARUN（位0）

---

0    停止转换

---

1    开始转换

---

SARUN位用于启动或停止SA-ADC转换。将该位设置为“1”将启动A/D转换，将其设置为“0”将停止A/D转换。
当SADCON0的SALP为“0”并且在所选信道中具有最大信道号的信道上终止A/D转换时，SARUN位自动设置为“0”。
笔记：
不要在SA-ADC模式寄存器0的位1（SACH1）和位0（SACH0）分别为“0”和“0”的状态下启动A/D转换。在该状态下启动A/D转换时，A/D转换器激活时不进行A/D转换。因此，SA-ADC结果寄存器不会更新，A/D转换终止中断不会生成，A/D转换不会自动终止，SARUN保持“1”。

##### 25.2.8 SA-ADC模式寄存器0（SADMOD0）

地址：0F2F2H

访问：R/W

访问大小：8位

初始值：00H

---

SADMOD0是一个特殊的函数寄存器（SFR），用于选择A/D转换通道。



[描述位]

SACH0(位0)

SACH1(位1)

SACH1和SACH0位用于选择执行A/D转换的通道。通道0设置为“1”，首先在通道0上执行A/D转换，然后在通道1上执行A/D转换。
如果两个通道都是1
不要将通道1和通道0都设置为0来启动A/D转换。如果开始转换，A/D转换电路被激活（ON），但是A/D转换没有完成。因此，SA-ADC结果寄存器不会更新，A/D转换终止中断不会发生，A/D转换不会自动终止，因此，SA-ADC控制寄存器（SADCON1）的位0（SARUN）保持为“1”。

##### 25.3.1 A/D转换通道的设置

根据SA-ADC模式寄存器0（SADMOD0）的设置，如下所示执行A/D转换，A/D转换结果存储在SA-ADC结果寄存器中。

带斜杠部分的结果寄存器值保持不变。
当SA-ADC模式寄存器0（SADMOD0）的位1（SACH1）和0（SACH0）为0和0时，不要启动A/D转换。如果A/D转换启动，A/D转换电路设置为ON。但是，由于未执行A/D转换，SA-ADC结果寄存器不会更新，A/D转换终止中断不会生成，A/D转换不会自动终止，SA-ADC控制寄存器（SADCON1）的位0（SARUN）保持为“1”。

##### 25.3.2逐次逼近A/D转换器的操作

1在启动SA-ADC之前，启动高速时钟（HSCLK）的振荡，并等待振荡器稳定下来。
2将SA-ADC模式寄存器设置为0（SADMOD0）。
三。当SA-ADC控制寄存器1（SADCON1）的位0（SARUN）设置为“1”时，SA-ADC电路激活
并从SA-ADC模式寄存器中选择的较低通道号执行A/D转换
（SADMOD0）。
4A/D转换结果存储在适用的SA-ADC结果寄存器（SADRnL、SADRnH）中，并且
选择的最大通道数的转换终止，SA-ADC转换终止中断
（ADSINT）生成。
5最后，使用SADCON0寄存器的位0（SALP），可以选择是否终止A/D转换
（SARUN位为“0”）或A/D转换在最后一个通道的A/D转换终止时自动重新启动。
即使在a/D转换期间切换信道，在a/D转换开始时选择的信道也将保持，直到发生a/D转换终止中断。
图25-3显示了选择通道0和通道1时SA-ADC的操作时序。

图 PDF 322页

注：
500kHzRC振荡模式下A/D转换时间为46μs。

## 第26章 LCD驱动

##### 26.1 楷述

该LSI包括显示在显示寄存器中设置的内容的LCD驱动程序。LCD驱动程序通过三个模块处理LCD显示功能。

1. 显示寄存器  2. 显示控制 3. 驱动

显示寄存器用于存储要显示为位模式的内容。
位模式取决于要使用的LCD面板的规格（显示模式和COM引脚和SEG引脚的分配）。

显示控制电路根据LCD的特性产生LCD驱动波形。
可以选择适合于LCD面板的偏置、偏置电压倍增时钟、占空比、帧频和对比度。

##### 26.1.1 特点

LCD驱动程序适用于各种类型的LCD面板。
•ML610Q411/Q415：最大144点（36seg x 4com）•ML610Q412：最大176点（44seg x 4com）
•1/1至1/4负载
•1/3偏置（偏置产生电路内置）
•可选择帧频（4种类型）
•可选择偏置电压倍增时钟（8种类型）
•对比度调整（1/3偏差：32步，1/4偏置：20步）•“所有LCD打开”模式和“所有LCD关闭”模式。
其特点包括：

##### 26.1.2 LCD驱动器的配置
图26-2显示了LCD驱动器和偏置产生电路的配置。

图 PDF 325页

##### 26.1.3 偏置产生电路的配置

偏置产生电路通过将电压调节器产生的电压（VL1）乘以电容器（C12）来产生LCD驱动电压（VL1到VL3）。
当偏置电路控制寄存器（BIASCON）的BSON位设置为“1”时，偏置产生电路开始工作。
通过使用显示对比度寄存器（DSPCNT），可以分32步进行显示对比度调整。

图26-3显示了具有1/3偏置的偏置产生电路的配置。

##### 26.1.4 引脚列表

----

VL1、VL2、VL3     LCD偏置电源引脚（内部生成）

---

C1、C2        用于产生LCD偏压的电容器连接引脚

---

COM0 ～COM3  LCD 公共引脚

----

SEG0 ~ SEG44    LCD 段引脚

---

##### 26.2.1 寄存器列表

---

0F0F0H       偏置电路控制寄存器       BIASCON

---

0F0F1H       显示对比度寄存器           DSPCNT

---

0F0F2H       显示模式寄存器0            DSPMOD0

----

0F0F4H       显示控制寄存器              DSPCON

---

0F100H to 0F123H         显示寄存器00到显示寄存器23（ML610Q411/ML610Q415） DSPR00 to DSPR23

---

0F100H to 0F12BH        显示寄存器00到显示寄存器2B（ML610Q412）    DSPR00 to DSPR2B

---

##### 26.2.2偏置电路控制寄存器0（BIASCON）

地址：0F0F0H

访问：R/W

访问大小：8位

初始值：08H

---

BIASCON是一种特殊的功能寄存器（SFR），用于控制偏置产生电路。
[位描述]

•BSON（位0）
BSON位用于控制偏置产生电路的操作。
当BSON设置为“1”时，偏置产生电路产生LCD驱动电压（VL1到VL3）。

BSON

---

0          偏置电路关闭（初始值）

---

1          偏置电路打开

---

•BSN2-BSN0（位3-1）
BSN2到BSN0位用于选择用于在偏置产生电路中乘以偏置电压的时钟。可选择LSCLK至1/128LSCLK。

##### 26.2.3显示控制寄存器（DSPCNT）

地址：0F0F1H

访问：R/W

访问大小：8位

初始值：00H

---

DSPCNT是一种特殊的功能寄存器（SFR），用于调整显示对比度（32步）。
有关DSPCNT和LCD驱动电压（VL1、VL2、VL3）的设定值，请参阅附录C“电气特性”。
[位描述]
•LCN4-LCN0（位4-0）
LCN4到LCN0位用于调整显示对比度（32步）。

图 PDF 331页

##### 26.2.4显示模式寄存器0（DSPMOD0）

地址：0F0F2H

访问：R/W

访问大小：8/16位

初始值：00H

----

DSPMOD0是一个特殊的功能寄存器（SFR），用于控制LCD驱动器的显示模式。
[位描述]
•DUTY1-DUTY0（位1-0）

DUTY1到DUTY0位用于按4步（1/1到1/4）指定占空比。

.FRM1-FRM0 (位 6-5)

FRM1到FRM0位用于选择LCD驱动器的帧频。

ML610Q411/ML610Q412(LSCLK=32.768kHz)

##### 26.2.5显示控制寄存器（DSPCON）

地址：0F0F4H

访问：R/W

访问大小：8位

初始值：00H

----

DSPCON是一种特殊的功能寄存器（SFR），用于控制LCD驱动器。
[位描述]
•LMD1-LMD0（位1、0）
LMD1和LMD0位用于选择LCD显示模式。
可选择LCD停止模式、所有LCD关闭模式、LCD显示模式和所有LCD打开模式。
在LCD停止模式下，Vss电平输出到所有公共驱动器和段驱动器。可以停止进出显示面板的充放电电流。
在所有lcd关闭模式下，关闭波形被输出到所有的段驱动器，与显示寄存器的内容无关。
在LCD显示模式下，显示寄存器的内容被输出到每个段驱动器。
在所有LCD开启模式下，开启波形被输出到所有段驱动器，而与显示寄存器的内容无关。

LMD1        LMD0             描述

---

0                       0                  LCD停止模式

---

0                       1                   所有的LCD关闭模式

---

1                       0                    LCD显示模式

---

1                        1                    所有的LCD工作模式

---



##### 26.2.6  显示寄存器（DSPR00至DSPR23或DSPR00至DSPR2B）

地址：0F100H to 0F123H (ML610Q411/ML610Q415) : 0F100H to 0F12BH (ML610Q412)

访问：R/W

访问大小：8位

初始值：没有定义

---

DSPRxx（xx=00到2B）是存储显示数据的特殊功能寄存器（sfr）。在设置LCD显示模式之前，先在DSPRxx中设置数据。
表26-4列出显示寄存器。
[位描述]

•c3-c0（位4-0）
c3到c0位用于设置显示数据。

C3 to C0          描述

---

0                         关闭波形

---

1                          打开波形

---

图 PDF 335页



##### 26.3.1 液晶驱动器和偏置产生电路的操作

图26-4显示了LCD驱动器和偏置产生电路的操作。图 PDF 336页

1. 系统复位导致偏置产生电路和LCD驱动器停止操作，并且Vss电平输出到每个公共和段管脚。
2. 通过使用偏置电路控制寄存器（BIASCON），选择1/3偏置或1/4偏置和偏置电压倍增锁定，并将偏置产生电路设置为on（BSON=“1”）。
3. 使用显示模式寄存器0（DSPMOD0）设置帧频和占空比。
4. 在显示寄存器中设置显示数据（ML610Q411/Q415:DSPR00到DSPR23，ML610Q412:DSPR00到DSPR23）
   在经过偏置激活时间（TBIAS）或更长时间后，使用LMD1将模式设置为显示模式
   和显示控制寄存器（DSPCON）的LMD0位。（显示波形输出到每个管段引脚。）有关偏置激活时间（TBIAS），请参阅附录C中的“电气特性”部分。

##### 26.3.2 显示寄存器段图

图26-5显示了显示寄存器段图。

图 PDF 337页

##### 26.3.3 公共输出波形

图26-6显示了1/4占空比和1/3偏置的常见输出波形。

图PDF 338页

##### 26.3.4 段输出波形
图26-7显示了1/4占空比和1/3偏置的段输出波形。

图 PDF 339页

## 第27章 电池电量探测器

##### 27.1 楷述

该LSI包括一个电池电量检测器（BLD）。
通过设置电池电平检测器控制寄存器0（BLDCON0），可以选择16个阈值电压电平。

##### 27.1.1 特点

•阈值电压：可从16个电平中选择一个

•精度：±2%（典型值）

##### 27.1.2 配置

BLD由比较器和阈值电压选择电路组成。

图27-1显示了电池电量检测器的配置。图 PDF 341页



##### 27.2.1 寄存器列表

---

0F0D0H     电池电量检测器控制寄存器0    BLDCON0     8/16    00H

---

0F0D1H    电池电量检测器控制寄存器1      BLDCON1     8         00H

---

##### 27.2.2 电池电量检测器控制寄存器0（BLDCON0）

---

地址：0F0D0H

访问：R/W

访问大小：8位

初始值：00H

---

BLDCON0是一个特殊的功能寄存器（SFR），用于控制电池电量检测器

[位描述]
•LD3、LD2、LD1、LD0（位3-0）
LD3、LD2、LD1和LD0位用于选择电池电量检测器的阈值电压（VCMP）。

可选择16级阈值电压。

##### 27.2.3 电池电量检测器控制寄存器1（BLDCON1）

---

地址：0F0D1H

访问：R/W

访问大小：8位

初始值：00H

---

BLDCON1是一个特殊功能寄存器（SFR），用于控制电池电量检测器。

[位描述]
•ENBL（位0）
ENBL位用于控制电池电量检测器的激活（ON）或停用（OFF）。
通过将ENBL位分别设置为“1”和“0”，激活（打开）和停用（关闭）电池电量检测器。

---

0      停用电池电量检测器（关闭）（初始值）

---

1      启动电池电量检测器（ON）

---

•BLDF（位1）
BLDF位是电池电量检测器的判断结果标志。
当电源电压（VDD）低于或高于由BLDCON0寄存器的LD3到LD0位分别选择的阈值电压时，BLDF位设置为“1”或“0”。

---

0      高于阈值电压（初始值）

---

1       低于阈值电压

---

##### 27.3.1 阈值电压

通过设置BLDCON0的位来选择阈值电压（VCMP）。表27-1显示了阈值电压和精度。

图 PDF 345页

##### 27.3.2 电池电量探测器的操作

通过设置电池电量检测器控制寄存器（BLDCON1）的ENBL位来控制电池电量检测器的激活（ON）和停用（OFF），并且将电源电压（VDD）与阈值电压的比较结果输出到BLDCON1的BLDF位。
当ENBL（电池电量检测器的启用控制位）设置为“1”时，检测器被激活（开启）。当ENBL设置为“0”时，探测器被停用（关闭），并且没有电源电流。
BLDF表示比较结果。当BLDF位设置为“1”时，表示电源电压低于阈值电压。当BLDF位设置为“0”时，表示电源电压（VDD）高于阈值电压。电池电量探测器需要一个稳定时间。在ENBL位设置为“1”后读取BLDF位1ms或更长时间。
图27-2显示了操作时序图的示例

图27-2中的操作描述如下。
1 通过将ENBL位设置为“1”，激活（开启）电池电量检测器。

2 等待电池电量检测器的稳定时间（最小1毫秒）。
3 读取BLDF位。
4 将ENBL位设置为“0”。
注：
当ENBL位为“0”时，选择阈值电压（VCMP）。



## 第二十八章 电源电路

##### 28.1 楷述

该LSI包括用于内部逻辑（VRL）的稳压电源和用于低速振荡（VRX）的稳压电源。
VRL输出内部逻辑、程序存储器、RAM等的工作电压VDDL。
VRX输出低速振荡的工作电压VDDX。
有关模拟电路电源（AVDD、AVSS）的电路配置，请参阅第25章“逐次逼近型A/D转换器”。
有关LCD（VL1至VL4）电源的电路配置，请参阅第26章“LCD驱动器”。

##### 28.1.1 特征

•VRL输出内部逻辑、程序存储器、RAM等的工作电压VDDL。
•VRX输出低速振荡的工作电压VDDX（仅限ML610Q411/ML610Q412）。

##### 28.1.2 配置

图PDF 348 页

##### 28.1.3 引脚列表

---

VDDL    ｜    内部逻辑电路的正极电源引脚

---

VDDX    ｜  用于低速振荡的正极电源引脚（仅限ML610Q411/Q412）

---

##### 28.2 操作说明

**ML610Q411/ML610Q412**

系统复位时，VDDL和VDDX约为1.2 V。
释放系统复位后，对4096个低速振荡时钟（XTCLK）脉冲进行计数后，VDDX变为约0.6 V（典型值）。由于停止模式的释放（产生外部中断），在4096个低速振荡时钟（XTCLK）脉冲计数后，VDDX变为约1.2 V（典型值），然后变为约0.6 V（典型值）。

**ML610Q415**

系统复位时，VDDL和VDDX约为1.2 V。
低速振荡电路不工作。将VDDX引脚和XT0引脚连接到Vss。

图 PDF 350 页

## 第29章 片上调试功能

##### 29.1 楷述

此LSI具有片上调试功能，允许闪存重写。
片上调试仿真器（uEASE）连接到此LSI以执行片上调试功能。

##### 29.2 与片上调试仿真器的连接方法

图29-1显示了与片上调试仿真器（uEASE）的连接。有关片上调试仿真器，请参阅“uEASE用户手册”。

图 PDF 352页

注：
− 请勿将用于调试的LSI应用于批量生产。
− 在安装板后使用片上调试功能或闪存重写功能时，应设计板，以便连接到片上调试仿真器所需的5个引脚（VPP、VDD、VSS、RESET_N和TEST_N）。
在调试和写入闪存时，必须向VDD提供“-“3.0V至3.6V”。
− 当系统复位电路包含在用户应用电路中时，启用用户应用电路中的连接切换，如上所示。当系统复位电路不包括在用户应用电路中时，复位管脚可以直接连接到该LSI的复位管脚。
有关详细信息，请参阅“uEASE用户手册”和“uEASE目标连接手册”。

##### 29.3 闪存重写功能

通过使用片上调试仿真器（uEASE）的命令，可以对安装在板上的存储器执行闪存擦除/写入操作。有关片上调试仿真器的更多详细信息，请参阅“uEASE用户手册”。表29-2显示了闪存重写功能。

---

1- 字写入           写入1个单词 （2个字节）

---

随机读取            输入地址读取

---

表29-3显示了闪存重写的条件和规格。

图 PDF 353页

注：
在执行闪存重写（擦除、写入）时，需要向电源电压VDD施加3.0V到3.6v范围内的电压。

## 附录

此部分没有去翻译