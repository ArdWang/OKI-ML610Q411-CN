# OKI-ML610Q411-CN
ML610Q411/ML610Q412/ML610Q415-中文手册

## 前言

这个手册是描述操作8位微型控制芯片 ML610Q411/ML610Q412/ML610Q415.

跟随提供的手册,读他们的要点:

1. nX-U8/100核心指令手册 描述nX-U8/100核心基本的结构和相互指令
2. MACU8 汇编程序包用户手册
描述操作可重定位汇编程序、链接器、库管理器和对象转换器的方法，以及汇编语言的规范。
3. CCU8用户手册
操作编译器方法的说明
4. CCU8编程指南
编程方法说明。
5. CCU8语言参考
语言规范说明。
6. DTU8调试器用户手册
操作调试器DTU8的方法说明。
7. IDEU8用户手册
集成开发环境IDEU8的说明。
8. uEASE用户手册
片上调试工具uEASE的说明。
9. uEASE ML610Q400连接手册
uEASE与ML610Q400系列连接说明。
10. 关于Flash Writer主机程序的用户手册说明。


## 符号


数值         

## 第一章

该LSI是一种高性能的8位CMOS微控制器，内置了丰富的外围电路，如同步串口、UART、I2C总线接口（master）、蜂鸣器驱动器、电池电量检测电路、RC振荡型a/D转换器、12位逐次逼近型a/D转换器和LCD驱动器，在8位CPU nX-U8/100周围合并。
CPU nX-U8/100采用三级流水线结构并行处理，能够在单指令单时钟模式下高效执行指令。作为程序存储器安装的Flash-ROM实现相当于掩模ROM的低电压低功耗操作（读取操作），并且最适合电池驱动的应用。安装的片上调试功能可以进行程序调试和编程。

•CPU
−8位RISC CPU（CPU名称：nX-U8/100）
−指令系统：16位指令
−指令开始：传输、算术运算、比较、逻辑运算、乘法/除法、位
操作，位逻辑操作，跳转，条件跳转，调用返回堆栈操作，
算术移位等−片上调试功能
−最小指令执行时间30.5μs（@32.768 kHz系统时钟）2μs（@500kHz系统时钟）

•内部存储器
−内部16KB闪存ROM（8K×16位）（包括不可用的1KB测试区）−内部1KB数据RAM（1024×8位）

•中断控制器
−2个不可屏蔽中断源
内部源：1（看门狗定时器）
外部来源：1（NMI）
−19个可屏蔽中断源
内部源：15（SSIO、SA-A/D转换器、I2C、定时器0、定时器1、定时器2、定时器3、1kHz定时器、UART、RC-A/D转换器、PWM、TBC128Hz、TBC32Hz、TBC16Hz、TBC2Hz）
外部来源：4（P00、P01、P02、P03）

•时基计数器
−低速时基计数器×1通道
频率补偿（补偿范围：约−488ppm至+488ppm。补偿精度：约。
0.48ppm，适用于ML610Q411/Q412）-高速时基计数器×1通道

•看门狗定时器
−不可屏蔽中断和复位
−自由运行
−溢流周期：4种可选类型
ML610Q411/Q412：125ms、500ms、2s和8s ML610Q415：约131ms、524ms、2.1s、8.4s

•定时器
−8位×4通道（定时器0-3：使用定时器0-1或定时器2-3提供16位×2配置）
−时钟频率测量模式（在使用定时器2-3的16位配置的一个信道中，ML610Q415没有
没有此模式）

•1 kHz定时器
−中断功能
ML610Q411/Q412:10 Hz/1 Hz中断ML610Q415:9.5Hz/0.95Hz中断

•捕获
−时基捕获×2个通道
ML610Q411/Q412:4096 Hz至32 Hz ML610Q415:3906Hz~30.5H

•脉宽调制
−分辨率16位×1通道

•同步串行端口
−主/从可选
−LSB优先/MSB优先可选
−8位长度/16位长度可选

•通用异步收发器
-半双工通信
−TXD/RXD×1通道
−位长度、奇偶校验/无奇偶校验、奇偶校验/偶校验、1个停止位/2个停止位−正逻辑/负逻辑可选
−内置波特率发生器

•I2C总线接口
−仅主功能
−标准模式(500kHz时为50kbps)

•蜂鸣器驱动器
−4种输出模式，8个频率，16个占空比

•RC振荡型A/D转换器
−24位计数器
−时分×2通道
−转换时间：46us/1ch@500kHz

•逐次逼近型A/D转换器−12位A/D转换器
−输入×2通道

•通用端口
−不可屏蔽中断输入端口×1通道
−仅输入端口×6通道（包括辅助功能）
−仅输出端口×3个通道（包括辅助功能）−输入/输出端口
ML610Q411:22路（含二次功能）ML610Q412:14路（含二次功能）ML610Q415:22路（含二次功能）

•LCD驱动器
−段数
ML610Q411:最大144点（36段×4 com）ML610Q412:最大176点（44段×4 com）ML610Q415:最大144点（36段×4 com）
−1/1至1/4负载
−1/3偏置（内置偏置产生电路）−帧频可选择
ML610Q411/Q412：约64 Hz、73 Hz、85 Hz和102 Hz
ML610Q415：约61Hz、70Hz、81Hz、97Hz
−偏置电压倍增时钟可选（8种类型）
对比度调整（32步）
−LCD驱动停止模式、LCD显示模式、所有LCD打开模式和所有LCD关闭模式可选

•重置
−通过复位引脚复位
−上电时产生上电重置
−检测到低速时钟振荡停止时复位（ML610Q411PC和ML610Q415没有
此函数）
−通过看门狗定时器（WDT）溢出复位

•电源电压检测功能
−判断电压：16级之一−判断精度：±2%（典型值）

•时钟
−低速时钟
ML610Q411/ML610Q412：晶体振荡（32.768 kHz）
（此LSI不能保证在没有低速晶体振荡时钟的情况下工作）ML610Q415:1/16内置RC振荡500 kHz（31.25kHz）*
（此LSI没有低速晶体振荡时钟）
*此时钟不用于CPU操作时钟。
−高速时钟：
内置RC振荡（500 kHz）外部时钟（500 kHz或以下）
−高速时钟齿轮：1/2（250kHz）、1/4（125kHz）、1/8（62.5kHz：默认）
−通过软件选择高速时钟模式：
内置RC振荡，外部时钟

•电源管理
−暂停模式：CPU的指令执行暂停（外围电路处于工作状态）。
−停止模式：停止低速振荡和高速振荡（CPU和外围电路的操作）
已停止。）
−高速时钟齿轮：高速系统时钟的频率可以通过软件（1/1、1/2、1/4或
振荡时钟的1/8）
−块控制功能：关闭未使用外设电路的电源（复位寄存器和停止时钟电源）

•装运
−芯片（模具）
ML610Q411 xxxWA（空白产品：ML610Q411-NNNWA）ML610Q411P xxxWA（空白）产品：ML610Q411P-NNNWA)ML610Q411PA xxxWA（空白产品：ML610Q411PA-NNNWA)ML610Q411PC xxxWA（空白产品：ML610Q411PC-NNNWA)ML610Q412 xxxWA（空白产品：ML610Q412-NNNWA）ML610Q412P xxxWA（空白）产品：ML610Q412P-NNNWA)ML610Q415 xxxWA（空白产品：ML610Q415-NNNWA）
ML610Q411/ML610Q412/ML610Q415用户手册
−120针塑料LQFP
ML610Q411-xxxTBZ03A（空白产品：ML610Q411-NNNTBZ03A）
ML610Q411P-xxxTBZ03A（空白产品：ML610Q411P-NNNTBZ03A）
ML610Q411PA-xxxTBZ03A（空白产品：ML610Q411PA-NNNTBZ03A）
ML610Q411C-xxxTBZ03A（空白产品：ML610Q411C-NNNTBZ03A）
ML610Q412-xxxTBZ03A（空白产品：ML610Q412-NNNTBZ03A）
ML610Q412P-xxxTBZ03A（空白产品：ML610Q412P-NNNTBZ03A)
ML610Q415-xxxTBZ03A（空白产品：ML610Q415-NNNTBZ03A）
xxx:ROM代码
P：宽温度范围版本
A:低速时钟振荡停止检测重置可选择为始终禁用（请参阅中的第3章和第4章）
更详细的用户手册）。
C:EMS公差改进版/硬件非活动低速时钟振荡停止检测重置（参见
用户手册的第3章和第4章了解更多详细信息）WA:芯片
TB：TQFP
•保证工作范围
−工作温度：−20°C至+70°C（P型：−40°C至+85°C）−工作电压：VDD=1.1V至3.6V，AVDD=2.2V至3.6V

#### 1.2 1.2.1
ML610Q411/ML610Q415功能框图配置
“*”表示每个端口的第二或第三功能*'表示ML610Q415没有晶体振荡。

![image-20210326112459538](/Users/rnd/Library/Application Support/typora-user-images/image-20210326112459538.png)

#### 1.2.2
ML610Q412方框图
“*”表示每个端口的第二或第三功能。

![AC1BDC32-7A25-4F0B-ADFF-E0BF75735459](/Users/rnd/Library/Containers/com.tencent.qq/Data/Library/Application Support/QQ/Users/278161009/QQ/Temp.db/AC1BDC32-7A25-4F0B-ADFF-E0BF75735459.png)

#### 1.3
1.3.1 1.3.1.1
别针
引脚布局
ML610Q411/ML610Q415引脚布局
120针TQFP封装

![81502D10-9F2E-4820-9E11-3E892D478DF6](/Users/rnd/Library/Containers/com.tencent.qq/Data/Library/Application Support/QQ/Users/278161009/QQ/Temp.db/81502D10-9F2E-4820-9E11-3E892D478DF6.png)

（NC）：无连接
注：
P30到P35的分配不正常。

图1-3 ML610Q411/ML610Q415封装引脚布局



#### 1.3.1.2 ML610Q412引脚布局
90针
120针TQFP封装

图在PDF的第23页 图1-4 ML610412

#### 1.3.1.3 ML610Q411/ML610Q415芯片引脚布局

图在PDF 第24页里面

*仿真垫
注：这些虚拟垫是可见的，并没有任何功能，他们是放置在一个机械评估天青石半导体。请不要将引线连接到虚拟焊盘上。
注：

1–9
37（NC）

P30到P35的分配不正常。
芯片尺寸：
记数：
最小焊盘间距：
衬垫孔径：
切屑厚度：
芯片背面电压：
2.836mm x 2.636mm 95针
80微米
70μm×70μm
350μm VSS电平

图1-5
ML610Q411/ML610Q415芯片尺寸

#### 1.3.1.4 ML610Q412芯片引脚布局

图在 PDF 的第25页当中

*仿真垫
注：这些虚拟垫是可见的，并没有任何功能，他们是放置在一个机械评估天青石半导体。请不要将引线连接到虚拟焊盘上。

注：P30到P35的分配不正常。

芯片尺寸：
记数：
最小焊盘间距：
衬垫孔径：
切屑厚度：
芯片背面电压：
2.836mm x 2.636mm 95针
80微米
70μm×70μm
350μm VSS电平



#### 1.3.1.5 ML610Q411/ML610Q415芯片的焊盘坐标

表1-1
ML610Q411/ML610Q415的焊盘坐标

PDF图 第26页

#### 1.3.1.6 ML610Q412芯片的焊盘坐标

ML610Q412的焊盘坐标

PDF图 第27页

#### 1.3.2 引脚表

PDF图 第28-29页

-----------

端口编号    端口名称   I/O口   方法

-------------------------------------------------

2，24，45，47    VSS         /             负极电源引脚 

-------

22, 46       VDD          /             正极电源引脚

----

23           VDDL        /              电源引脚内部逻辑（内部生成）

------

25       VDDX      /         低速振荡电源引脚（内部产生）

------------

1           VPP   /         闪存ROM电源引脚

------

28         AVSS    连续逼近型ADC负电源引脚

-----

30  AVDD  连续逼近型ADC正电源引脚

---

65 VL1 LCD偏置电源引脚（内部生成）

---

64 VL2 LCD偏置电源引脚（内部生成）

----

63 VL3 LCD偏置电源引脚（内部生成）

---

62 C1 用于产生LCD偏压的电容器连接引脚

---

61 C2 用于产生LCD偏压的电容器连接引脚

---

21 TEST I/O 测试用输入/输出引脚

---

8 RESET_N 复位输入引脚

---

27    XT0（*3） I  低速时钟振荡引脚

---

26   XT1(*3)   O  低速时钟振荡引脚

---

29    VREF   /  逐次逼近型模数转换器的参考电源引脚

---

36   AIN0    I  逐次逼近型ADC输入

---

37  AIN1   I   逐次逼近型ADC输入

---

40  NMI    I  不可屏蔽中断引脚

----

41 P00/EX10/CAP0    I  输入端口，外部中断0，捕获0输入

----

42  P01/EX12/RXD0  I 输入端口，外部中断1，扑获1输入

---

43  P02/EX12/RXD0  I  输入端口，外部中断2 UART0接收

----

44    P03/EX13  I     输入端口，外部中断3

--------

38    P10   I      输入端口

----

39    P11  I     输入端口

-------

3       P20/LED0   O     输出端口

----

4       P21/LED1    O     输出端口

----

5       P22/LED2    O   输出端口

----

15      P30      I/O     输入/输出端口

------

16     P31       I/O     输入/输出端口

-----

17     P34      I/O     输入/输出端口

----

18     P32      I/O      输入/输出端口

---

19     P33      I/O     输入/输出端口

---

20     P35     I/O       输入/输出端口

----

6       P40     I/O      输入/输出端口

---

7      P41       I/O    输入/输出端口

---

9      P42      I/O     输入/输出端口

---

10     P43     I/O    输入/输出端口

----

11      P44/T02P0CK     I/O   输入/输出端口，定时器0/定时器2/PWM0外部输入1时钟输入

---

12      P45/T13P1CK     I/O     输入/输出端口，定时器1/定时器3外部时钟输入

---

13        P46       I/O       输入/输出端口

---

14         P47     I/O       输入/输出端口

---

106       PA0(*1) / SEG43(*2)        输入输出 / LCD段引脚

-----

107        PA1(*1) / SEG42(*2)     输入输出 /  LCD段引脚

---

108         PA2（*1）/ SEG41(*2)      输入输出端口 / LCD段引脚

---

109        PA3（1）/ SEG40(2)    输入输出端口 / LCD段引脚

---

110       PA4(1)   /  SEG39(2)    输入输出端口 / LCD段引脚

----

111        PA5(1)  /    SEG38(2)      输入输出端口 / LCD段引脚

---

112      PA6(1) / SEG37(2)      输入输出端口 / LCD段引脚

---

113      PA7(1) / SEG36(2)     输入输出端口 / LCD段引脚

---

69       COM0     LCD公共引脚

---

68       COM1     LCD公共引脚

---

67       COM2     LCD公共引脚

---

66       COM3     LCD公共引脚

---

70       SEG0       LCD段引脚

---

71       SEG1       LCD段引脚

---

72       SEG2       LCD段引脚

77~105  SEG3~SEG35 LCD段引脚

---

（*1）ML610Q411和ML610Q415上的针脚。
（*2）ML610Q412上的引脚。
（3）ML610Q415没有低速晶体振荡功能，但XT0引脚必须绑定到VSS。

---

RESET_N       重置输入引脚。当该引脚被设置为“L”级时，系统复位模式被设置，内部部分被初始化。当该引脚随后被设置为“H”级时，程序开始执行。上拉电阻器内部连接。

---

XT0 / XT1  低速时钟的晶体连接引脚。
32.768 kHz晶体振荡器（见测量电路1）连接到该引脚。电容器CDL和CGL根据需要通过该引脚和VSS连接。ML610Q415没有晶体振荡功能，但在ML610Q415上连接XT0到VSS，不连接XT1。

---

OSC0     高速外部时钟输入引脚。该引脚用作P10的辅助功能。

---

LSCLK    低速时钟输出引脚。该引脚用作P20引脚的辅助功能。

---

OUTCLK    高速时钟输出引脚。该引脚用作P21引脚的辅助功能

---

通用输入端口

---

P00-P03     通用输入端口。由于这些引脚具有辅助功能，因此当使用辅助功能时，插脚不能用作端口。

---

P10-P11      通用输入端口。由于这些管脚具有辅助功能，因此在使用辅助功能时，管脚不能用作端口。

---

通用输出端口

---

P20-P22       通用输出端口。由于这些管脚具有辅助功能，因此管脚不能用作辅助功能使用辅助功能时的端口。

---

通用输入/输出端口

---

P30-P35       通用输入/输出端口。由于这些管脚具有辅助功能，因此在使用辅助功能时，管脚不能用作端口。

---

P40-P47      通用输入/输出端口。由于这些管脚具有辅助功能，因此在使用辅助功能时，管脚不能用作端口。

---

PA0-PA7    通用输入/输出端口。这些引脚用于ML610Q411和ML610Q415，但ML610Q412中未提供。

---

UART

---

TXD0      UART数据输出引脚。该引脚用作P43引脚的辅助功能。

---

RXD0    UART数据输入引脚。该引脚用作P42的辅助功能或P02引脚的主要功能。

---

I2C 总线接口

---

SDA     I2C数据输入/输出引脚。该引脚用作P40引脚的辅助功能。此引脚具有NMOS开漏输出。当使用此引脚作为I2C的功能时，从外部连接上拉电阻器。

---

SCL    I2C数据输出引脚 。该引脚用作P41引脚的辅助功能。此引脚具有NMOS开漏输出。当使用此引脚作为I2C的功能时，从外部连接上拉电阻器。

---

同步串行（SSIO）

---

SCK0   同步串行时钟输入/输出引脚。该引脚用作P41或P45引脚的第三功能。

---

SIN0    同步串行数据输入引脚。该引脚用作P40或P44引脚的第三功能

---

SOUT0     同步串行数据输出引脚。该引脚用作P42或P46引脚的第三功能。

----

PWM

---

PWM0    PWM0输出引脚。该引脚用作P43或P34引脚的第三功能。

---

T02P0CK    PWM0外部时钟输入引脚。该引脚用作P44引脚的主要功能。

---

外部中断

---

NMI    外部不可屏蔽中断输入引脚。在两条边上生成中断

---

EXI0-3    外部可屏蔽中断输入引脚。软件可以为每个位执行中断启用和边缘选择。这些引脚用作P00-P03引脚的主要功能。

---

CAP0    /  CAP1  捕捉触发器输入引脚。时基计数器的值与软件选择的中断边同步地捕获在寄存器中。这些针脚用作P00针脚（CAP0）和P01针脚（CAP1）的主要功能。

---

T02P0CK   用于定时器0和定时器2的外部时钟输入引脚。这些计时器的时钟由软件选择。该引脚用作P44引脚的主要功能。

---

T13P1CK    用于定时器1和定时器3的外部时钟输入引脚。这些计时器的时钟由软件选择。该引脚用作P45引脚的主要功能。

---

蜂鸣器

---

BZ0   蜂鸣器信号输出引脚。此引脚用作P22引脚的辅助功能。

---

LED 驱动器

---

LED0-2   Nch开漏输出引脚驱动LED。

---

RC振荡型A/D转换器

---

IN0   通道0振荡输入引脚。该引脚用作P30引脚的辅助功能。

---

CS0   通道0参考电容器连接引脚。该引脚用作P31引脚的辅助功能。

---

RCT0   用于测量的通道0的电阻/电容传感器连接引脚。该引脚用作P33引脚的辅助功能。

---

RS0   该引脚用作P32引脚的辅助功能，P32引脚是通道0的参考电阻器连接引脚。

---

RT0   用于测量的通道0的电阻传感器连接引脚。该引脚用作P34引脚的辅助功能。

---

RCM   RC振荡监视器引脚。该引脚用作P35引脚的辅助功能。

---

IN1   通道1的振荡输入引脚。该引脚用作P44引脚的辅助功能。

---

CS1   通道1的参考电容器连接引脚。该引脚用作P45引脚的辅助功能。

---

RS1   通道1的参考电阻器连接引脚。该引脚用作P46引脚的辅助功能。

---

RT1   用于通道1测量的电阻传感器连接引脚。该引脚用作P47引脚的辅助功能。

---

逐次逼近型A/D转换器

---

AVSS   逐次逼近型A/D转换器的负电源引脚

---

AVDD   逐次逼近型A/D转换器的正电源引脚

---

VREF    逐次逼近型A/D转换器的基准电源引脚

---

AIN0   通道0模拟输入逐次逼近型A/D转换器

---

A1N1  通道1模拟输入逐次逼近型A/D转换器

---

LCD驱动信号

---

COM0-3     公共输出引脚。

---

SEG0-35    段输出引脚

---

SEG36-43   段输出引脚。这些引脚在610Q412之前，但ML610Q411和ML610Q415中未提供。

---

LCD驱动电源

---

VL1 / VL2 / VL3    LCD偏置电源引脚（内部产生）。电容器Ca、Cb、VL2-和Cc（见测量电路1）连接在VSS和VL1、VL2之间，
和VL3。

---

C1 / C2  LCD偏置电源引脚（内部产生）。电容器C12连接在C1和C2之间。

---

TEST   用于测试的输入/输出引脚。一个下拉电阻器内部连接。

---

电源提供

---

VSS   负极电源引脚。

---

VDD    I/O、内部调节器、电池电量低探测器的正极电源引脚，上电复位。

----

VDDL   内部逻辑的正电源引脚（内部生成）。电容器CL0和CL1（见测量电路1）连接在该引脚和VSS之间。

---

VDDX  正电源引脚（内部产生）用于低速振荡。使用ML610Q411和ML610Q412时，将电容器Cx（参见测量电路1）连接在此引脚和VSS之间。使用ML610Q415时，将此引脚直接连接到Vss。

---

VPP    用于编程闪存ROM的电源引脚。下拉电阻器内部连接。

---

#### 1.3.4 未使用引脚的端接

表1-3显示了端接未使用引脚的方法。PPT 35页

推荐的引脚端接

注：
建议将未使用的输入端口和输入/输出端口设置为具有下拉电阻器/上拉电阻器的输入或输出模式，因为如果在高阻抗输入设置中保持引脚打开，则电源电流可能变得过大。



## 第二章  CPU和内存空间

#### 2.1 前言

该大规模集成电路包括拉皮斯半导体公司原有的8位CPU nX-U8/100，存储器型号为“小型”。有关CPU nX-U8/100的详细信息，请参阅“nX-U8/100核心说明手册”。

#### 2.2 程序内存空间

程序内存空间用于存储程序代码、表数据（ROM窗口）或向量表。
程序代码的长度为16位，由16位程序计数器（PC）指定。
ROM窗口区域数据具有8位的长度，并且可以用作表数据。
矢量表有16位长的数据，可用作复位矢量、硬件中断矢量和软件中断矢量。
程序内存空间由1段组成，容量为16kbyte（8kword）。图2-1显示了程序内存空间的配置。

具体看 图 2-1配置程序的存储空间 PDF 37页

笔记：
−由于测试程序数据存储在段0的1024字节（512字）测试数据区（0:03C00H到0:03FFFH）中，
此区域不能用作程序代码区域。
−测试区域中的地址“0:03C00H至0:03DFFH”可写且可擦除。用“0FFH”填充该区域。如果
区域中的数据不确定或其他数据（即非0FFH），无法保证使用代码进行操作。
−在程序内存空间的未使用区域设置“0FFH”数据（BRK指令）。

#### 2.3 数据存储空间

该LSI的数据存储空间包括ROM窗口区、段0的1KB RAM区和SFR区以及段1和段8的ROM参考区。
数据存储器存储8位数据，由20位指定，其中高4位作为DSR，低16位作为每条指令指定的寻址。 

图2-2 展示配置数据存储空间 PDF 38页

笔记：
−系统复位时，1 KB RAM区域的内容未定义。通过软件初始化此区域。
−从段8的ROM参考区域读取程序存储器空间的段0的内容。



#### 2.4 指令长度

一条指令的长度是16位。

#### 2.5 数据类型

支持的数据类型包括字节（8位）和字（16位）。

#### 2.6 寄存器说明

##### 2.6.1 寄存器列表

0F000H     数据段寄存器     DSR    R/W    8   00H

##### 2.6.2 数据段寄存器（DSR）

地址: 0F000H 

访问: R/W 

访问大小: 8 bits 

初始值: 00H

DSR

DSR  7       6    5   4    3     2        1          0

---



R/W           DSR3 DSR2 DSR1 DSR0

---



R/W R/W R/W R/W R/W R/W R/W R/W R/W 

---



Initial value 0 0 0 0 0 0 0 0

---



DSR是一种保留数据段的特殊功能寄存器（SFR）。有关DSR的详细信息，请参阅“nX-U8/100 Core说明手册”。

[位描述]

图片 请看 PDF 40页



## 第三章 复位功能

#### 3.1 复位功能

##### 3.1 前言

此LSI具有如下所示的五种复位功能。如果满足五个重置条件中的任何一个，则此LSI进入系统重置模式。
•通过复位引脚复位
•通电检测复位
•通过低速振荡停止检测复位（ML610Q411PC和ML610Q415上不可用）
•通过第二个看门狗定时器（WDT）溢出复位
•通过执行BRK指令进行软件复位

##### 3.1.1 特性

•储能器引脚有一个内部上拉电阻器
•低速振荡停止检测时间为典型值。3毫秒（在ML610Q411PC和ML610Q415上不可用）•可以选择250毫秒、1秒、4秒或16秒作为看门狗定时器（WDT）溢出周期
•内置复位状态寄存器（RSTAT），指示复位产生原因
•只有CPU被BRK指令复位（RAM区域和SFR区域均未复位）。

##### 3.1.2 配置

图3-1显示了复位产生电路的配置。 PDF 42页

RSTAT：复位状态登记
（*）ML610Q411PA：低速振荡停止检测复位可由BLKCON4电阻器的DXTSP位控制。
ML610Q411PC:始终禁用低速振荡停止检测重置。

图3-1复位产生电路的配置

#### 3.2 寄存器说明

##### 3.2.1 寄存器列表

图 PDF 43页

(*)ML610Q411和ML610Q412上未定义，ML610Q411PC和ML610Q415上为“0”。
RSTAT是一个特殊功能寄存器（SFR），它指示产生复位的原因。
在发生复位时，RSTAT的内容没有初始化，而指示复位原因的位被设置为“1”。使用此功能检查复位原因时，应提前对RSTAT进行写操作，并将RSTAT的内容初始化为“00H”。

[位描述]•POR（位0）
POR位是一个标志，指示已生成上电复位。通电时该位设置为“1”。

0     未生成上电复位

1     已生成通电复位

•XSTR（位1）
XSTR位是一个标志，指示产生低速振荡停止检测复位。当低速振荡停止超过低速振荡停止检测时间（TSTOP）规定的时间时，该位设置为“1”。写入位无效，在ML610Q411PC和ML610Q415上读取时始终返回“0”。

0    未发生低速振荡停止检测复位

1     发生低速振荡停止检测复位

•WDTR（位2）
WSDTR是一个标志，指示生成看门狗定时器重置。当产生看门狗定时器溢出复位时，该位设置为“1”。

注：
没有提供指示复位引脚复位发生的标志。

#### 3.3 操作说明
##### 3.3.1系统复位模式的操作
系统重置在所有处理中具有最高优先级，并且在此之前执行的任何其他处理都将被取消。
系统复位模式由以下任何原因设置。
•重置
•通过电源检测复位
•通过低速振荡停止检测复位（ML610Q411PC和ML610Q415上不可用）•通过看门狗定时器（WDT）溢出复位
•通过BRK指令进行软件复位（仅CPU复位）
在系统复位模式下，执行以下处理。
（1） 电源电路已初始化，但未通过BRK指令执行的重置进行初始化。有关电源电路的详细信息，请参阅第28章“电源电路”。
（2） 初始化初始值未定义的所有特殊函数寄存器（SFR）。但是，由于BRK指令的执行，初始化不是通过软件重置来执行的。SFR的初始值见附录A“寄存器”。
（3） CPUIS已初始化。
•CPU中的所有寄存器都已初始化。
•程序存储器中地址0000H和0001H的内容被设置为堆栈指针（SP）。
•程序存储器中地址0002H和0003H的内容设置到程序计数器（PC）。
然而，当由BRK指令复位时的程序状态字（PSW）的中断电平（ELEEVL）为1或更低时，程序存储器的地址0004H和0005H的内容被设置在程序计数器中
（个人电脑）。有关BRK说明，请参阅“nX-U8/100 Core说明手册”。
注：
在系统复位模式下，数据存储器的内容和任何初始值未定义的SFR的内容不被初始化并且未定义。通过软件初始化它们。
在BRK指令的系统复位模式下，也不会初始化具有固定初始值的特殊功能寄存器（SFR）。因此，通过软件初始化这样的SFR。

## 第四章 MCU控制功能

##### 4.1 楷述

该LSI的工作状态分为以下4种模式，包括系统复位模式：
系统复位模式程序运行模式停止模式停止模式
有关系统复位模式，请参阅第3章“复位功能”。
这种大规模集成电路具有块控制功能，可以关闭未使用的外围设备（复位寄存器和停止时钟电源）的电路，从而进一步降低电流消耗。

##### 4.1.1 特点
•停止模式，CPU停止运行，只有外围电路在运行
•停止模式，其中低速振荡和高速振荡都停止
•停止代码接收器功能，控制到停止模式的转换
•块控制功能，用于关闭未使用的外围设备的电路（复位寄存器和停止时钟
供应）。

##### 4.1.2 配置

图4-1显示了运行状态转换图。图在 PDF 46页

##### 4.2.1寄存器列表

PDF图片 47页

##### 4.2.2 停止码接收器（STPACP）

STPACP是一个只写特殊功能寄存器（SFR），用于设置停止模式。
读取STPACP时，读取“00H”。
当数据以“5nH”（n：任意值）和“0AnH”（n：任意值）的顺序写入STPACP时，停止码接收器被启用。在这种状态下，当备用控制寄存器（SBYCON）的STP位设置为“1”时，模式变为停止模式。设置停止模式时，停止代码接收器被禁用。
当在将“5nH”写入STPACP的指令和写入“0AnH”的指令之间执行另一条指令时，在写入“0AnH”之后，停止码接收器被启用。但是，如果在写入“5nH”之后将“0AnH”以外的数据写入STPACP，则“5nH”写入处理将无效，因此必须从“5nH”开始再次写入数据。
在系统复位期间，停止码接收器被禁用。
注：
如果任何中断启用标志和相应的中断请求标志都为“1”（重置MIE标志的中断请求发生将具有该条件），则不能启用停止码接收器。

##### 4.2.3备用控制寄存器（SBYCON

SBYCON是一种特殊的功能寄存器（SFR），用于控制单片机的工作模式。
[位描述]•STP（位1）

* STP位用于设置停止模式。当STP位设置为“1”且使用STPACP启用停止码适配器时，模式更改为停止模式。当发出NMI中断请求或由中断启用寄存器1（IE1）启用的P00–P03中断请求时，STP位设置为“0”，LSI返回程序运行模式。
*  HLT（位0）
  停止位用于设置停止模式。当停止位设置为“1”时，模式变为停止模式。当发出NMI中断请求、WDT中断请求或启用（中断启用标志为“1”）中断请求时，停止位设置为“1”，模式返回到程序运行模式。

注：
如果任何中断启用标志和相应的中断请求标志均为“1”（重置MIE标志的中断请求发生将具有该条件），则模式不能更改为停止模式或停止模式。
当nX-U8/100内核中程序状态字（PSW）的MIE标志为“0”时，可屏蔽中断源（带启用位的中断）发生时，停止模式和停止模式被简单释放，中断处理不执行。有关PSW的详细信息，请参阅“nX-U8/100 Core说明手册”。



##### 4.2.4 块控制寄存器0（BLKCON0）

图示 PDF 50页 

BLKCON0是一个特殊的功能寄存器（SFR），它通过关闭未使用的外围设备来进一步降低电流消耗。
•DTM3（位3）
DTM3位用于控制定时器3的操作。当DTM3位设置为“1”时，与定时器3相关的电路复位并关闭。

•DTM2（位2）
DTM2位用于控制定时器2的操作。当DTM2位设置为“1”时，与定时器2相关的电路复位并关闭。

•DTM1（位1）
DTM1位用于控制定时器1的操作。当DTM1位设置为“1”时，与定时器1相关的电路复位并关闭。

•DTM0（位0）
DTM0位用于控制定时器3的操作。当DTM0位设置为“1”时，与定时器3相关的电路复位并关闭。

注：
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
有关定时器0、定时器1、定时器2和定时器3的操作详情，请参阅第10章“定时器”。

##### 4.2.5块控制寄存器1（BLKCON1）

BLKCON1是一个特殊的功能寄存器（SFR），通过关闭未使用的外围设备，可以进一步降低电流消耗。
[位描述]

•DCAPR（位6）
DCAPR位用于控制捕获操作。当DCAPR位设置为“1”时，与捕获相关的电路复位并关闭。

•DT1K（位4）
DT1K位用于控制1kHz定时器操作。当DT1K位设置为“1”时，1kHz定时器相关电路复位并关闭。

•DPW0（位0）
DPW0位用于控制PWM0操作。当DPW0位设置为“1”时，与PWM0相关的电路复位并关闭。

注：
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
有关捕获操作的详细信息，请参见第8章“捕获”。
1kHz定时器的操作详见第9章“1kHz定时器”。有关PWM操作的详细信息，请参阅第11章“PWM”。

##### 4.2.6 块控制寄存器2（BLKCON2）

BLKCON2是一个特殊的功能寄存器（SFR），通过关闭未使用的外围设备，可以进一步降低电流消耗。
[位描述]

•DI2C0（位7）
DI2C0位用于控制I2C总线接口操作。当DI2C0位设置为“1”时，与I2C总线接口相关的电路复位并关闭

•DUA0（位2）
DUA0位用于控制UART操作。当DUA0位设置为“1”时，与UART相关的电路复位并关闭。

•DSIO0（位0）
DSIO0位用于控制SSIO操作。当DSIO0位设置为“1”时，与SSIO相关的电路复位并关闭。

注：
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
有关I2C总线接口操作的详细信息，请参阅第15章“I2C总线接口”。有关UART操作的详细信息，请参阅第14章“UART”。
有关SSIO操作的详细信息，请参阅第13章“同步串行端口”。

##### 4.2.7 块控制寄存器3（BLKCON3）

BLKCON3是一个特殊的功能寄存器（SFR），通过关闭未使用的外围设备，可以更有效地降低电流消耗。
[位描述]•DMD0（位0）
DMD0位用于控制旋律/蜂鸣器操作。当DMD0位设置为“1”时，与旋律/蜂鸣器相关的电路复位并关闭。

注：
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
蜂鸣器的操作详见第23章“蜂鸣器”。

##### 4.2.8 块控制寄存器4 （BLKCON4）

BLKCON4是一个特殊的功能寄存器（SFR），通过关闭未使用的外围设备，可以进一步降低电流消耗。
[位描述]

•DLCD（位6）
DLCD位用于控制LCD驱动程序的操作。当DLCD位设置为“1”时，与LCD驱动器相关的电路复位并关闭。

•DBLD（位5）
DBLD位用于控制BLD（电池电量检测器）的操作。当DBLD位设置为“1”时，与BLD相关的电路复位并关闭。

•DXTSP（位4）
ML610Q411/Q412:DXTSP位用于控制32kHz振荡停止检测操作。只有在暂停模式下，当DXTSP位设置为“1”时，与32kHz振荡停止检测相关的电路才会复位并关闭。当工作模式不处于停止状态时，32kHz振荡停止检测始终工作，无论该位的状况如何。
ML610Q411C/ML610Q415:无论该位的状况如何，32kHz振荡停止检测电路始终处于禁用状态。

*ML610Q411PA有一个不同的规格，当DXTSP位设置为“1”时，与32kHz振荡停止检测相关的电路复位并关闭（禁用），无论CPU是否处于停止模式。
•DRAD（位1）
DRAD位用于控制RC型A/D转换器的工作。当DRAD位设置为“1”时，与RC型A/D转换器相关的电路复位并关闭

•DSAD（位0）
DSAD位用于控制SA型A/D转换器的工作。当DSAD位设置为“1”时，与SA型A/D转换器相关的电路复位并关闭

注：
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
有关LCD驱动器操作的详细信息，请参阅第26章“LCD驱动器”。
有关BLD操作的详细信息，请参阅第27章“电池电量检测器”。
32kHz振荡停止检测器的操作详见第3章“复位功能”。
有关RC振荡型A/D转换器的操作细节，请参阅第24章“RC振荡型A/D转换器”。SA型A/D转换器的工作原理详见第25章“逐次逼近法”。

##### 4.3.1 程序运行模式

程序运行模式是CPU顺序执行指令的状态。
在上电复位、复位引脚复位、低速振荡停止检测复位或WDT溢出复位时，CPU在释放系统复位模式后，从程序存储器（ROM）的地址0002H和0003H中设置的地址执行指令。
在通过BRK指令复位时，CPU执行来自在释放系统复位模式之后在程序存储器的地址0004H和0005H中设置的地址的指令。然而，当在执行BRK指令时（在发生WDT中断或NMI中断之后），程序状态字（PSW）的中断电平位（ELEVEL）的值为02H或更高时，CPU执行来自在地址0002H和0003H中设置的地址的指令。
有关BRK指令和PSW的详细信息，请参阅“nX-U8/100 Core指令手册”，有关复位功能，请参阅第3章“复位功能”。

##### 4.3.2 停机模式

暂停模式是CPU中断指令执行，只有外围电路在运行的状态。
当备用控制寄存器（SBYCON）的HLT位设置为“1”时，将设置暂停模式。
当发出NMI中断请求、WDT中断请求或中断启用寄存器（IE1–IE7）启用的中断请求时，HLT位在下一个系统时钟（SYSCLK）的下降沿设置为“0”，停止模式返回到程序运行模式。
图4-2显示了停止模式下的操作波形。

图片 PDF 56页

注：
由于在暂停模式释放和转换到中断处理之间的时间段内最多执行两条指令，因此将两条NOP指令放在将HLT位设置为“1”的指令旁边。

##### 4.3.3 停止模式
ML610Q411/ML610Q412/ML610Q415用户手册第4章MCU控制功能
停止模式是指低速振荡和高速振荡停止，CPU和外围电路停止工作的状态。
当通过将“5nH”（n：任意值）和“0AnH”（n：任意值）顺序写入停止码接收器（STPACP）来启用停止码接收器，并且备用控制寄存器（SBYCON）的STP位设置为“1”时，进入停止模式。设置停止模式时，停止代码接收器被禁用。
当发出NMI中断请求或中断启用（中断启用标志为“1”）P00至P003中断请求时，STP位设置为“0”，停止模式被释放，模式返回到程序运行模式。

##### 4.3.3.1 CPU低速时钟运行时的停止模式
当停止码接收器处于启用状态并且SBYCON的STP位设置为“1”时，进入停止模式，停止低速振荡和高速振荡。
当发出NMI中断请求或中断启用（中断启用标志为“1”）P00至P03中断请求时，STP位设置为“0”，低速振荡重新启动。如果高速时钟在进入停止模式之前振荡，则高速振荡将重新启动。当进入停止模式前高速时钟没有振荡时，高速振荡不会开始。
当发生中断请求时，在经过低速振荡开始时间（TXTL）和低速时钟（LSCLK）振荡稳定时间（8192脉冲计数）之后释放停止模式，该模式返回到编程模式，并且低速时钟（LSCLK）重新开始向外围电路供电。如果此时高速时钟已经开始振荡，高速时钟（OSCLK和HSCLK）也会重新开始向外围电路供电。
关于低速振荡开始时间（TXTL），见附录C中的“电气特性”部分。图4-3显示了CPU与低速时钟一起运行时，停止模式下的运行波形。

图在 PDF 57 页

##### 4.3.3.2 CPU高速时钟运行时的停止模式

当CPU在高速时钟下运行，且SBYCON的STP位设置为“1”且停止码接收器启用时，进入停止模式，高速振荡和低速振荡停止。
当发出NMI中断请求或中断启用（中断启用标志为“1”）P00至P03中断请求时，STP位设置为“0”，低速和高速振荡重新启动。
当发出中断请求时，在经过高速振荡开始时间（TRC）和高速时钟（OSCLK）振荡稳定时间（8192脉冲计数）之后释放停止模式，模式返回到程序运行模式，并且高速时钟（OSCLK和HSCLK）重新开始向外围电路供电。
在经过低速振荡开始时间（TXTL）和低速时钟（LSCLK）振荡稳定时间（8192计数）之后，低速时钟（LSCLK）重新开始向外围电路供电。
有关高速振荡开始时间（TRC）和低速振荡开始时间（TXTL），请参阅附录C中的“电气特性”部分。
图4-4显示了CPU与高速时钟一起工作时，停止模式下的操作波形。

图片 PDF 58 页

注：
在将STP位设置为“1”的指令之后的两个周期内进入停止模式，并且在停止模式释放和转换到中断处理之间的期间执行最多两条指令。因此，在将STP位设置为“1”的指令旁边放置两条NOP指令

##### 4.3.3.3 停止/停止模式返回操作的注意事项

从停止模式和停止模式返回的操作根据程序状态字（PSW）的中断级别（ELEVEL）、主中断启用标志（MIE）、中断启用寄存器（IE0到IE3）的内容以及中断是不可屏蔽中断还是可屏蔽中断而变化。
有关PSW以及IE和IRQ寄存器的详细信息，请分别参阅“nX-U8/100 Core指令手册”和第5章“中断”。
表4-1和表4-2显示了停止/停止模式的返回操作。

图片 PDF 59页

笔记：
•如果ELEVEL位为0H，则表示CPU既没有执行不可中断处理，也没有执行
可屏蔽中断处理或软件中断处理。
•如果ELEVEL位为1H，则表示CPU正在执行可屏蔽中断处理或软件中断
处理。（ELEVEL在中断转换周期期间设置。）
•如果ELEVEL位为2H，则表示CPU正在执行不可屏蔽的中断处理。（设置标高
在中断转换周期期间。）
•如果ELEVEL位为3H，则表示CPU正在执行针对模拟器的中断处理。这个
正常应用程序中不允许设置。

##### 4.3.4 闭塞控制功能

这种大规模集成电路具有块控制功能，可以重置和完全关闭未使用的外围设备的操作电路，从而进一步降低电流消耗。
当块控制寄存器的某些位被设置为“1”时，相应的外围设备被重置（所有寄存器被重置），外围设备的操作时钟停止。当块控制寄存器的位设置为“1”并返回初始值进行读取时，写入相应外围设备中的每个SFR（特殊功能寄存器）无效。在使用外围设备启用操作之前，请确保位重置为“0”。
BLKCON0寄存器控制（禁用/启用）定时器0、定时器1、定时器2和定时器3的操作。BLKCON1寄存器控制（禁用/启用）捕捉、1kHz定时器和PWM的操作。BLKCON2寄存器控制（禁用/启用）I2C、UART和SSIO的操作。
BLKCON3寄存器控制（禁用/启用）旋律/蜂鸣器的操作。
BLKCON4寄存器控制（禁用/启用）LCD驱动器、电池电量检测器、32kHz振荡停止检测器、RC型A/D转换器和SAR型A/D转换器的操作。
注：
BLKCON4寄存器的DXTSP位（第4位）仅在停止模式下禁用32kHz振荡停止检测器的操作。各外围设备的操作及相关注意事项详见各章。
*ML610Q411PA有一个不同的规格，当DXTSP位设置为“1”时，与32kHz振荡停止检测相关的电路复位并关闭（禁用），无论CPU是否处于停止模式。

## 第5章 中断

##### 5.1 楷述

此LSI有25个中断源（外部中断：5个源，内部中断：20个源）和一个软件中断（SWI）。
有关每个中断的详细信息，请参阅以下章节：

第7章，“时基计数器”第9章，“1 kHz定时器”第10章，“定时器”
第11章，“PWM”
第12章，“看门狗定时器”
第13章，“同步串口”
第14章，“通用异步收发器”
第15章，“I2C总线接口”
第16章，“NMI”
第17章，“端口0”
第24章，“RC振荡型A/D转换器”
第25章，“逐次逼近型A/D转换器”

##### 5.1.1 特征
•2个不可屏蔽中断源（内部源：1，外部源：1）

•19个可屏蔽中断源（内部源：15，外部源：4）

•软件中断（SWI）：最多64个源。
•外部中断允许边缘选择和采样选择。

##### 5.2.1 寄存器列表

图 PDF 63页

##### 5.2.2 中断启用寄存器1（IE1）

IE1是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE1的相应标志不复位。
[位描述]

•EP00（位0）
EP00是输入端口P00引脚中断（P00INT）的启用标志。

•EP01（位1）
EP01是输入端口P01引脚中断（P01INT）的启用标志。

•EP02（位2）
EP02是输入端口P02引脚中断（P02INT）的启用标志。

• EP03 (位 3)
 EP03 is the enable flag for the input port P03 pin interrupt (P03INT).

EP03是输入端口P03引脚中断(P03INT)的启用标志。

##### 5.2.3 中断启用寄存器2（IE2）

IE2是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE2的相应标志不复位。
[位描述]

•ESIO0（位0）
ESIO0是同步串行端口0中断（SIO0INT）的启用标志

•ESAD（位2）
ESAD是逐次逼近型A/D转换器中断（SADINT）的启用标志。

•EI2C0（位7）
EI2C0是I2C总线0中断（I2C0INT）的启用标志。

##### 5.2.4 中断启用寄存器3 （IE3）

E3是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE3的相应标志不复位。
[位描述]

•ETM0（位0）
ETM0是定时器0中断（TM0INT）的启用标志。

•ETM1（位1）
ETM1是定时器1中断（TM1INT）的启用标志。

##### 5.2.5 中断启用寄存器4 （IE4）

IE4是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE4的相应标志不复位。
[位描述]

•EUA0（位0）
EUA0是UART0中断（UA0INT）的启用标志。

•ERAD（位5）
ERAD是RC振荡型A/D转换器中断（RADINT）的启用标志。



##### 5.2.6 中断启用寄存器5 （IE5）

IE5是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE5的相应标志不复位。
[位描述]

•ETM2（位4）
ETM2定时器2中断（TM2INT）的启用标志。

•ETM3（位5）
ETM3定时器3中断的启用标志（TM3INT）



##### 5.2.7 中断启用寄存器6 （IE6）

IE6是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE6的相应标志不复位。
[位描述]

•EPW0（位0）
EPW0是PWM0中断（PW0INT）的启用标志

•ET1K（位4）
ET1K是1kHz定时器中断（T1KINT）的启用标志

•E128H（位5）
E128H是时基计数器128 Hz中断（T128H）的启用标志

•E32H（位7）
E32H是时基计数器32 Hz中断（T32HINT）的启用标志

##### 5.2.8 中断启用寄存器7 （IE7）

IE7是一个特殊功能寄存器（SFR），用于控制每个中断请求的启用/禁用。
当中断被接受时，主中断启用标志（MIE）被设置为“0”，但IE7的相应标志不复位。
[位描述]

•E16H（位0）
E16H是时基计数器16 Hz中断（T16HINT）的启用标志

•E2H（位3）
E2H是时基计数器2 Hz中断（T2HINT）的启用标志。

##### 5.2.9 中断请求寄存器0 （IRQ0）

IRQ0是一个特殊的函数寄存器（SFR），用于请求每个中断源的中断。
看门狗定时器中断（WDTINT）和NMI中断（NMINT）是不依赖MIE的不可屏蔽中断。在这种情况下，无论掩码中断启用标志（MIE）的值是多少，都会向CPU请求中断。
生成中断时，无论MIE值如何，每个IRQ0请求标志都设置为“1”。通过软件将IRQ0请求标志设置为“1”，可以生成中断。
当中断请求被CPU接受时，硬件将IRQ0的相应标志设置为“0”。
[位描述]

•QWDT（位0）
QWDT是看门狗定时器中断（WDTINT）的请求标志。

•QNMI（位1）
QNMI是NMI中断（NMINT）的请求标志。

注：
当向中断请求寄存器（IRQ0）写入指令生成中断时，中断移位周期在执行下一条1指令后开始。

##### 5.2.10 中断请求寄存器1 （IRQ1）

IRQ1是一个特殊功能寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE1和MIE值如何，每个IRQ1请求标志都设置为“1”。在这种情况下，当中断使能寄存器（IE1）的相关标志设置为“1”并且主中断使能标志（MIE）设置为“1”时，向CPU请求中断。
通过软件将IRQ1请求标志设置为“1”，可以生成中断。
当CPU接受中断请求时，硬件将IRQ1的相应标志设置为“0”。
[位描述]

•QP00（位0）
QP00是输入端口P00引脚中断（P00INT）的请求标志。

•QP01（位1）
QP01是输入端口P01引脚中断（P01INT）的请求标志。

•QP02（位2）
QP02是输入端口P02引脚中断（P02INT）的请求标志

•QP03（位3）
QP03是输入端口P03引脚中断（P03INT）的请求标志。

注：
当向中断请求寄存器（IRQ1）或中断启用寄存器（IE1）写入指令生成中断时，中断移位周期在执行下一条指令后开始。

##### 5.2.11 中断请求寄存器2 （IRQ2）

IRQ2是一个特殊的函数寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE2和MIE值如何，每个IRQ2请求标志都设置为“1”。在这种情况下，当中断使能寄存器（IE2）的相关标志设置为“1”并且主中断使能标志（MIE）设置为“1”时，向CPU请求中断。
通过软件将IRQ2请求标志设置为“1”，可以生成中断。
当中断请求被CPU接受时，硬件将IRQ2的相应标志设置为“0”。
[位描述]

•QSIO0（位0）
QSIO0是同步串行端口0中断（SIO0INT）的请求标志。

•QSAD（第2位）
QSAD是连续近似A/D转换器中断（SADIT）的请求标志

•QI2C0（位7）
QI2C0是I2C总线0中断（I2C0INT）的请求标志。

注：
当向中断请求寄存器（IRQ2）或中断启用寄存器（IE2）写入指令生成中断时，中断移位周期在执行下一条1指令后开始。

#####  5.2.12 中断请求寄存器3 （IRQ3）

IRQ3是一个特殊的函数寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE3和MIE值如何，每个IRQ3请求标志都设置为“1”。在这种情况下，当中断启用寄存器（IE3）的相关标志被设置为“1”并且主中断启用标志（MIE）被设置为“1”时，中断被请求到CPU。
通过软件将IRQ3请求标志设置为“1”，可以生成中断。
当CPU接受中断请求时，硬件将IRQ3的相应标志设置为“0”。
[位描述]

•QTM0（位0）
QTM0是定时器0中断（TM0INT）的请求标志。

•QTM1（位1）
QTM1是定时器1中断（TM1INT）的请求标志。

注：
当向中断请求寄存器（IRQ3）或中断启用寄存器（IE3）写入指令生成中断时，中断移位周期在执行下一条1指令后开始。

##### 5.2.13 中断请求寄存器4 （IRQ4）

IRQ4是一个特殊的函数寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE4和MIE值如何，每个IRQ4请求标志都设置为“1”。在这种情况下，当中断启用寄存器（IE4）的相关标志被设置为“1”并且主中断启用标志（MIE）被设置为“1”时，中断被请求到CPU。
通过软件将IRQ4请求标志设置为“1”，可以生成中断。
当CPU接受中断请求时，硬件将IRQ4的相应标志设置为“0”。
[位描述]

•QUA0（位0）
QUA0是UART0中断（UA0INT）的请求标志。

•QRAD（位5）
QRAD是RC振荡型A/D转换器中断（RADINT）的请求标志。

注：
当向中断请求寄存器（IRQ4）或中断启用寄存器（IE4）写入指令生成中断时，中断移位周期在执行下一条1指令后开始。

##### 5.2.14 中断请求寄存器5 （IRQ5）

IRQ5是一个特殊功能寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE5和MIE值如何，每个IRQ5请求标志都设置为“1”。在这种情况下，当中断启用寄存器（IE5）的相关标志被设置为“1”并且主中断启用标志（MIE）被设置为“1”时，中断被请求到CPU。
通过软件将IRQ5请求标志设置为“1”，可以生成中断。
当CPU接受中断请求时，硬件将IRQ5的相应标志设置为“0”。
[位描述]

•QTM2（位5）
QTM2是定时器2中断（TM2INT）的请求标志。

•QTM3（位6）
QTM3是定时器3中断（TM3INT）的请求标志。

注：
当向中断请求寄存器（IRQ5）或中断启用寄存器（IE5）写入指令产生中断时，中断移位周期在执行下一条1指令后开始。



##### 5.2.15 中断请求寄存器6 （IRQ6）

IRQ6是一个特殊功能寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE6和MIE值如何，每个IRQ6请求标志都设置为“1”。在这种情况下，当中断使能寄存器（IE6）的相关标志设置为“1”并且主中断使能标志（MIE）设置为“1”时，向CPU请求中断。
通过软件将IRQ6请求标志设置为“1”，可以生成中断。
当中断请求被CPU接受时，硬件将IRQ6的相应标志设置为“0”。
[位描述]

•QPW0（位0）
QPW0是PWM0中断（PW0INT）的请求标志。

•QT1K（位4）
QT1K是1khz定时器中断（T1KINT）的请求标志。

•Q128H（位5）
Q128H是时基计数器128 Hz中断（T128H）的请求标志。

•Q32H（位7）
Q32H是时基计数器32赫兹中断（T32HINT）的请求标志

注：
当向中断请求寄存器（IRQ6）或中断启用寄存器（IE6）写入指令生成中断时，中断移位周期在执行下一条1指令后开始。

##### 5.2.16 中断请求寄存器7 （IRQ7）

IRQ7是一个特殊的功能寄存器（SFR），用于请求每个中断源的中断。
生成中断时，无论IE7和MIE值如何，每个IRQ7请求标志都设置为“1”。在这种情况下，当中断启用寄存器（IE7）的相关标志被设置为“1”并且主中断启用标志（MIE）被设置为“1”时，中断被请求到CPU。
通过软件将IRQ7请求标志设置为“1”，可以生成中断。
当中断请求被CPU接受时，硬件将IRQ7的相应标志设置为“0”。
[位描述]

•Q16H（位0）
Q16H是时基计数器8赫兹中断（T8HINT）的请求标志。

•Q2H（位3）
Q2H是时基计数器2赫兹中断（T2HINT）的请求标志。

注：
当写入中断请求寄存器（IRQ7）或中断启用寄存器（IE7）的指令生成中断时，中断移位周期在执行下一条1指令后开始。

##### 5.3 操作说明

除看门狗定时器中断（WDTINT）和NMI中断（NMINT）外，19个源的中断启用/禁用由主中断启用标志（MIE）和单个中断启用寄存器（IE1至7）控制。WDTINT和NMIINT是不可屏蔽的中断。
当中断条件满足时，CPU从为每个中断源确定的向量表中调用分支目标地址，并且中断移位周期开始分支到中断处理例程。表5-1列出了中断源。

图 如下5-1 PDF 79页

注：
-当同时生成多个中断时，根据该优先级为中断提供服务，低优先级中断的处理挂起。
-请为所有未使用的中断定义向量表以防故障。

##### 5.3.1 可屏蔽中断处理

当MIE标志设置为“1”时产生中断，硬件执行以下处理，程序处理转移到中断目的地。

（1） 将程序计数器（PC）传输到ELR1。（2） 将CSR传输到ECSR1。
（3） 将PSW转移到PSW1。
（4） 将MIE标志设置为“0”。
（5） 将ELEVEL字段设置为“1”。
（6） 将中断起始地址加载到PC机中。

##### 5.3.2 不可屏蔽中断处理

当产生中断时，不管MIE标志的状态如何，由硬件执行以下处理，并且程序的处理转移到中断目的地。

（1） 将PC传输到ELR2。
（2） 将CSR传输到ECSR2。
（3） 将PSW传输到EPSW2。
（4） 将ELEVEL字段设置为“2”。
（5） 将中断起始地址加载到PC机中

##### 5.3.3 软件中断处理

在应用程序中根据需要生成软件中断。当在程序内执行SWI指令时，生成软件中断，由硬件执行以下处理，并且
处理程序移到中断目的地。
（1） 将PC传输到ELR1。
（2） 将CSR传输到ECSR1。
（3） 将PSW传输到EPSW1。
（4） 将MIE标志设置为“0”。
（5） 将ELEVEL字段设置为“1”。
（6） 将中断起始地址加载到PC机中。
向量表由SWI指令指定。
参考文献：
有关MIE标志、程序计数器（PC）、CSR、PSW和ELEVEL，请参阅“nX-U8/100 Core说明手册”。

##### 5.3.4 中断程序的注意事项

注释在编程中是不同的，这取决于程序在执行中断例程时是否调用子例程，是否启用或禁用多个中断，以及这些中断是可屏蔽的还是不可屏蔽的。
状态A:正在处理可屏蔽中断
A-1：当程序在执行中断程序时没有调用子程序时A-1-1：当多个中断被禁用时
•中断例程执行开始后立即处理，无特定注释。
•中断例程执行结束时的处理
指定RTI指令，将ELR寄存器的内容返回PC，将EPSW寄存器的内容返回PSW。
A-1-2：启用多个中断时
•中断例程执行开始后立即处理
指定“PUSH ELR，EPSW”将中断返回地址和PSW状态保存在堆栈中。•中断例程执行结束时的处理
指定“POP PC，PSW”而不是RTI指令，以将堆栈的内容返回给PC和PSW。

图片 PDF81页

A-2：当程序在执行中断程序时调用子程序时

A-2-1：当多个中断被禁用时

•中断例程执行开始后立即处理
指定“PUSH LR”指令将子程序返回地址保存在堆栈中。

•中断例程执行结束时的处理
在将子程序返回地址返回到LR之后，在RTI指令之前指定“POP LR”，以便从中断处理返回。

A-2-2：启用多个中断时
•中断例程执行开始后立即处理
指定“PUSH LR，ELR，EPSW”保存中断返回地址、子程序返回地址和
堆栈中的EPSW状态。
•中断例程执行结束时的处理
指定“POP PC，PSW，LR”代替RTI指令，将中断返回地址的保存数据返回到PC，EPSW的保存数据返回到PSW，LR的保存数据返回到LR。

图 PDF 82页

状态B: 正在处理不可屏蔽中断

B-1：中断程序中没有执行指令时
•中断例程执行开始后立即处理
指定RTI指令，将ELR寄存器的内容返回PC和EPSW寄存器的内容
到PSW。

B-2：在中断程序中执行一条或多条指令时
B-2-1：当程序在执行中断程序时没有调用子程序时

•中断程序执行开始后立即处理
指定“PUSH ELR，EPSW”将中断返回地址和PSW状态保存在堆栈中。

•中断例程执行结束时的处理
指定“POP PC，PSW”而不是RTI指令，以将堆栈的内容返回给PC和PSW。

B-2-2：当程序在执行中断程序时调用子程序时
•中断例程执行开始后立即处理
指定“PUSH LR，ELR，EPSW”以在堆栈中保存中断返回地址、子例程返回地址和EPSW状态。
•中断例程执行结束时的处理
指定“POP PC，PSW，LR”代替RTI指令，将中断返回地址的保存数据返回到PC，EPSW的保存数据返回到PSW，LR的保存数据返回到LR。

图片 PDF 83页

##### 5.3.5 中断禁用状态

即使满足中断条件，根据操作状态，也可能不接受中断。这称为中断禁用状态。请参阅下面的中断禁用状态和在此状态下的中断处理。
中断禁用状态1：在中断移位周期和中断例程开始时的指令之间
当满足本节中的中断条件时，在中断例程的开始处执行指令后，立即生成与已启用的中断相对应的中断。
中断禁用状态2：在DSR前缀指令和下一条指令之间
当满足本节中的中断条件时，在执行DSR前缀指令之后的指令后立即生成中断。
参考文献：
有关DSR前缀指令，请参阅“nX-U8/100 Core指令手册”。

## 第六章 时钟产生电路

##### 6.1 楷述

时钟产生电路产生并提供低速时钟（LSCLK）、2×低速时钟（LSCLK2）、高速时钟（HSCLK）、系统时钟（SYSCLK）和高速输出时钟（OUTCLK）。LSCLK、LSCLK×2和HSCLK是用于外围电路的时基时钟，SYSCLK是CPU的基本操作时钟，OUTCLK是从端口输出的时钟。
有关OUTCLK输出端口，请参阅第19章“端口2”。此外，对于本章中描述的停止模式，请参阅第4章“MCU控制功能”，对于BLD，请参阅第27章“电池电量检测电路”。

##### 6.1.1 特征

•低速时钟：32.768 kHz晶体振荡模式ML610Q411/ML610Q412：
−32.768kHz晶体振荡模式
−能够生成LSCLK×2（64 kHz），用于某些外围设备。ML610Q411/ML610Q412：
−500kHz RC振荡模式的1/16（31.25kHz）
−能够产生LSCLK×2（62.5kHz），用于某些外围设备。•高速时钟：软件选择
−500 kHz RC振荡模式
−外部时钟输入模式（ML610Q415上不可用）

##### 6.1.2 配置

图6-1显示了时钟生成电路的配置

图 PDF 86 页

FCON0：频率控制寄存器0
FCON1：频率控制寄存器1
*1:不用于ML610Q415
*2:SYSCLK在ML610Q415上固定到HSCLK

注：
该LSI在通电或系统复位后，用500 kHz RC振荡频率除以8生成的时钟开始工作。在通过软件初始化时，设置FCON0或FCON1寄存器以将时钟切换到所需的时钟。在没有提供低速时钟的情况下，ML610Q411/ML610Q412的工作不受保证。

##### 6.1.3 引脚列表

---

XT0   连接低速时钟晶体的引脚

----

XT1   连接低速时钟晶体的引脚（ML610Q415上未连接）

---

P10/OSC0    外部高速时钟输入引脚用于P10引脚的辅助功能（外部时钟输入在ML610Q415上不可用）

---

##### 6.2.1 寄存器列表

---

0F002H   频率控制寄存器0

---

0F003H  频率控制寄存器1

---

##### 6.2.2 频率控制寄存器0（FCON0）

FCON0是一种特殊的功能寄存器（SFR），用于控制高速时钟产生电路和选择系统时钟。
[位描述]
•SYSC1、SYSC0（位1、0）
SYSC1和SYSC0位用于选择用于系统时钟和外围电路（包括高速时基计数器）的高速时钟（HSCLK）的频率。可选择OSCLK、1/2OSCLK、1/4OSCLK或1/8OSCLK。该LSI的系统时钟（SYSCLK）的最大工作频率保证为500kHz。系统复位时，选择1/8OSCLK。

•OSCM0（位2）
OSCM0位用于选择高速时钟产生电路的模式。
可选择外部时钟输入模式。
只有在停止高速振荡时（FCON1的ENOSC位为“0”），才能更改OSCM0的设置。系统复位时，选择RC振荡模式。
模式固定为RC振荡模式，读取ML610Q415时，该位始终返回“0”。

•输出C1、输出C0（位5、4）
OUTC1和OUTC0位用于选择高速输出时钟的频率，该时钟在使用端口的辅助功能时输出。
可选择OSCLK、1/2OSCLK、1/4OSCLK或1/8OSCLK。
系统复位时，选择1/8OSCLK。

注：
−要使用OSCM0位切换高速时钟生成电路的模式，请停止高速振荡
并将系统时钟设置为低速时钟（将FCON1的ENOSC位和SYSCLK设置为“0”）。
−该LSI的系统时钟（SYSCLK）的最大保证工作频率为500kHz。连接到P10/OSC0引脚的外部时钟不得超过500kHz。有关规范的更多详细信息，请参阅
附录C，“电气特性”



##### 6.2.3 频率控制寄存器1（FCON1）

FCON1是一种特殊的功能寄存器（SFR），用于控制高速时钟产生电路和选择系统时钟。
[位描述]

•SYSCLK（位0）
SYSCLK位用于选择系统时钟。它允许使用FCON0的高速时钟频率选择位（SYSC1，0）选择低速时钟（LSCLK）或高速时钟（1/nOSCLK:n=1、2、4、8）。
当高速时钟的振荡停止（ENOSC bit=“0”）时，SYSCLK位固定为“0”，系统时钟选择低速时钟（LSCLK）。
系统时钟固定为HSCLK，读取ML610Q415时，该位始终返回“1”。

•ENOSC（位1）
ENOSC位用于选择启用/禁用高速时钟振荡器的振荡。
在停止模式下，高速时钟的振荡总是enable exept，在ML610Q415上读取时，该位总是返回“1”。

•ENMLT（位2）
ENMLT位用于选择启用/禁用2×低速时钟（LSCLK×2）的操作。

##### 6.3.1.1 低速时钟产生电路

图6-2显示了低速时钟生成电路的配置。 图显示在 PDF 91页

ML610Q411/ML610Q412：
低速时钟产生电路配备有外部32.768khz晶体。要使用微调电容器匹配振荡频率，请根据需要连接外部电容器（CGL和CDL）。
在停止模式下，VDDX断电以停止低速振荡，XT0和XT1引脚变为Hiz（高阻抗状态）。当FCON1的ENMLT位设置为“1”时，2×低速时钟电路开始产生LSCLK×2（64kHz）。
ML610Q415：
LSCLK由高速时钟产生电路和1/16器件产生。不需要外部晶体振荡器。在停止模式下，高速时钟振荡停止。当FCON1的ENMLT位设置为“1”时，2×低速时钟电路开始产生LSCLK×2（62.5kHz）。

笔记：
−在尽可能靠近LSI的地方安装一个晶体，并确保引起噪声的信号和电源接线正常
不要靠近水晶和它的接线。
−注意，振荡可能因冷凝而停止

##### 6.3.1.2 低速时钟产生电路的操作

ML610Q411/ML610Q412：
低速时钟产生电路通过上电复位激活。
在通电后经过低速振荡开始周期（TXTL）和振荡稳定周期（8192计数）之后，向外围电路提供低速时钟（LSCLK）。
低速时钟产生在停止模式下停止振荡。当通过外部中断释放停止模式来恢复振荡时，在经过低速振荡开始周期（TXTL）和低速时钟（LSCLK）振荡稳定周期之后，向外围电路提供LSCLK。停止模式见第4章“MCU控制功能”。
图6-3-1显示了低速时钟产生电路的波形。低速振荡开始时间（TXTL）见附录C“电气特性”。

图 PDF 92页

注：
打开电源后，CPU开始以高速时钟（500 kHz RC振荡）运行。建议在通过检查低速时基计数器的128 Hz中断请求位（Q128H）是否为“1”来确认低速时钟正在振荡后，切换到低速时钟。如果在低速时钟振荡之前切换时钟，CPU将停止运行，直到低速时钟开始振荡。

ML610Q415：
低速时钟（LSCLK）与高速时钟（HSCLK）同时开始供电。有关高速时钟生成的详细信息，请参阅第6.3.2章“高速时钟”。
低速时钟产生电路以停止模式停止振荡。当通过外部中断释放停止模式来恢复振荡时，在经过低速振荡开始周期（TRC）和高速时钟（HSCLK）振荡稳定周期（128计数）之后，HSCLK和LSCLK同时被提供给外围电路。停止模式见第4章“MCU控制功能”。图6-3-2显示了低速时钟产生电路的波形。低速振荡开始时间（TXTL）见附录C“电气特性”。

##### 6.3.2 高速时钟

频率控制寄存器0（FCON0）的OSCM0位的设置允许为高速时钟产生电路选择500 kHz RC振荡模式或外部时钟输入模式。

##### 6.3.2.1 500 kHz RC振荡

在RC振荡模式（OSCM0=“0”）下，当振荡启动后RC振荡时钟脉冲计数达到128（ENOSC设置为“1”）时，启动OSCLK（高速振荡时钟）的供电。
在500 kHz RC振荡模式下，P10/OSC0引脚都可用作通用输入端口。
图6-4显示了RC振荡模式下的电路配置。

笔记：
−RC振荡模式允许在VDD=1.3 V至3.6 V的范围内。
−系统复位模式解除后，在RC振荡时钟脉冲计数达到8192后，OSCLK开始供电。
停止模式解除后，OSCLK开始供电。

##### 6.3.2.2 外部时钟输入模式

在外部时钟输入模式下，外部时钟从P10/OSC0引脚输入。图6-5显示了外部时钟输入模式下的电路配置。

笔记：
−外部时钟输入模式在ML610Q415上不可用。
−外部时钟输入模式可在1.8 V至3.6 V的VDD范围内使用。根据需要选择频率
使用电源电压检测电路（BLD）确定工作电压范围。
−由于二极管包括在P10/OSC0引脚和VDD之间以及P10/OSC0引脚和VSS之间，因此不要
向P10/OSC0引脚施加高于VDD和低于VSS的电压。
−如果P10/OSC0引脚在外部时钟输入模式下保持打开，则可能会产生过大电流。因此，确保
输入“H”电平（VDD）或“L”电平（VSS）。
−该LSI的系统时钟（SYSCLK）的最大保证工作频率为500kHz。外部
连接到P10/OSC0引脚的时钟不得超过500kHz。有关规范的更多详细信息，请参见附录C“电气特性”

##### 6.3.2.3高速时钟产生电路的操作

通过上电复位产生，在500Hz RC振荡模式下激活高速时钟产生电路。
由于上电复位的发生，电路进入系统复位模式，然后在经过高速振荡时钟（OSCLK）的高速RC振荡开始时间（TRC）和振荡稳定时间（计数：8192）之后，切换到程序操作模式，同时，向外围电路提供高速时钟（HSCLK）。
图6-6显示了上电时高速时钟产生电路的波形。图 PDF 96页
振荡开始时间（TRC），见附录C“电气特性”。

高速时钟产生电路允许通过使用频率控制寄存器0和1（FCON0和FCON1）来选择振荡模式和振荡的开始/停止。
在FCON0中选择高速振荡模式和高速振荡频率后，可以通过将ENOSC位设置为“1”来启动振荡。在振荡开始之后，HSCLK在高速振荡时钟的高速振荡开始周期（TRC）和振荡稳定周期之后开始向外围电路提供时钟。
高速时钟产生电路以停止模式停止振荡。当通过外部中断释放停止模式时，HSCLK在高速时钟的高速振荡开始周期（TRC）和振荡稳定周期过后向外围电路提供时钟。振荡稳定周期是128个时钟脉冲的持续时间。

图6-7显示了晶体/陶瓷振荡模式下高速时钟产生电路的波形。 图PDF 97页

##### 6.3.3 系统时钟切换

通过使用频率控制寄存器（FCON0、FCON1），可以在高速时钟（HSCLK）和低速时钟（LSCLK）之间切换系统时钟。此功能在ML610Q415上不可用。
图6-8显示了系统时钟切换处理流程（HSCLK→LSCLK），图6-11显示了系统时钟切换处理流程（LSCLK→HSCLK）。

注：
−ML610Q415上没有将HSCLK切换到LSCLK的功能。
−电源接通后或系统时钟从HSCLK切换到LSCLK后
从停止模式返回，CPU变为非活动状态，直到LSCLK开始向外围电路提供时钟。因此，建议在通过检查时基计数器中断请求位（Q128H）是否为“1”来确认LSCLK正在振荡之后，切换到LSCLK。

图  PDF 99页

注：
−ML610Q415上没有将HSCLK切换到LSCLK的功能。
−如果系统时钟在高速时钟之前从低速时钟切换到高速时钟
（HSCLK）开始振荡，CPU变为非活动状态，直到HSCLK开始向外围电路提供时钟。

##### 6.4 指定端口寄存器

当您想确保时钟输出功能正常工作时，请检查是否指定了相关的端口寄存器。有关端口寄存器的详细信息，请参阅第20章“端口2”

##### 6.4.1 作为高速时钟输出的P21（OUTCLK）功能

将P21MD位（P2MOD寄存器的位1）设置为“1”，以指定高速时钟输出作为P21的辅助功能。

将P21C1位（P2CON1寄存器的位1）设置为“1”，将P21C0位（P2CON0寄存器的位1）设置为“1”，以将P21指定为CMOS输出。

P21D位（P2D寄存器的位1）的数据对高速时钟输出功能没有影响，因此不关心该功能的数据。

-：位不存在。
*：位与高速时钟功能无关

**：不关心数据。

注：
P21（端口2）是一个仅输出端口，没有用于选择数据方向（输入或输出）的寄存器。

##### 6.4.2将P22（LSCLK）用作低速时钟输出

将P22MD位（P2MOD寄存器的位2）设置为“1”，以将低速时钟输出指定为P22的辅助功能。

将P22C1位（P2CON1寄存器的位2）设置为“1”，将P22C0位（P2CON0寄存器的位2）设置为“1”，以将P22指定为CMOS输出。

P22D位（P2D寄存器的bit2）的数据对低速时钟输出功能没有影响，因此不关心该功能的数据。

-：位不存在。
*：位与低速时钟功能无关

**：不关心数据。

注：
P22（端口2）是一个仅输出端口，没有用于选择数据方向（即输入或输出）的寄存器。

## 第7章 时基计数器

##### 7.1 楷述

该LSI包括一个低速时基计数器（LTBC）和一个高速时基计数器（HTBC），它们为外围电路生成基频。通过使用时基计数器，可以周期性地生成事件。
有关输入时钟，请参阅第6章“时钟生成电路”。有关本章中描述的中断许可、中断请求标志等，请参阅第5章“中断”。

##### 7.1.1 特征

•LTBC通过划分低速时钟（LSCLK）频率产生T32KHZ至T1HZ信号。
•HTBC通过划分高速时钟（HSCLK）频率生成HTB1至HTB32信号。
•LTBC允许频率调整（调整范围：约−488ppm至+488ppm。调整精度：
使用低速时基计数器频率调整寄存器（LTBADJH和
LTBADJL）。(*1)
•能够产生128Hz、32Hz、16Hz和2Hz中断。(*2)
注：
（*1）此功能可用于具有低速晶体振荡时钟的ML610Q411和ML610Q412。（*2）对于ML610Q415，频率将为{122Hz、30.5Hz、15.3Hz和1.9Hz}±RC振荡的温度变化。

##### 7.2 配置

图7-1和图7-2分别显示了低速时基计数器和高速时基计数器的配置。

图 在 PDF 103页

LTBR :  低速时基计数器寄存器
LTBADJL：低速时基计数器频率调整

LTBADJH：低速时基计数器频率调整寄存器

注：
HSCLK的频率根据频率控制寄存器0（FON0）的SYSC1位和SYSC0位中的指定数据而变化

##### 7.2.1 寄存器说明 寄存器列表

图片 PDF 105页

##### 7.2.2 低速时基计数器（LTBR）

LTBR是一个特殊功能寄存器（SFR），用于读取低速时基计数器的T128HZ-T1HZ输出。对LTBR执行写入操作时，T128HZ-T1HZ输出设置为“0”。
注：
TBC中断（128Hz中断、32Hz中断、16Hz中断或2Hz中断）*可能发生，具体取决于LTBR写入定时（见图7-4，“通过写入LTBR的中断定时和复位定时”）。因此，在软件编程时要小心。
（*）对于ML610Q415，频率将为{122Hz、30.5Hz、15.3Hz和1.9Hz}±RC振荡的温度变化。

##### 7.2.3 高速时基计数器除法寄存器（HTBDR）

HTBDR是一个特殊的函数寄存器（SFR），用于设置4位1/n计数器的除法比。
[位描述]
•HTD3-HTD0（位3-0）
HTD3-HTD0位用于设置4位1/n计数器的分频比。可选择的比率包括1/1到1/16。

图 PDF 107页

*1: 表示高速振荡时钟HSCLK为500kHz时的频率。

##### 7.2.4 低速时基计数器频率调整寄存器L和H（LTBADJL、LTBADJH）

LTBADJL和LTBADJH是特殊功能寄存器（sfr），用于设置低速时基时钟的频率调整值。
[位描述]
•LADJS，LADJ9-LADJ8（位2-0）LADJ7-LADJ0（位7-0）
LADJS和LADJ9到LADJ0位用于调整频率。
调整范围：约−488ppm至+488ppm。
调整精度：约0.48ppm
频率调整值（LTBADJH，LTBADJL）与调整率的对应关系见第7.3.3节“低速时基计数器频率调整功能”。

##### 7.3.1 低速时基计数器

系统复位后，低速时基计数器（LTBC）从LSCLK下降沿的0000H开始计数。LTBC的T128HZ、T32HZ、T16HZ和T2HZ输出用作时基中断，并在每个输出的下降沿请求中断。每个LTBC输出还用作外围电路的操作时钟。
LTBC的T128HZ到T1HZ的输出数据可以从低速时基计数器寄存器（LTBR）中读取。读取数据时，读取LTBR两次，并检查两个值是否一致，以防止在计数期间读取未定义的数据。
图7-3显示了读取LTBR的程序示例。 图PDF 109页

执行写入操作时，LTBR复位，T128HZ至T1HZ输出设置为“0”。写入数据无效。由于在写入LTBR期间，如果T128Hz到T1Hz输出中出现下降沿，则会发生中断，因此在软件编程时要小心。
图7-4显示了通过写入LTBR的时基计数器输出的中断生成定时和复位定时。图 PDF 109页

##### 7.3.2 高速时基计数器

高速时基计数器配置为4位1/n计数器（n=1到16）。
在4位1/n计数器中，由高速时基计数器除法寄存器（HTBDR）选择的除法时钟（1/16×HSCLK到1/1×HSCLK）被生成为HTBCLK。HTBCLK用作定时器，也用作PWM的操作时钟。
图7-5显示了HTBCLK的输出波形。

##### 7.3.3 低速时基计数器频率调整功能

频率调整（调整范围：约−488ppm至+488ppm。调整精度：通过使用低速时基计数器频率调整寄存器（LTBADJH和LTBADJL），LTBC的T8KHZ到T1HZ的输出可以达到约0.48ppm）。
表7-1显示了频率调整值（LTBADJH，LTBADJL）与调整比率之间的对应关系。

图片 PDF 111页

可通过使用以下方程式获得要在LTBADJH和LTBADJL中设置的调整值（LADJ10到LADJ0）：
调整值=频率调整率×2097152（十进制）
=频率调整率×200000h（十六进制）
例1：调整时+15.0ppm（获取时间）调整值=+15.0ppm×2097152（十进制）
=+15.0×10−6×2097152=+31.45728（十进制）
≅01Fh（十六进制）
示例2：调整−25.5ppm（损失时间）时，调整值=−25.5ppm×2097152（十进制）
=−25.5×10−6×2097152=−53.477376（十进制）≅7CCh（十六进制）
注：
LTBC的低速时钟（LSCLK）和T32KHZ和T16KHZ的输出不通过频率调整功能进行调整。
频率调整精度不能保证精度，包括温度变化引起的晶体振荡频率变化（32.768kHz）。
该功能可用于具有低速晶体振荡时钟的ML610Q411和ML610Q412。它不能用于ML610Q415，因为ML610Q415使用500kHz RC振荡时钟（31.25kHz）的1/16用于低速时钟（LSCLK），因为与晶体振荡相比，该频率具有显著的温度变化

##### 7.3.4 16位定时器2-3频率测量模式的信号生成

在时基内容块中生成用于16位定时器2-3频率测量模式的信号（437C）。有关频率测量功能的详细信息，请参阅第10章“定时器”。频率测量功能在ML610Q415上不可用。

注：
ML610Q415上没有使用16位定时器2和3的频率测量功能。

## 第八章 捕获

##### 8.1 楷述

此LSI有两个捕获电路通道，用于在发生P00和P01中断时将低速基极计数器（LTBC）的T4KHZ到T32HZ信号捕获到捕获寄存器。电路根据时基计数器的时间捕捉每个中断发生的时间。
有关来自P00或P01引脚的外部中断（P00INT、P01INT），请参阅第5章“中断”和第18章“端口0”。

##### 8.1 特征

时基捕获×2ch（4096Hz至32Hz）

##### 8.1.2 配置

图8-1显示了捕获电路的配置。图 PDF 114页

##### 8.1.3 指针列表

---

P00/CAP0    捕获0输入引脚用作P00引脚的辅助功能。

---

P01/CAP1  捕获1个输入引脚用作P01引脚的辅助功能。

---

##### 8.2.1 寄存器列表

图 PDF 115页

##### 8.2.2  捕获控制寄存器（CAPCON）

CAPCON是一种特殊的功能寄存器（SFR），用于控制捕获电路。
[位描述]

•ECAP0（位0）
ECAP0位用于启动或停止捕获0的操作。

•ECAP1（位1）
ECAP1位用于启动或停止捕获1的操作。

##### 8.2.3 捕获状态寄存器（CAPSTAT）

CAPSTAT是一种特殊的功能寄存器（SFR），用于指示捕获电路的状态。
[位描述]

•CAPF0（位0）
CAPF0位是指示是否在捕获数据寄存器0中捕获数据的标志
（0）或否。
当CAPF0位设置为“1”时，表示在捕获数据寄存器0（CAPR0）中捕获数据。
当CAPF0位设置为“1”时，下一个捕获操作停止。因此，执行写入操作以捕获数据寄存器0（CAPR0），将CAPF0位清除为“0”。

•CAPF1（位1）
CAPF1位是指示是否在捕获数据寄存器0中捕获数据的标志
（1）是否。
当CAPF0位设置为“1”时，表示在捕获数据寄存器0（CAPR1）中捕获数据。
当CAPF1位设置为“1”时，下一个捕获操作停止。因此，执行写入操作以捕获数据寄存器1（CAPR1），将capf0位清除为“0”。

##### 8.2.4 捕获数据寄存器0（CAPR0）

CAPR0是一种存储捕获数据的寄存器。
当将CAPF0标志（CAPSTAT寄存器的位0）设置为“0”生成P00中断请求时，捕获低速时基计数器（LTBC）的T4KHZ至T32HZ信号。
写入CAPR0将CAPSTAT的CAPF0标志设置为“0”。即使数据写入CAPR0，CAPR0的值也不会更改。

##### 8.2.5 捕获数据寄存器1（CAPR1

CAPR1是存储捕获数据的寄存器。
当在CAPF1标志（CAPSTAT寄存器的位1）设置为“0”的情况下生成P01中断请求时，捕获低速时基计数器（LTBC）的T4KHZ至T32HZ信号。
写入CAPR1会将CAPSTAT的CAPF1标志设置为“0”。CAPR1的值即使写入数据也不会改变。

##### 8.3 操作说明

捕获电路通过设置捕获控制寄存器（CAPCON）的ECAP0或ECAP1位来开始捕获操作。
当外部中断控制寄存器0或1（EXICON0或EXICON1）选择的P00或P01引脚的输入触发器生成，且P00或P01中断请求标志（QP00或QP01）设置为“1”时，低速时基计数器（LTBC）的T4KHZ至T32HZ信号被捕捉到捕捉寄存器0或1（CAPR0或CAPR1）上下一个低速时钟（LSCLK）下降沿，同时，捕获状态寄存器（CAPSTAT）的捕获标志（CAPF0或CAPF1）设置为“1”。
当捕获标志（CAPF0，CAPF1）为“1”时，以下捕获操作停止。
读取捕获寄存器0或1（CAPR0，CAPR1）中捕获的值后，对捕获寄存器0或1（CAPR0，CAPR1）执行写入操作（写入数据无意义），将捕获标志（CAPF0，CAPF1）清除为“0”，并等待下一个P00或P01中断。
图8-2显示了捕获操作的计时。图 PDF 120页

注：
当CPU以高速（HSCLK）运行时，在生成P00或P01中断请求后，检查捕获标志（CAPF0，CAPF1）是否设置为“1”，然后读取捕获数据寄存器0或1（CAPR0，CAPR1）。

## 第九章 1kHz定时器（1kHzTM）

##### 9.1 楷述

该LSI包括1 kHz计时器，用于测量1/1000秒。
1kHz定时器对通过除以低速时基计数器（LTBC）的T2KHZ输出频率（*）而产生的1kHz（*）信号进行计数，并产生10Hz或1Hz中断（1kHz定时器中断）。
利用1khz定时器，可以容易地获得1/1000秒，其难以在时基计数器的基础上产生，由十进制数表示。该定时器可用于秒表的周期测量。
关于时基计数器，请参阅第7章“时基计数器”。
（*）ML610Q411/Q412:T2KHZ=2.048kHz，1kHz:1.024kHz ML610Q415:T2KHZ=1.953kHz，1kHz:0.977kHz

##### 9.1.1 特征

•10 Hz/1 Hz中断选择功能

##### 9.1.2 配置

图9-1显示了1kHz定时器的配置。图 PDF 122页

##### 9.2 寄存器说明

寄存器列表 

##### 9.2.2 1 kHz定时器计数寄存器（T1KCRL、T1KCRH）

T1KCRL和T1KCRH是特殊功能寄存器（SFR），用于读取1 kHz定时器的十进制计数值。当对T1KCRL或T1KCRH执行写操作时，T1KCRL或T1KCRH的有效位分别为“0”。
[位描述]
•T1KC11至T1KC0（T1KCRH：位7至0，T1KCRL：位7至4）
T1KC11到T1KC0表示1 kHz定时器的计数值

##### 9.2.3 1 kHz定时器控制寄存器（T1KCON）

T1KCON是一个特殊的功能寄存器（SFR），用于控制1khz定时器。
[位描述]

•T1KRUN（位0）
T1KRUN位用于控制1 kHz定时器计数器计数操作的启动/停止。

•T1KSEL（位1）
T1LSEL位用于选择1 kHz定时器的中断周期。可选择10 Hz或1 Hz中断。

##### 9.3 操作说明

通过将1kHz定时器控制寄存器（T1KCON）的T1KRUN位设置为“1”，1kHz定时器开始对1kHz定时器计数器寄存器L或H（T1KCRL、T1KCRH）进行计数。
通过将低速定时器基本计数器（LTBC）的T2KHz信号频率（2.048kHz）除以二元/三元计数器，定时器产生1kHz信号。基于1kHz信号，由T1KCRL和T1KCRH的十进制计数器生成1kHz定时器中断请求信号（T1KINT）。1kHz定时器中断的周期可以使用T1KCON的T1KSEL位在10Hz中断或1Hz中断之间选择。
当对T1KCRL或T1KCRH执行写操作时，二进制/三元计数器的值和T1KCRL或T1KCRH的值被清除为“0”。
可以从T1KCRL和T1KCRH读取数据。在1kHz定时器操作启动状态下从T1KCRL或T1KCRH读取数据时，读取T1KCRL或T1KCRH两次，并检查值是否匹配，以防止在计数期间读取未定义的数据。
图9-2显示了读取T1KCL和T1LCRH的程序示例。

图 PDF 126



## 第十章 定时器

##### 10.1 楷述

该LSI包括4个8位定时器通道。
输入时钟见第6章“时钟产生电路”。

##### 10.2 特征

•当定时器计数器寄存器（TMnC，n=0到3）和定时器数据寄存器（TMnD）的值重合时，产生定时器中断（TMnINT）。
•通过组合定时器0和定时器1或定时器2和定时器3配置的定时器可用作16位定时器。
•对于计时器时钟，可以使用低速时钟（LSCLK）、高速时基时钟（HTBCLK）或外部时钟
挑选出来的。
•16位定时器2和3具有时钟频率测量模式，可计算HTBCLK并生成定时器
计数结束时中断（TM3INT）。利用计数数据通过软件知道频率，可以更准确地确定波特率。

##### 10.1.2 配置

图10-1显示了定时器的配置。 图 PDF 128页

##### 10.2.1 寄存器列表

图 PDF 130页

##### 10.2.2 定时器0数据寄存器（TM0D）

TM0D是一个特殊功能寄存器（SFR），用于设置要与定时器0计数器寄存器（TM0C）值进行比较的值。
注：
定时器停止时设置TM0D（当TM0CON1寄存器的T0STAT位为“0”时）。当在TM0D中写入“00H”时，TM0D被设置为“01H”。

##### 10.2.3 定时器1数据寄存器（TM1D）

TM1D是一个特殊功能寄存器（SFR），用于设置要与定时器1计数器寄存器（TM1C）的值进行比较的值。
注：
定时器停止时设置TM1D（当TM1CON1寄存器的T1STAT位为“0”时）。当在TM1D中写入“00H”时，TM1D被设置为“01H”。

